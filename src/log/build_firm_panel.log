-----------------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/saul/Dropbox/Remote Work Startups/main/src/log/build_firm_panel.log
  log type:  text
 opened on:   3 Jul 2025, 14:44:12

. 
. 
. import delimited "$raw_data/Scoop_alt.csv", clear
(encoding automatically selected: ISO-8859-1)
(6 vars, 323,593 obs)

. 
. gen date_numeric = date(date, "YMD")

. drop date

. rename date_numeric date

. format date %td

. 
. gen yh = hofd(date)

. gen year = yofd(date)

. format yh %th

. 
. collapse (last) date (sum) join leave, by(companyname yh)

. 
. 
. keep companyname yh join leave

. tempfile join_leave

. save `join_leave'
file /var/folders/hg/s3xm9w393gxby64_zklmhgbc0000gn/T//S_10466.000001 saved as .dta format

. 
. 
. import delimited "$processed_data/Scoop_Positions_Firm_Collapse2.csv", clear
(encoding automatically selected: ISO-8859-1)
(6 vars, 323,675 obs)

. drop v1

. 
. gen date_numeric = date(date, "YMD")

. drop date

. rename date_numeric date

. format date %td

. 
. gen yh = hofd(date)

. gen year = yofd(date)

. format yh %th

. 
. // Drop one-off observations in June 2022
. drop if date == 22797
(4,345 observations deleted)

. 
. 
. // Collapse to have one observation per firm-half-year, and calculate growth & rates:
. collapse (last) total_employees date (sum) join leave, by(companyname yh)

. 
. drop join leave

. merge 1:1 companyname yh using `join_leave'

    Result                      Number of obs
    -----------------------------------------
    Not matched                            16
        from master                        14  (_merge==1)
        from using                          2  (_merge==2)

    Matched                            54,161  (_merge==3)
    -----------------------------------------

. drop _merge

. 
. encode companyname, gen(company_numeric)

. xtset company_numeric yh

Panel variable: company_numeric (unbalanced)
 Time variable: yh, 2016h1 to 2022h1, but with gaps
         Delta: 1 halfyear

. sort company_numeric yh

. 
. gen growth_rate = (total_employees / L.total_employees) - 1 if _n > 1
(4,422 missing values generated)

. gen join_rate = join / L.total_employees if _n > 1
(4,427 missing values generated)

. gen leave_rate = leave / L.total_employees if _n > 1
(4,427 missing values generated)

. 
. xtset, clear

. 
. winsor2 growth_rate join_rate leave_rate, cuts(1 99) suffix(_we)

. label variable growth_rate_we "Winsorized growth rate [1,99]"

. label variable join_rate_we "Winsorized join rate [1,99]"

. label variable leave_rate_we "Winsorized leave rate [1,99]"

. 
. drop growth_rate join_rate leave_rate company_numeric

. 
. 
. duplicates drop companyname, force

Duplicates in terms of companyname

(49,806 observations deleted)

. 
. 
. 
. // Merge teleworkable data:
. merge m:1 companyname using "$processed_data/scoop_firm_tele_2.dta"

    Result                      Number of obs
    -----------------------------------------
    Not matched                           130
        from master                       129  (_merge==1)
        from using                          1  (_merge==2)

    Matched                             4,242  (_merge==3)
    -----------------------------------------

. // drop if _merge == 2
. drop _merge

. 
. // Merge with flexibility measures (e.g., remote/flexibility scores):
. merge m:1 companyname using "$raw_data/Scoop_clean_public.dta"

    Result                      Number of obs
    -----------------------------------------
    Not matched                         1,283
        from master                       386  (_merge==1)
        from using                        897  (_merge==2)

    Matched                             3,986  (_merge==3)
    -----------------------------------------

. // drop if _merge == 2
. drop _merge

. 
. // Merge with founding year data:
. merge m:1 companyname using "$raw_data/Scoop_founding.dta"

    Result                      Number of obs
    -----------------------------------------
    Not matched                           867
        from master                       864  (_merge==1)
        from using                          3  (_merge==2)

    Matched                             4,405  (_merge==3)
    -----------------------------------------

. // drop if _merge == 2
. drop _merge

. 
end of do-file

. clear

. clear

. exit
