-----------------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/saul/Dropbox/Remote Work Startups/main/spec/log/user_productivity_alternative_fe_precovid.log
  log type:  text
 opened on:  26 Jun 2025, 10:47:52

. 
. // 0) Setup environment
. do "../src/globals.do"

. global raw_data "../data/raw"

. global processed_data  "../data/processed"

. global results "../results/raw"

. global clean_results "../results/cleaned"

. 
. 
. 
. 
. 
end of do-file

. 
. // 1) Common settings
. local result_dir "$results/`specname'"

. capture mkdir "`result_dir'"

. 
. // -------------------------------------------------------------------------
. // Outcomes to export -------------------------------------------------------
. //   • total_contributions_q100      – Total contributions (pct. rank)
. //   • restricted_contributions_q100 – Restricted contributions (pct. rank)
. //   • total_contributions_we        – Total contributions (winsorised)
. //   • restricted_contributions_we   – Restricted contributions (winsorised)
. // -------------------------------------------------------------------------
. 
. local outcomes total_contributions_q100 ///
>                 restricted_contributions_q100 ///
>                 total_contributions_we ///
>                 restricted_contributions_we

. 
. *--- main results -------------------------------------------------------------
. tempfile out  

. capture postclose handle

. postfile handle ///
>     str20   model_type          ///
>     str20   fe_tag              ///
>     str40  outcome             ///
>     str40  param               ///
>     double coef se pval pre_mean ///
>     double rkf nobs            ///
>     using `out', replace
(file /var/folders/hg/s3xm9w393gxby64_zklmhgbc0000gn/T//S_22469.000001 not found)

. 
. 
. *--- first-stage results (coefficients + diagnostics) -------------------------
. tempfile out_fs

. capture postclose handle_fs

. postfile handle_fs ///
>     str20   fe_tag              ///  "fyh", "time", "firm", "none"
>     str40  outcome             ///
>     str20   endovar             ///  "var3" / "var5"
>     str40  param               ///  var6 / var7 / var4
>     double coef se pval        ///
>     double partialF rkf nobs   ///
>     using `out_fs', replace
(file /var/folders/hg/s3xm9w393gxby64_zklmhgbc0000gn/T//S_22469.000002 not found)

. 
.         
. //-------------------------------------------------------------
. // Firm + user + year FE ("fyh")
. //-------------------------------------------------------------
. local feopt "absorb(firm_id user_id yh)"

. local tag   "fyhu"

. 
. 
. foreach y of local outcomes {
  2.     use "$processed_data/user_panel_`panel_variant'.dta", clear
  3.     display as text ">> FE spec: (tag=`tag')"
  4.     display as text "   – outcome: `y'"
  5. 
.     summarize `y' if covid == 0, meanonly
  6.     local pre_mean = r(mean)
  7. 
.     // OLS
.      reghdfe `y' var3 var5 var4, ///
>         `feopt' vce(cluster user_id)
  8.                 
.         local N = e(N)  
  9.         
.     foreach p in var3 var5 var4 {
 10.         local b    = _b[`p']
 11.         local se   = _se[`p']
 12.         local t    = `b'/`se'
 13.         local pval = 2*ttail(e(df_r), abs(`t'))
 14. 
.                 post handle ("OLS") ("`tag'") ("`y'") ("`p'") ///
>                                         (`b') (`se') (`pval') (`pre_mean') ///
>                                         (.) (`N')
 15.     }
 16. 
.     // IV (2nd stage)
.      ivreghdfe ///
>         `y' (var3 var5 = var6 var7) var4, ///
>         `feopt' vce(cluster user_id) savefirst
 17.     
.         local rkf = e(rkf)
 18.         local N = e(N)  
 19.         
.     foreach p in var3 var5 var4 {
 20.         local b    = _b[`p']
 21.         local se   = _se[`p']
 22.         local t    = `b'/`se'
 23.         local pval = 2*ttail(e(df_r), abs(`t'))
 24.                 post handle ("IV") ("`tag'") ("`y'") ("`p'") ///
>                                         (`b') (`se') (`pval') (`pre_mean') ///
>                                         (`rkf') (`N')
 25.     }
 26.         
.         *--- pull partial F's from the stacked matrix
.         matrix FS = e(first)
 27.         local F3 = FS[4,1]
 28.         local F5 = FS[4,2]
 29. 
.         *========= var3 first stage ===================================================
.         estimates restore _ivreg2_var3
 30.         local N_fs = e(N)
 31. 
.         foreach p in var6 var7 var4 {
 32.                 local b    = _b[`p']
 33.                 local se   = _se[`p']
 34.                 local t    = `b'/`se'
 35.                 local pval = 2*ttail(e(df_r), abs(`t'))
 36. 
.                 post handle_fs ("`tag'") ("`y'") ("var3") ("`p'") ///
>                                                 (`b') (`se') (`pval') ///
>                                                 (`F3') (`rkf') (`N_fs')
 37.         }
 38. 
.         *========= var5 first stage ===================================================
.         estimates restore _ivreg2_var5
 39.         local N_fs = e(N)
 40. 
.         foreach p in var6 var7 var4 {
 41.                 local b    = _b[`p']
 42.                 local se   = _se[`p']
 43.                 local t    = `b'/`se'
 44.                 local pval = 2*ttail(e(df_r), abs(`t'))
 45. 
.                 post handle_fs ("`tag'") ("`y'") ("var5") ("`p'") ///
>                                                 (`b') (`se') (`pval') ///
>                                                 (`F5') (`rkf') (`N_fs')
 46.         }
 47. 
. }
>> FE spec: (tag=fyhu)
   – outcome: total_contributions_q100
(dropped 1443 singleton observations)
(MWFE estimator converged in 80 iterations)

HDFE Linear regression                            Number of obs   =    229,862
Absorbing 3 HDFE groups                           F(   3,  35788) =      11.67
Statistics robust to heteroskedasticity           Prob > F        =     0.0000
                                                  R-squared       =     0.6838
                                                  Adj R-squared   =     0.6213
                                                  Within R-sq.    =     0.0004
Number of clusters (user_id) =     35,789         Root MSE        =    18.4409

                           (Std. err. adjusted for 35,789 clusters in user_id)
------------------------------------------------------------------------------
             |               Robust
total_co~100 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        var3 |  -1.032798   .4818263    -2.14   0.032    -1.977192   -.0884035
        var5 |   5.175073   1.236242     4.19   0.000     2.752001    7.598144
        var4 |  -5.526524   1.065824    -5.19   0.000    -7.615571   -3.437477
       _cons |   50.13249   .1467355   341.65   0.000     49.84489     50.4201
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
     firm_id |      2151           1        2150     |
     user_id |     35789       35789           0    *|
          yh |        11           1          10     |
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
(dropped 1443 singleton observations)
(MWFE estimator converged in 80 iterations)

Stored estimation results
-------------------------
---------------------------------------------------------------------------
             |           Dependent  Number of        
        Name | Command    variable     param.  Title 
-------------+-------------------------------------------------------------
_ivreg2_var3 | ivreg2         var3          3  First-stage regression: var3
_ivreg2_var5 | ivreg2         var5          3  First-stage regression: var5
---------------------------------------------------------------------------

IV (2SLS) estimation
--------------------

Estimates efficient for homoskedasticity only
Statistics robust to heteroskedasticity and clustering on user_id

Number of clusters (user_id) =   35789                Number of obs =   229862
                                                      F(  3, 35788) =     7.03
                                                      Prob > F      =   0.0001
Total (centered) SS     =  65286353.41                Centered R2   =  -0.0014
Total (uncentered) SS   =  65286353.41                Uncentered R2 =  -0.0014
Residual SS             =  65377411.43                Root MSE      =    16.94

------------------------------------------------------------------------------
             |               Robust
total_co~100 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        var3 |  -7.151334   3.898685    -1.83   0.067    -14.79287    .4902066
        var5 |   9.937201   5.370722     1.85   0.064    -.5895776    20.46398
        var4 |  -8.364159    4.04877    -2.07   0.039    -16.29987    -.428447
------------------------------------------------------------------------------
Underidentification test (Kleibergen-Paap rk LM statistic):            266.393
                                                   Chi-sq(1) P-val =    0.0000
------------------------------------------------------------------------------
Weak identification test (Cragg-Donald Wald F statistic):             1850.988
                         (Kleibergen-Paap rk Wald F statistic):        140.597
Stock-Yogo weak ID test critical values: 10% maximal IV size              7.03
                                         15% maximal IV size              4.58
                                         20% maximal IV size              3.95
                                         25% maximal IV size              3.63
Source: Stock-Yogo (2005).  Reproduced by permission.
NB: Critical values are for Cragg-Donald F statistic and i.i.d. errors.
------------------------------------------------------------------------------
Hansen J statistic (overidentification test of all instruments):         0.000
                                                 (equation exactly identified)
------------------------------------------------------------------------------
Instrumented:         var3 var5
Included instruments: var4
Excluded instruments: var6 var7
Partialled-out:       _cons
                      nb: total SS, model F and R2s are after partialling-out;
                          any small-sample adjustments include partialled-out
                          variables in regressor count K
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
     firm_id |      2151           1        2150     |
     user_id |     35789       35789           0    *|
          yh |        11           1          10     |
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
(results _ivreg2_var3 are active now)
(results _ivreg2_var5 are active now)
>> FE spec: (tag=fyhu)
   – outcome: restricted_contributions_q100
(dropped 1443 singleton observations)
(MWFE estimator converged in 81 iterations)

HDFE Linear regression                            Number of obs   =    229,862
Absorbing 3 HDFE groups                           F(   3,  35788) =      18.71
Statistics robust to heteroskedasticity           Prob > F        =     0.0000
                                                  R-squared       =     0.6597
                                                  Adj R-squared   =     0.5924
                                                  Within R-sq.    =     0.0005
Number of clusters (user_id) =     35,789         Root MSE        =    20.2192

                           (Std. err. adjusted for 35,789 clusters in user_id)
------------------------------------------------------------------------------
             |               Robust
restrict~100 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        var3 |  -1.435273   .5042968    -2.85   0.004     -2.42371   -.4468365
        var5 |   6.367405   1.244778     5.12   0.000     3.927603    8.807207
        var4 |  -6.888814   1.072685    -6.42   0.000    -8.991309   -4.786318
       _cons |   48.82054   .1534973   318.05   0.000     48.51968     49.1214
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
     firm_id |      2151           1        2150     |
     user_id |     35789       35789           0    *|
          yh |        11           1          10     |
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
(dropped 1443 singleton observations)
(MWFE estimator converged in 81 iterations)

Stored estimation results
-------------------------
---------------------------------------------------------------------------
             |           Dependent  Number of        
        Name | Command    variable     param.  Title 
-------------+-------------------------------------------------------------
_ivreg2_var3 | ivreg2         var3          3  First-stage regression: var3
_ivreg2_var5 | ivreg2         var5          3  First-stage regression: var5
---------------------------------------------------------------------------

IV (2SLS) estimation
--------------------

Estimates efficient for homoskedasticity only
Statistics robust to heteroskedasticity and clustering on user_id

Number of clusters (user_id) =   35789                Number of obs =   229862
                                                      F(  3, 35788) =    11.03
                                                      Prob > F      =   0.0000
Total (centered) SS     =   78494862.2                Centered R2   =  -0.0006
Total (uncentered) SS   =   78494862.2                Uncentered R2 =  -0.0006
Residual SS             =   78539835.8                Root MSE      =    18.57

------------------------------------------------------------------------------
             |               Robust
restrict~100 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        var3 |  -6.597324   4.080444    -1.62   0.106    -14.59512    1.400471
        var5 |   9.071867   5.433333     1.67   0.095    -1.577631    19.72136
        var4 |   -8.16915   4.049342    -2.02   0.044    -16.10598   -.2323182
------------------------------------------------------------------------------
Underidentification test (Kleibergen-Paap rk LM statistic):            266.393
                                                   Chi-sq(1) P-val =    0.0000
------------------------------------------------------------------------------
Weak identification test (Cragg-Donald Wald F statistic):             1850.988
                         (Kleibergen-Paap rk Wald F statistic):        140.597
Stock-Yogo weak ID test critical values: 10% maximal IV size              7.03
                                         15% maximal IV size              4.58
                                         20% maximal IV size              3.95
                                         25% maximal IV size              3.63
Source: Stock-Yogo (2005).  Reproduced by permission.
NB: Critical values are for Cragg-Donald F statistic and i.i.d. errors.
------------------------------------------------------------------------------
Hansen J statistic (overidentification test of all instruments):         0.000
                                                 (equation exactly identified)
------------------------------------------------------------------------------
Instrumented:         var3 var5
Included instruments: var4
Excluded instruments: var6 var7
Partialled-out:       _cons
                      nb: total SS, model F and R2s are after partialling-out;
                          any small-sample adjustments include partialled-out
                          variables in regressor count K
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
     firm_id |      2151           1        2150     |
     user_id |     35789       35789           0    *|
          yh |        11           1          10     |
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
(results _ivreg2_var3 are active now)
(results _ivreg2_var5 are active now)
>> FE spec: (tag=fyhu)
   – outcome: total_contributions_we
(dropped 1443 singleton observations)
(MWFE estimator converged in 80 iterations)

HDFE Linear regression                            Number of obs   =    229,862
Absorbing 3 HDFE groups                           F(   3,  35788) =      14.60
Statistics robust to heteroskedasticity           Prob > F        =     0.0000
                                                  R-squared       =     0.6964
                                                  Adj R-squared   =     0.6363
                                                  Within R-sq.    =     0.0007
Number of clusters (user_id) =     35,789         Root MSE        =   156.4082

                           (Std. err. adjusted for 35,789 clusters in user_id)
------------------------------------------------------------------------------
             |               Robust
total_cont~e | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        var3 |  -17.74688   4.466934    -3.97   0.000    -26.50221   -8.991555
        var5 |    52.5563    13.5541     3.88   0.000     25.98984    79.12275
        var4 |  -56.41912   11.69413    -4.82   0.000    -79.33998   -33.49827
       _cons |   199.9977   1.360126   147.04   0.000     197.3318    202.6636
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
     firm_id |      2151           1        2150     |
     user_id |     35789       35789           0    *|
          yh |        11           1          10     |
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
(dropped 1443 singleton observations)
(MWFE estimator converged in 80 iterations)

Stored estimation results
-------------------------
---------------------------------------------------------------------------
             |           Dependent  Number of        
        Name | Command    variable     param.  Title 
-------------+-------------------------------------------------------------
_ivreg2_var3 | ivreg2         var3          3  First-stage regression: var3
_ivreg2_var5 | ivreg2         var5          3  First-stage regression: var5
---------------------------------------------------------------------------

IV (2SLS) estimation
--------------------

Estimates efficient for homoskedasticity only
Statistics robust to heteroskedasticity and clustering on user_id

Number of clusters (user_id) =   35789                Number of obs =   229862
                                                      F(  3, 35788) =    10.45
                                                      Prob > F      =   0.0000
Total (centered) SS     =   4697907923                Centered R2   =  -0.0045
Total (uncentered) SS   =   4697907923                Uncentered R2 =  -0.0045
Residual SS             =   4719063338                Root MSE      =      144

------------------------------------------------------------------------------
             |               Robust
total_cont~e | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        var3 |  -105.7832   32.27641    -3.28   0.001    -169.0459   -42.52046
        var5 |   104.4113   54.00065     1.93   0.053    -1.431627    210.2542
        var4 |  -83.11552   42.46669    -1.96   0.050    -166.3515      .12048
------------------------------------------------------------------------------
Underidentification test (Kleibergen-Paap rk LM statistic):            266.393
                                                   Chi-sq(1) P-val =    0.0000
------------------------------------------------------------------------------
Weak identification test (Cragg-Donald Wald F statistic):             1850.988
                         (Kleibergen-Paap rk Wald F statistic):        140.597
Stock-Yogo weak ID test critical values: 10% maximal IV size              7.03
                                         15% maximal IV size              4.58
                                         20% maximal IV size              3.95
                                         25% maximal IV size              3.63
Source: Stock-Yogo (2005).  Reproduced by permission.
NB: Critical values are for Cragg-Donald F statistic and i.i.d. errors.
------------------------------------------------------------------------------
Hansen J statistic (overidentification test of all instruments):         0.000
                                                 (equation exactly identified)
------------------------------------------------------------------------------
Instrumented:         var3 var5
Included instruments: var4
Excluded instruments: var6 var7
Partialled-out:       _cons
                      nb: total SS, model F and R2s are after partialling-out;
                          any small-sample adjustments include partialled-out
                          variables in regressor count K
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
     firm_id |      2151           1        2150     |
     user_id |     35789       35789           0    *|
          yh |        11           1          10     |
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
(results _ivreg2_var3 are active now)
(results _ivreg2_var5 are active now)
>> FE spec: (tag=fyhu)
   – outcome: restricted_contributions_we
(dropped 1443 singleton observations)
(MWFE estimator converged in 80 iterations)

HDFE Linear regression                            Number of obs   =    229,862
Absorbing 3 HDFE groups                           F(   3,  35788) =      16.51
Statistics robust to heteroskedasticity           Prob > F        =     0.0000
                                                  R-squared       =     0.7100
                                                  Adj R-squared   =     0.6526
                                                  Within R-sq.    =     0.0008
Number of clusters (user_id) =     35,789         Root MSE        =   132.6600

                           (Std. err. adjusted for 35,789 clusters in user_id)
------------------------------------------------------------------------------
             |               Robust
restricted~e | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        var3 |  -16.08985   3.757508    -4.28   0.000    -23.45468   -8.725016
        var5 |   48.60198   12.15003     4.00   0.000     24.78755    72.41641
        var4 |  -52.52437   10.52451    -4.99   0.000    -73.15273     -31.896
       _cons |   153.5338   1.143565   134.26   0.000     151.2924    155.7752
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
     firm_id |      2151           1        2150     |
     user_id |     35789       35789           0    *|
          yh |        11           1          10     |
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
(dropped 1443 singleton observations)
(MWFE estimator converged in 80 iterations)

Stored estimation results
-------------------------
---------------------------------------------------------------------------
             |           Dependent  Number of        
        Name | Command    variable     param.  Title 
-------------+-------------------------------------------------------------
_ivreg2_var3 | ivreg2         var3          3  First-stage regression: var3
_ivreg2_var5 | ivreg2         var5          3  First-stage regression: var5
---------------------------------------------------------------------------

IV (2SLS) estimation
--------------------

Estimates efficient for homoskedasticity only
Statistics robust to heteroskedasticity and clustering on user_id

Number of clusters (user_id) =   35789                Number of obs =   229862
                                                      F(  3, 35788) =    12.34
                                                      Prob > F      =   0.0000
Total (centered) SS     =   3380055841                Centered R2   =  -0.0059
Total (uncentered) SS   =   3380055841                Uncentered R2 =  -0.0059
Residual SS             =   3399971808                Root MSE      =    122.2

------------------------------------------------------------------------------
             |               Robust
restricted~e | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        var3 |  -100.6075   26.91018    -3.74   0.000    -153.3523   -47.86278
        var5 |   92.21611    48.0611     1.92   0.055    -1.985096    186.4173
        var4 |  -72.92259   38.26543    -1.91   0.057     -147.924    2.078815
------------------------------------------------------------------------------
Underidentification test (Kleibergen-Paap rk LM statistic):            266.393
                                                   Chi-sq(1) P-val =    0.0000
------------------------------------------------------------------------------
Weak identification test (Cragg-Donald Wald F statistic):             1850.988
                         (Kleibergen-Paap rk Wald F statistic):        140.597
Stock-Yogo weak ID test critical values: 10% maximal IV size              7.03
                                         15% maximal IV size              4.58
                                         20% maximal IV size              3.95
                                         25% maximal IV size              3.63
Source: Stock-Yogo (2005).  Reproduced by permission.
NB: Critical values are for Cragg-Donald F statistic and i.i.d. errors.
------------------------------------------------------------------------------
Hansen J statistic (overidentification test of all instruments):         0.000
                                                 (equation exactly identified)
------------------------------------------------------------------------------
Instrumented:         var3 var5
Included instruments: var4
Excluded instruments: var6 var7
Partialled-out:       _cons
                      nb: total SS, model F and R2s are after partialling-out;
                          any small-sample adjustments include partialled-out
                          variables in regressor count K
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
     firm_id |      2151           1        2150     |
     user_id |     35789       35789           0    *|
          yh |        11           1          10     |
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
(results _ivreg2_var3 are active now)
(results _ivreg2_var5 are active now)

. 
. 
. 
. //-------------------------------------------------------------
. // firm x user + yh
. //-------------------------------------------------------------
. local feopt "absorb(firm_id#user_id yh)"

. local tag   "firmbyuseryh"

. 
. 
. foreach y of local outcomes {
  2.     use "$processed_data/user_panel_`panel_variant'.dta", clear
  3.     display as text ">> FE spec: (tag=`tag')"
  4.     display as text "   – outcome: `y'"
  5.     summarize `y' if covid == 0, meanonly
  6.     local pre_mean = r(mean)
  7. 
.     // OLS
.      reghdfe `y' var3 var5 var4, ///
>         `feopt' vce(cluster user_id)
  8.                 
.         local N = e(N)  
  9.         
.     foreach p in var3 var5 var4 {
 10.         local b    = _b[`p']
 11.         local se   = _se[`p']
 12.         local t    = `b'/`se'
 13.         local pval = 2*ttail(e(df_r), abs(`t'))
 14. 
.                 post handle ("OLS") ("`tag'") ("`y'") ("`p'") ///
>                                         (`b') (`se') (`pval') (`pre_mean') ///
>                                         (.) (`N')
 15.     }
 16. 
.     // IV (2nd stage)
.      ivreghdfe ///
>         `y' (var3 var5 = var6 var7) var4, ///
>         `feopt' vce(cluster user_id) savefirst
 17.     
.         local rkf = e(rkf)
 18.         local N = e(N)  
 19.         
.     foreach p in var3 var5 var4 {
 20.         local b    = _b[`p']
 21.         local se   = _se[`p']
 22.         local t    = `b'/`se'
 23.         local pval = 2*ttail(e(df_r), abs(`t'))
 24.                 post handle ("IV") ("`tag'") ("`y'") ("`p'") ///
>                                         (`b') (`se') (`pval') (`pre_mean') ///
>                                         (`rkf') (`N')
 25.     }
 26.         
.         *--- pull partial F's from the stacked matrix
.         matrix FS = e(first)
 27.         local F3 = FS[4,1]
 28.         local F5 = FS[4,2]
 29. 
.         *========= var3 first stage ===================================================
.         estimates restore _ivreg2_var3
 30.         local N_fs = e(N)
 31. 
.         foreach p in var6 var7 var4 {
 32.                 local b    = _b[`p']
 33.                 local se   = _se[`p']
 34.                 local t    = `b'/`se'
 35.                 local pval = 2*ttail(e(df_r), abs(`t'))
 36. 
.                 post handle_fs ("`tag'") ("`y'") ("var3") ("`p'") ///
>                                                 (`b') (`se') (`pval') ///
>                                                 (`F3') (`rkf') (`N_fs')
 37.         }
 38. 
.         *========= var5 first stage ===================================================
.         estimates restore _ivreg2_var5
 39.         local N_fs = e(N)
 40. 
.         foreach p in var6 var7 var4 {
 41.                 local b    = _b[`p']
 42.                 local se   = _se[`p']
 43.                 local t    = `b'/`se'
 44.                 local pval = 2*ttail(e(df_r), abs(`t'))
 45. 
.                 post handle_fs ("`tag'") ("`y'") ("var5") ("`p'") ///
>                                                 (`b') (`se') (`pval') ///
>                                                 (`F5') (`rkf') (`N_fs')
 46.         }
 47. 
. }
>> FE spec: (tag=firmbyuseryh)
   – outcome: total_contributions_q100
(dropped 6597 singleton observations)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   =    224,708
Absorbing 2 HDFE groups                           F(   3,  35478) =      16.65
Statistics robust to heteroskedasticity           Prob > F        =     0.0000
                                                  R-squared       =     0.7186
                                                  Adj R-squared   =     0.6525
                                                  Within R-sq.    =     0.0006
Number of clusters (user_id) =     35,479         Root MSE        =    17.6444

                           (Std. err. adjusted for 35,479 clusters in user_id)
------------------------------------------------------------------------------
             |               Robust
total_co~100 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        var3 |  -1.234691   .4958927    -2.49   0.013    -2.206656   -.2627261
        var5 |   6.208444   1.270913     4.89   0.000     3.717416    8.699472
        var4 |  -6.711066   1.096609    -6.12   0.000    -8.860454   -4.561678
       _cons |   50.52317   .1507992   335.04   0.000      50.2276    50.81874
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------------+
       Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------------+---------------------------------------|
   firm_id#user_id |     42710       42710           0    *|
                yh |        11           1          10     |
-----------------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
(dropped 6597 singleton observations)
(MWFE estimator converged in 8 iterations)

Stored estimation results
-------------------------
---------------------------------------------------------------------------
             |           Dependent  Number of        
        Name | Command    variable     param.  Title 
-------------+-------------------------------------------------------------
_ivreg2_var3 | ivreg2         var3          3  First-stage regression: var3
_ivreg2_var5 | ivreg2         var5          3  First-stage regression: var5
---------------------------------------------------------------------------

IV (2SLS) estimation
--------------------

Estimates efficient for homoskedasticity only
Statistics robust to heteroskedasticity and clustering on user_id

Number of clusters (user_id) =   35479                Number of obs =   224708
                                                      F(  3, 35478) =    10.55
                                                      Prob > F      =   0.0000
Total (centered) SS     =  56688987.29                Centered R2   =  -0.0026
Total (uncentered) SS   =  56688987.29                Uncentered R2 =  -0.0026
Residual SS             =   56837758.2                Root MSE      =     15.9

------------------------------------------------------------------------------
             |               Robust
total_co~100 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        var3 |  -9.263295   4.013595    -2.31   0.021    -17.13006   -1.396526
        var5 |   12.45296   5.392867     2.31   0.021     1.882779    23.02315
        var4 |  -10.43373   4.045733    -2.58   0.010    -18.36349   -2.503968
------------------------------------------------------------------------------
Underidentification test (Kleibergen-Paap rk LM statistic):            231.086
                                                   Chi-sq(1) P-val =    0.0000
------------------------------------------------------------------------------
Weak identification test (Cragg-Donald Wald F statistic):             1854.151
                         (Kleibergen-Paap rk Wald F statistic):        123.431
Stock-Yogo weak ID test critical values: 10% maximal IV size              7.03
                                         15% maximal IV size              4.58
                                         20% maximal IV size              3.95
                                         25% maximal IV size              3.63
Source: Stock-Yogo (2005).  Reproduced by permission.
NB: Critical values are for Cragg-Donald F statistic and i.i.d. errors.
------------------------------------------------------------------------------
Hansen J statistic (overidentification test of all instruments):         0.000
                                                 (equation exactly identified)
------------------------------------------------------------------------------
Instrumented:         var3 var5
Included instruments: var4
Excluded instruments: var6 var7
Partialled-out:       _cons
                      nb: total SS, model F and R2s are after partialling-out;
                          any small-sample adjustments include partialled-out
                          variables in regressor count K
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------------+
       Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------------+---------------------------------------|
   firm_id#user_id |     42710       42710           0    *|
                yh |        11           1          10     |
-----------------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
(results _ivreg2_var3 are active now)
(results _ivreg2_var5 are active now)
>> FE spec: (tag=firmbyuseryh)
   – outcome: restricted_contributions_q100
(dropped 6597 singleton observations)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   =    224,708
Absorbing 2 HDFE groups                           F(   3,  35478) =      22.90
Statistics robust to heteroskedasticity           Prob > F        =     0.0000
                                                  R-squared       =     0.6947
                                                  Adj R-squared   =     0.6231
                                                  Within R-sq.    =     0.0007
Number of clusters (user_id) =     35,479         Root MSE        =    19.4139

                           (Std. err. adjusted for 35,479 clusters in user_id)
------------------------------------------------------------------------------
             |               Robust
restrict~100 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        var3 |  -1.483118   .5182825    -2.86   0.004    -2.498967   -.4672678
        var5 |   7.309506   1.266283     5.77   0.000     4.827552    9.791461
        var4 |  -7.883314   1.090415    -7.23   0.000    -10.02056   -5.746067
       _cons |   49.17617   .1575102   312.21   0.000     48.86745     49.4849
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------------+
       Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------------+---------------------------------------|
   firm_id#user_id |     42710       42710           0    *|
                yh |        11           1          10     |
-----------------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
(dropped 6597 singleton observations)
(MWFE estimator converged in 8 iterations)

Stored estimation results
-------------------------
---------------------------------------------------------------------------
             |           Dependent  Number of        
        Name | Command    variable     param.  Title 
-------------+-------------------------------------------------------------
_ivreg2_var3 | ivreg2         var3          3  First-stage regression: var3
_ivreg2_var5 | ivreg2         var5          3  First-stage regression: var5
---------------------------------------------------------------------------

IV (2SLS) estimation
--------------------

Estimates efficient for homoskedasticity only
Statistics robust to heteroskedasticity and clustering on user_id

Number of clusters (user_id) =   35479                Number of obs =   224708
                                                      F(  3, 35478) =    13.16
                                                      Prob > F      =   0.0000
Total (centered) SS     =  68635276.28                Centered R2   =  -0.0005
Total (uncentered) SS   =  68635276.28                Uncentered R2 =  -0.0005
Residual SS             =  68669665.19                Root MSE      =    17.48

------------------------------------------------------------------------------
             |               Robust
restrict~100 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        var3 |  -6.750169    4.18728    -1.61   0.107    -14.95737    1.457029
        var5 |   10.51804    5.42275     1.94   0.052    -.1107229    21.14679
        var4 |  -9.570499   4.015137    -2.38   0.017    -17.44029   -1.700706
------------------------------------------------------------------------------
Underidentification test (Kleibergen-Paap rk LM statistic):            231.086
                                                   Chi-sq(1) P-val =    0.0000
------------------------------------------------------------------------------
Weak identification test (Cragg-Donald Wald F statistic):             1854.151
                         (Kleibergen-Paap rk Wald F statistic):        123.431
Stock-Yogo weak ID test critical values: 10% maximal IV size              7.03
                                         15% maximal IV size              4.58
                                         20% maximal IV size              3.95
                                         25% maximal IV size              3.63
Source: Stock-Yogo (2005).  Reproduced by permission.
NB: Critical values are for Cragg-Donald F statistic and i.i.d. errors.
------------------------------------------------------------------------------
Hansen J statistic (overidentification test of all instruments):         0.000
                                                 (equation exactly identified)
------------------------------------------------------------------------------
Instrumented:         var3 var5
Included instruments: var4
Excluded instruments: var6 var7
Partialled-out:       _cons
                      nb: total SS, model F and R2s are after partialling-out;
                          any small-sample adjustments include partialled-out
                          variables in regressor count K
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------------+
       Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------------+---------------------------------------|
   firm_id#user_id |     42710       42710           0    *|
                yh |        11           1          10     |
-----------------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
(results _ivreg2_var3 are active now)
(results _ivreg2_var5 are active now)
>> FE spec: (tag=firmbyuseryh)
   – outcome: total_contributions_we
(dropped 6597 singleton observations)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   =    224,708
Absorbing 2 HDFE groups                           F(   3,  35478) =      18.79
Statistics robust to heteroskedasticity           Prob > F        =     0.0000
                                                  R-squared       =     0.7236
                                                  Adj R-squared   =     0.6588
                                                  Within R-sq.    =     0.0010
Number of clusters (user_id) =     35,479         Root MSE        =   152.2390

                           (Std. err. adjusted for 35,479 clusters in user_id)
------------------------------------------------------------------------------
             |               Robust
total_cont~e | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        var3 |  -19.73865   4.664765    -4.23   0.000    -28.88173   -10.59556
        var5 |    59.2274   14.22468     4.16   0.000     31.34659    87.10821
        var4 |  -65.71159   12.28919    -5.35   0.000    -89.79878   -41.62441
       _cons |   203.3468   1.418238   143.38   0.000      200.567    206.1266
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------------+
       Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------------+---------------------------------------|
   firm_id#user_id |     42710       42710           0    *|
                yh |        11           1          10     |
-----------------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
(dropped 6597 singleton observations)
(MWFE estimator converged in 8 iterations)

Stored estimation results
-------------------------
---------------------------------------------------------------------------
             |           Dependent  Number of        
        Name | Command    variable     param.  Title 
-------------+-------------------------------------------------------------
_ivreg2_var3 | ivreg2         var3          3  First-stage regression: var3
_ivreg2_var5 | ivreg2         var5          3  First-stage regression: var5
---------------------------------------------------------------------------

IV (2SLS) estimation
--------------------

Estimates efficient for homoskedasticity only
Statistics robust to heteroskedasticity and clustering on user_id

Number of clusters (user_id) =   35479                Number of obs =   224708
                                                      F(  3, 35478) =    14.44
                                                      Prob > F      =   0.0000
Total (centered) SS     =   4221841504                Centered R2   =  -0.0064
Total (uncentered) SS   =   4221841504                Uncentered R2 =  -0.0064
Residual SS             =   4248889256                Root MSE      =    137.5

------------------------------------------------------------------------------
             |               Robust
total_cont~e | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        var3 |  -124.3861   33.82227    -3.68   0.000    -190.6788   -58.09342
        var5 |    130.916   55.14158     2.37   0.018     22.83684    238.9952
        var4 |  -105.9838   43.26656    -2.45   0.014    -190.7876   -21.17998
------------------------------------------------------------------------------
Underidentification test (Kleibergen-Paap rk LM statistic):            231.086
                                                   Chi-sq(1) P-val =    0.0000
------------------------------------------------------------------------------
Weak identification test (Cragg-Donald Wald F statistic):             1854.151
                         (Kleibergen-Paap rk Wald F statistic):        123.431
Stock-Yogo weak ID test critical values: 10% maximal IV size              7.03
                                         15% maximal IV size              4.58
                                         20% maximal IV size              3.95
                                         25% maximal IV size              3.63
Source: Stock-Yogo (2005).  Reproduced by permission.
NB: Critical values are for Cragg-Donald F statistic and i.i.d. errors.
------------------------------------------------------------------------------
Hansen J statistic (overidentification test of all instruments):         0.000
                                                 (equation exactly identified)
------------------------------------------------------------------------------
Instrumented:         var3 var5
Included instruments: var4
Excluded instruments: var6 var7
Partialled-out:       _cons
                      nb: total SS, model F and R2s are after partialling-out;
                          any small-sample adjustments include partialled-out
                          variables in regressor count K
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------------+
       Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------------+---------------------------------------|
   firm_id#user_id |     42710       42710           0    *|
                yh |        11           1          10     |
-----------------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
(results _ivreg2_var3 are active now)
(results _ivreg2_var5 are active now)
>> FE spec: (tag=firmbyuseryh)
   – outcome: restricted_contributions_we
(dropped 6597 singleton observations)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   =    224,708
Absorbing 2 HDFE groups                           F(   3,  35478) =      20.71
Statistics robust to heteroskedasticity           Prob > F        =     0.0000
                                                  R-squared       =     0.7376
                                                  Adj R-squared   =     0.6760
                                                  Within R-sq.    =     0.0011
Number of clusters (user_id) =     35,479         Root MSE        =   128.8529

                           (Std. err. adjusted for 35,479 clusters in user_id)
------------------------------------------------------------------------------
             |               Robust
restricted~e | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        var3 |  -17.33376   3.913765    -4.43   0.000    -25.00486   -9.662662
        var5 |   55.41384   12.74022     4.35   0.000     30.44261    80.38507
        var4 |  -61.57664   11.05965    -5.57   0.000     -83.2539   -39.89938
       _cons |    156.252   1.188829   131.43   0.000     153.9218    158.5821
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------------+
       Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------------+---------------------------------------|
   firm_id#user_id |     42710       42710           0    *|
                yh |        11           1          10     |
-----------------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
(dropped 6597 singleton observations)
(MWFE estimator converged in 8 iterations)

Stored estimation results
-------------------------
---------------------------------------------------------------------------
             |           Dependent  Number of        
        Name | Command    variable     param.  Title 
-------------+-------------------------------------------------------------
_ivreg2_var3 | ivreg2         var3          3  First-stage regression: var3
_ivreg2_var5 | ivreg2         var5          3  First-stage regression: var5
---------------------------------------------------------------------------

IV (2SLS) estimation
--------------------

Estimates efficient for homoskedasticity only
Statistics robust to heteroskedasticity and clustering on user_id

Number of clusters (user_id) =   35479                Number of obs =   224708
                                                      F(  3, 35478) =    15.38
                                                      Prob > F      =   0.0000
Total (centered) SS     =   3024935101                Centered R2   =  -0.0062
Total (uncentered) SS   =   3024935101                Uncentered R2 =  -0.0062
Residual SS             =   3043839934                Root MSE      =    116.4

------------------------------------------------------------------------------
             |               Robust
restricted~e | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        var3 |  -105.5874   28.10637    -3.76   0.000    -160.6768   -50.49807
        var5 |   108.1983   48.92413     2.21   0.027      12.3055    204.0911
        var4 |  -89.01617   38.89382    -2.29   0.022    -165.2493   -12.78308
------------------------------------------------------------------------------
Underidentification test (Kleibergen-Paap rk LM statistic):            231.086
                                                   Chi-sq(1) P-val =    0.0000
------------------------------------------------------------------------------
Weak identification test (Cragg-Donald Wald F statistic):             1854.151
                         (Kleibergen-Paap rk Wald F statistic):        123.431
Stock-Yogo weak ID test critical values: 10% maximal IV size              7.03
                                         15% maximal IV size              4.58
                                         20% maximal IV size              3.95
                                         25% maximal IV size              3.63
Source: Stock-Yogo (2005).  Reproduced by permission.
NB: Critical values are for Cragg-Donald F statistic and i.i.d. errors.
------------------------------------------------------------------------------
Hansen J statistic (overidentification test of all instruments):         0.000
                                                 (equation exactly identified)
------------------------------------------------------------------------------
Instrumented:         var3 var5
Included instruments: var4
Excluded instruments: var6 var7
Partialled-out:       _cons
                      nb: total SS, model F and R2s are after partialling-out;
                          any small-sample adjustments include partialled-out
                          variables in regressor count K
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------------+
       Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------------+---------------------------------------|
   firm_id#user_id |     42710       42710           0    *|
                yh |        11           1          10     |
-----------------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
(results _ivreg2_var3 are active now)
(results _ivreg2_var5 are active now)

. 
. 
. 
. 
. //-------------------------------------------------------------
. // //  Firm + year FE ("fyh")
. // //-------------------------------------------------------------
. // local feopt "absorb(firm_id yh)"
. // local tag   "fyh"
. //
. // foreach y of local outcomes {
. //     use "$processed_data/user_panel_`panel_variant'.dta", clear
. //     display as text ">> FE spec: (tag=`tag')"
. //     display as text "   – outcome: `y'"
. //     summarize `y' if covid == 0, meanonly
. //     local pre_mean = r(mean)
. //
. //     // OLS
. //      reghdfe `y' var3 var5 var4, ///
. //         `feopt' vce(cluster user_id)
. //              
. //      local N = e(N)  
. //      
. //     foreach p in var3 var5 var4 {
. //         local b    = _b[`p']
. //         local se   = _se[`p']
. //         local t    = `b'/`se'
. //         local pval = 2*ttail(e(df_r), abs(`t'))
. //
. //                 post handle ("OLS") ("`tag'") ("`y'") ("`p'") ///
. //                                         (`b') (`se') (`pval') (`pre_mean') ///
. //                                         (.) (`N')
. //     }
. //
. //     // IV (2nd stage)
. //      ivreghdfe ///
. //         `y' (var3 var5 = var6 var7) var4, ///
. //         `feopt' vce(cluster user_id) savefirst
. //    
. //      local rkf = e(rkf)
. //      local N = e(N)  
. //      
. //     foreach p in var3 var5 var4 {
. //         local b    = _b[`p']
. //         local se   = _se[`p']
. //         local t    = `b'/`se'
. //         local pval = 2*ttail(e(df_r), abs(`t'))
. //                 post handle ("IV") ("`tag'") ("`y'") ("`p'") ///
. //                                         (`b') (`se') (`pval') (`pre_mean') ///
. //                                         (`rkf') (`N')
. //     }
. //      
. //      *--- pull partial F's from the stacked matrix
. //      matrix FS = e(first)
. //      local F3 = FS[4,1]
. //      local F5 = FS[4,2]
. //
. //      *========= var3 first stage ===================================================
. //      estimates restore _ivreg2_var3
. //      local N_fs = e(N)
. //
. //      foreach p in var6 var7 var4 {
. //              local b    = _b[`p']
. //              local se   = _se[`p']
. //              local t    = `b'/`se'
. //              local pval = 2*ttail(e(df_r), abs(`t'))
. //
. //              post handle_fs ("`tag'") ("`y'") ("var3") ("`p'") ///
. //                                              (`b') (`se') (`pval') ///
. //                                              (`F3') (`rkf') (`N_fs')
. //      }
. //
. //      *========= var5 first stage ===================================================
. //      estimates restore _ivreg2_var5
. //      local N_fs = e(N)
. //
. //      foreach p in var6 var7 var4 {
. //              local b    = _b[`p']
. //              local se   = _se[`p']
. //              local t    = `b'/`se'
. //              local pval = 2*ttail(e(df_r), abs(`t'))
. //
. //              post handle_fs ("`tag'") ("`y'") ("var5") ("`p'") ///
. //                                              (`b') (`se') (`pval') ///
. //                                              (`F5') (`rkf') (`N_fs')
. //      }
. //
. // }
. //
. //
. //
. // local feopt "absorb(user_id yh)"
. // local tag   "useryh"
. //
. // foreach y of local outcomes {
. //     use "$processed_data/user_panel_`panel_variant'.dta", clear
. //     display as text ">> FE spec: (tag=`tag')"
. //     display as text "   – outcome: `y'"
. //     summarize `y' if covid == 0, meanonly
. //     local pre_mean = r(mean)
. //
. //     // OLS
. //      reghdfe `y' var3 var5 var4, ///
. //         `feopt' vce(cluster user_id)
. //              
. //      local N = e(N)  
. //      
. //     foreach p in var3 var5 var4 {
. //         local b    = _b[`p']
. //         local se   = _se[`p']
. //         local t    = `b'/`se'
. //         local pval = 2*ttail(e(df_r), abs(`t'))
. //
. //                 post handle ("OLS") ("`tag'") ("`y'") ("`p'") ///
. //                                         (`b') (`se') (`pval') (`pre_mean') ///
. //                                         (.) (`N')
. //     }
. //
. //     // IV (2nd stage)
. //      ivreghdfe ///
. //         `y' (var3 var5 = var6 var7) var4, ///
. //         `feopt' vce(cluster user_id) savefirst
. //    
. //      local rkf = e(rkf)
. //      local N = e(N)  
. //      
. //     foreach p in var3 var5 var4 {
. //         local b    = _b[`p']
. //         local se   = _se[`p']
. //         local t    = `b'/`se'
. //         local pval = 2*ttail(e(df_r), abs(`t'))
. //                 post handle ("IV") ("`tag'") ("`y'") ("`p'") ///
. //                                         (`b') (`se') (`pval') (`pre_mean') ///
. //                                         (`rkf') (`N')
. //     }
. //      
. //      *--- pull partial F's from the stacked matrix
. //      matrix FS = e(first)
. //      local F3 = FS[4,1]
. //      local F5 = FS[4,2]
. //
. //      *========= var3 first stage ===================================================
. //      estimates restore _ivreg2_var3
. //      local N_fs = e(N)
. //
. //      foreach p in var6 var7 var4 {
. //              local b    = _b[`p']
. //              local se   = _se[`p']
. //              local t    = `b'/`se'
. //              local pval = 2*ttail(e(df_r), abs(`t'))
. //
. //              post handle_fs ("`tag'") ("`y'") ("var3") ("`p'") ///
. //                                              (`b') (`se') (`pval') ///
. //                                              (`F3') (`rkf') (`N_fs')
. //      }
. //
. //      *========= var5 first stage ===================================================
. //      estimates restore _ivreg2_var5
. //      local N_fs = e(N)
. //
. //      foreach p in var6 var7 var4 {
. //              local b    = _b[`p']
. //              local se   = _se[`p']
. //              local t    = `b'/`se'
. //              local pval = 2*ttail(e(df_r), abs(`t'))
. //
. //              post handle_fs ("`tag'") ("`y'") ("var5") ("`p'") ///
. //                                              (`b') (`se') (`pval') ///
. //                                              (`F5') (`rkf') (`N_fs')
. //      }
. //
. // }
. //
. //
. // //-------------------------------------------------------------
. // // Time FE ("time")
. // //-------------------------------------------------------------
. // local feopt "absorb(yh)"
. // local tag   "time"
. //
. // foreach y of local outcomes {
. //     use "$processed_data/user_panel_`panel_variant'.dta", clear
. //
. //         gen var8 = remote * startup
. //         gen var9 = teleworkable*startup
. //
. //     summarize `y' if covid == 0, meanonly
. //     local pre_mean = r(mean)
. //      
. //     display as text ">> FE spec: time  (tag=`tag')"
. //     display as text "   – outcome: `y'"
. //
. //     // OLS
. //     reghdfe `y' var3 var5 var4 remote startup var8 covid, ///
. //         `feopt' vce(cluster user_id)
. //      local N   = e(N)
. //      
. //     foreach p in var3 var5 var4 {
. //         local b    = _b[`p']
. //         local se   = _se[`p']
. //         local t    = `b'/`se'
. //         local pval = 2*ttail(e(df_r), abs(`t'))
. //
. //                 post handle ("OLS") ("`tag'") ("`y'") ("`p'") ///
. //                                         (`b') (`se') (`pval') (`pre_mean') ///
. //                                         (.) (`N')
. //     }
. //
. //     // IV (2nd stage)
. //      ivreghdfe ///
. //         `y' (var3 var5 var8 remote = var6 var7 var9 teleworkable) var4 startup covid, ///
. //         `feopt' vce(cluster user_id) savefirst
. //              
. //     local rkf = e(rkf)
. //      local N   = e(N)
. //      
. //     foreach p in var3 var5 var4 {
. //         local b    = _b[`p']
. //         local se   = _se[`p']
. //         local t    = `b'/`se'
. //         local pval = 2*ttail(e(df_r), abs(`t'))
. //                 post handle ("IV") ("`tag'") ("`y'") ("`p'") ///
. //                                         (`b') (`se') (`pval') (`pre_mean') ///
. //                                         (`rkf') (`N')
. //     }
. //
. //      *--- pull partial F's from the stacked matrix
. //      matrix FS = e(first)
. //      local F3 = FS[4,1]
. //      local F5 = FS[4,2]
. //
. //      *========= var3 first stage ===================================================
. //      estimates restore _ivreg2_var3
. //      local N_fs = e(N)
. //
. //      foreach p in var6 var7 var4 {
. //              local b    = _b[`p']
. //              local se   = _se[`p']
. //              local t    = `b'/`se'
. //              local pval = 2*ttail(e(df_r), abs(`t'))
. //
. //              post handle_fs ("`tag'") ("`y'") ("var3") ("`p'") ///
. //                                              (`b') (`se') (`pval') ///
. //                                              (`F3') (`rkf') (`N_fs')
. //      }
. //
. //      *========= var5 first stage ===================================================
. //      estimates restore _ivreg2_var5
. //      local N_fs = e(N)
. //
. //      foreach p in var6 var7 var4 {
. //              local b    = _b[`p']
. //              local se   = _se[`p']
. //              local t    = `b'/`se'
. //              local pval = 2*ttail(e(df_r), abs(`t'))
. //
. //              post handle_fs ("`tag'") ("`y'") ("var5") ("`p'") ///
. //                                              (`b') (`se') (`pval') ///
. //                                              (`F5') (`rkf') (`N_fs')
. //      }
. //
. // }
. //
. // //-------------------------------------------------------------
. // // Firm FE ("firm")
. // //-------------------------------------------------------------
. // local feopt "absorb(firm_id)"
. // local tag   "firm"
. //
. // foreach y of local outcomes {
. //     use "$processed_data/user_panel_`panel_variant'.dta", clear
. //
. //     display as text ">> FE spec: firm  (tag=`tag')"
. //     display as text "   – outcome: `y'"
. //
. //     summarize `y' if covid == 0, meanonly
. //     local pre_mean = r(mean)
. //
. //     // OLS
. //      reghdfe `y' var3 var5 var4 covid, ///
. //         `feopt' vce(cluster user_id)
. //      
. //      local N   = e(N)
. //      
. //     foreach p in var3 var5 var4 {
. //         local b    = _b[`p']
. //         local se   = _se[`p']
. //         local t    = `b'/`se'
. //         local pval = 2*ttail(e(df_r), abs(`t'))
. //
. //                 post handle ("OLS") ("`tag'") ("`y'") ("`p'") ///
. //                                         (`b') (`se') (`pval') (`pre_mean') ///
. //                                         (.) (`N')
. //     }
. //
. //     // IV (2nd stage)
. //      ivreghdfe ///
. //         `y' (var3 var5 = var6 var7) var4 covid, ///
. //         `feopt' vce(cluster user_id) savefirst
. //              
. //     local rkf = e(rkf)
. //      local N   = e(N)
. //      
. //     foreach p in var3 var5 var4 {
. //         local b    = _b[`p']
. //         local se   = _se[`p']
. //         local t    = `b'/`se'
. //         local pval = 2*ttail(e(df_r), abs(`t'))
. //                 post handle ("IV") ("`tag'") ("`y'") ("`p'") ///
. //                                         (`b') (`se') (`pval') (`pre_mean') ///
. //                                         (`rkf') (`N')
. //     }
. //
. //      *--- pull partial F's from the stacked matrix
. //      matrix FS = e(first)
. //      local F3 = FS[4,1]
. //      local F5 = FS[4,2]
. //
. //      *========= var3 first stage ===================================================
. //      estimates restore _ivreg2_var3
. //      local N_fs = e(N)
. //
. //      foreach p in var6 var7 var4 {
. //              local b    = _b[`p']
. //              local se   = _se[`p']
. //              local t    = `b'/`se'
. //              local pval = 2*ttail(e(df_r), abs(`t'))
. //
. //              post handle_fs ("`tag'") ("`y'") ("var3") ("`p'") ///
. //                                              (`b') (`se') (`pval') ///
. //                                              (`F3') (`rkf') (`N_fs')
. //      }
. //
. //      *========= var5 first stage ===================================================
. //      estimates restore _ivreg2_var5
. //      local N_fs = e(N)
. //
. //      foreach p in var6 var7 var4 {
. //              local b    = _b[`p']
. //              local se   = _se[`p']
. //              local t    = `b'/`se'
. //              local pval = 2*ttail(e(df_r), abs(`t'))
. //
. //              post handle_fs ("`tag'") ("`y'") ("var5") ("`p'") ///
. //                                              (`b') (`se') (`pval') ///
. //                                              (`F5') (`rkf') (`N_fs')
. //      }
. //
. // }
. //
. // //-------------------------------------------------------------
. // // No FE ("none")
. // //-------------------------------------------------------------
. // local feopt ""
. // local tag   "none"
. //
. // foreach y of local outcomes {
. //     use "$processed_data/user_panel_`panel_variant'.dta", clear
. //      
. //      gen var8 = remote * startup
. //     gen var9 = teleworkable*startup
. //
. //     summarize `y' if covid == 0, meanonly
. //     local pre_mean = r(mean)
. //
. //     display as text ">> FE spec: none  (tag=`tag')"
. //     display as text "   – outcome: `y'"
. //
. //     // OLS
. //     reghdfe `y' var3 var5 var4 remote startup var8 covid, ///
. //         absorb() vce(cluster user_id)
. //              
. //      local N   = e(N)
. //      
. //     foreach p in var3 var5 var4 {
. //         local b    = _b[`p']
. //         local se   = _se[`p']
. //         local t    = `b'/`se'
. //         local pval = 2*ttail(e(df_r), abs(`t'))
. //
. //                 post handle ("OLS") ("`tag'") ("`y'") ("`p'") ///
. //                                         (`b') (`se') (`pval') (`pre_mean') ///
. //                                         (.) (`N')
. //     }
. //
. //     // IV (2nd stage)
. //     ivreghdfe ///
. //         `y' (var3 var5 var8 remote = var6 var7 var9 teleworkable) var4 startup covid, ///
. //         absorb() vce(cluster user_id) savefirst
. //     local rkf = e(rkf)
. //      local N   = e(N)
. //      
. //     foreach p in var3 var5 var4 {
. //         local b    = _b[`p']
. //         local se   = _se[`p']
. //         local t    = `b'/`se'
. //         local pval = 2*ttail(e(df_r), abs(`t'))
. //                 post handle ("IV") ("`tag'") ("`y'") ("`p'") ///
. //                                         (`b') (`se') (`pval') (`pre_mean') ///
. //                                         (`rkf') (`N')
. //     }
. //
. //      *--- pull partial F's from the stacked matrix
. //      matrix FS = e(first)
. //      local F3 = FS[4,1]
. //      local F5 = FS[4,2]
. //
. //      *========= var3 first stage ===================================================
. //      estimates restore _ivreg2_var3
. //      local N_fs = e(N)
. //
. //      foreach p in var6 var7 var4 {
. //              local b    = _b[`p']
. //              local se   = _se[`p']
. //              local t    = `b'/`se'
. //              local pval = 2*ttail(e(df_r), abs(`t'))
. //
. //              post handle_fs ("`tag'") ("`y'") ("var3") ("`p'") ///
. //                                              (`b') (`se') (`pval') ///
. //                                              (`F3') (`rkf') (`N_fs')
. //      }
. //
. //      *========= var5 first stage ===================================================
. //      estimates restore _ivreg2_var5
. //      local N_fs = e(N)
. //
. //      foreach p in var6 var7 var4 {
. //              local b    = _b[`p']
. //              local se   = _se[`p']
. //              local t    = `b'/`se'
. //              local pval = 2*ttail(e(df_r), abs(`t'))
. //
. //              post handle_fs ("`tag'") ("`y'") ("var5") ("`p'") ///
. //                                              (`b') (`se') (`pval') ///
. //                                              (`F5') (`rkf') (`N_fs')
. //      }
. //
. // }
. //
. //
. //
. // local feopt "absorb(firm_id user_id industry_id#yh)"
. // local tag   "industrytime"
. //
. //
. // foreach y of local outcomes {
. //     use "$processed_data/user_panel_`panel_variant'.dta", clear
. //     display as text ">> FE spec: (tag=`tag')"
. //     display as text "   – outcome: `y'"
. //
. //     summarize `y' if covid == 0, meanonly
. //     local pre_mean = r(mean)
. //
. //     // OLS
. //      reghdfe `y' var3 var5 var4, ///
. //         `feopt' vce(cluster user_id)
. //              
. //      local N = e(N)  
. //      
. //     foreach p in var3 var5 var4 {
. //         local b    = _b[`p']
. //         local se   = _se[`p']
. //         local t    = `b'/`se'
. //         local pval = 2*ttail(e(df_r), abs(`t'))
. //
. //                 post handle ("OLS") ("`tag'") ("`y'") ("`p'") ///
. //                                         (`b') (`se') (`pval') (`pre_mean') ///
. //                                         (.) (`N')
. //     }
. //
. //     // IV (2nd stage)
. //      ivreghdfe ///
. //         `y' (var3 var5 = var6 var7) var4, ///
. //         `feopt' vce(cluster user_id) savefirst
. //    
. //      local rkf = e(rkf)
. //      local N = e(N)  
. //      
. //     foreach p in var3 var5 var4 {
. //         local b    = _b[`p']
. //         local se   = _se[`p']
. //         local t    = `b'/`se'
. //         local pval = 2*ttail(e(df_r), abs(`t'))
. //                 post handle ("IV") ("`tag'") ("`y'") ("`p'") ///
. //                                         (`b') (`se') (`pval') (`pre_mean') ///
. //                                         (`rkf') (`N')
. //     }
. //      
. //      *--- pull partial F's from the stacked matrix
. //      matrix FS = e(first)
. //      local F3 = FS[4,1]
. //      local F5 = FS[4,2]
. //
. //      *========= var3 first stage ===================================================
. //      estimates restore _ivreg2_var3
. //      local N_fs = e(N)
. //
. //      foreach p in var6 var7 var4 {
. //              local b    = _b[`p']
. //              local se   = _se[`p']
. //              local t    = `b'/`se'
. //              local pval = 2*ttail(e(df_r), abs(`t'))
. //
. //              post handle_fs ("`tag'") ("`y'") ("var3") ("`p'") ///
. //                                              (`b') (`se') (`pval') ///
. //                                              (`F3') (`rkf') (`N_fs')
. //      }
. //
. //      *========= var5 first stage ===================================================
. //      estimates restore _ivreg2_var5
. //      local N_fs = e(N)
. //
. //      foreach p in var6 var7 var4 {
. //              local b    = _b[`p']
. //              local se   = _se[`p']
. //              local t    = `b'/`se'
. //              local pval = 2*ttail(e(df_r), abs(`t'))
. //
. //              post handle_fs ("`tag'") ("`y'") ("var5") ("`p'") ///
. //                                              (`b') (`se') (`pval') ///
. //                                              (`F5') (`rkf') (`N_fs')
. //      }
. //
. // }
. //
. //
. // local feopt "absorb(firm_id user_id msa_id#yh)"
. // local tag   "msatime"
. //
. //
. // foreach y of local outcomes {
. //     use "$processed_data/user_panel_`panel_variant'.dta", clear
. //     display as text ">> FE spec: (tag=`tag')"
. //     display as text "   – outcome: `y'"
. //
. //     summarize `y' if covid == 0, meanonly
. //     local pre_mean = r(mean)
. //
. //     // OLS
. //      reghdfe `y' var3 var5 var4, ///
. //         `feopt' vce(cluster user_id)
. //              
. //      local N = e(N)  
. //      
. //     foreach p in var3 var5 var4 {
. //         local b    = _b[`p']
. //         local se   = _se[`p']
. //         local t    = `b'/`se'
. //         local pval = 2*ttail(e(df_r), abs(`t'))
. //
. //                 post handle ("OLS") ("`tag'") ("`y'") ("`p'") ///
. //                                         (`b') (`se') (`pval') (`pre_mean') ///
. //                                         (.) (`N')
. //     }
. //
. //     // IV (2nd stage)
. //      ivreghdfe ///
. //         `y' (var3 var5 = var6 var7) var4, ///
. //         `feopt' vce(cluster user_id) savefirst
. //    
. //      local rkf = e(rkf)
. //      local N = e(N)  
. //      
. //     foreach p in var3 var5 var4 {
. //         local b    = _b[`p']
. //         local se   = _se[`p']
. //         local t    = `b'/`se'
. //         local pval = 2*ttail(e(df_r), abs(`t'))
. //                 post handle ("IV") ("`tag'") ("`y'") ("`p'") ///
. //                                         (`b') (`se') (`pval') (`pre_mean') ///
. //                                         (`rkf') (`N')
. //     }
. //      
. //      *--- pull partial F's from the stacked matrix
. //      matrix FS = e(first)
. //      local F3 = FS[4,1]
. //      local F5 = FS[4,2]
. //
. //      *========= var3 first stage ===================================================
. //      estimates restore _ivreg2_var3
. //      local N_fs = e(N)
. //
. //      foreach p in var6 var7 var4 {
. //              local b    = _b[`p']
. //              local se   = _se[`p']
. //              local t    = `b'/`se'
. //              local pval = 2*ttail(e(df_r), abs(`t'))
. //
. //              post handle_fs ("`tag'") ("`y'") ("var3") ("`p'") ///
. //                                              (`b') (`se') (`pval') ///
. //                                              (`F3') (`rkf') (`N_fs')
. //      }
. //
. //      *========= var5 first stage ===================================================
. //      estimates restore _ivreg2_var5
. //      local N_fs = e(N)
. //
. //      foreach p in var6 var7 var4 {
. //              local b    = _b[`p']
. //              local se   = _se[`p']
. //              local t    = `b'/`se'
. //              local pval = 2*ttail(e(df_r), abs(`t'))
. //
. //              post handle_fs ("`tag'") ("`y'") ("var5") ("`p'") ///
. //                                              (`b') (`se') (`pval') ///
. //                                              (`F5') (`rkf') (`N_fs')
. //      }
. //
. // }
. //
. //
. //
. //
. // local feopt "absorb(firm_id user_id msa_id#industry_id#yh)"
. // local tag   "msaindustrytime"
. //
. //
. // foreach y of local outcomes {
. //     use "$processed_data/user_panel_`panel_variant'.dta", clear
. //     display as text ">> FE spec: (tag=`tag')"
. //     display as text "   – outcome: `y'"
. //
. //     summarize `y' if covid == 0, meanonly
. //     local pre_mean = r(mean)
. //
. //     // OLS
. //      reghdfe `y' var3 var5 var4, ///
. //         `feopt' vce(cluster user_id)
. //              
. //      local N = e(N)  
. //      
. //     foreach p in var3 var5 var4 {
. //         local b    = _b[`p']
. //         local se   = _se[`p']
. //         local t    = `b'/`se'
. //         local pval = 2*ttail(e(df_r), abs(`t'))
. //
. //                 post handle ("OLS") ("`tag'") ("`y'") ("`p'") ///
. //                                         (`b') (`se') (`pval') (`pre_mean') ///
. //                                         (.) (`N')
. //     }
. //
. //     // IV (2nd stage)
. //      ivreghdfe ///
. //         `y' (var3 var5 = var6 var7) var4, ///
. //         `feopt' vce(cluster user_id) savefirst
. //    
. //      local rkf = e(rkf)
. //      local N = e(N)  
. //      
. //     foreach p in var3 var5 var4 {
. //         local b    = _b[`p']
. //         local se   = _se[`p']
. //         local t    = `b'/`se'
. //         local pval = 2*ttail(e(df_r), abs(`t'))
. //                 post handle ("IV") ("`tag'") ("`y'") ("`p'") ///
. //                                         (`b') (`se') (`pval') (`pre_mean') ///
. //                                         (`rkf') (`N')
. //     }
. //      
. //      *--- pull partial F's from the stacked matrix
. //      matrix FS = e(first)
. //      local F3 = FS[4,1]
. //      local F5 = FS[4,2]
. //
. //      *========= var3 first stage ===================================================
. //      estimates restore _ivreg2_var3
. //      local N_fs = e(N)
. //
. //      foreach p in var6 var7 var4 {
. //              local b    = _b[`p']
. //              local se   = _se[`p']
. //              local t    = `b'/`se'
. //              local pval = 2*ttail(e(df_r), abs(`t'))
. //
. //              post handle_fs ("`tag'") ("`y'") ("var3") ("`p'") ///
. //                                              (`b') (`se') (`pval') ///
. //                                              (`F3') (`rkf') (`N_fs')
. //      }
. //
. //      *========= var5 first stage ===================================================
. //      estimates restore _ivreg2_var5
. //      local N_fs = e(N)
. //
. //      foreach p in var6 var7 var4 {
. //              local b    = _b[`p']
. //              local se   = _se[`p']
. //              local t    = `b'/`se'
. //              local pval = 2*ttail(e(df_r), abs(`t'))
. //
. //              post handle_fs ("`tag'") ("`y'") ("var5") ("`p'") ///
. //                                              (`b') (`se') (`pval') ///
. //                                              (`F5') (`rkf') (`N_fs')
. //      }
. //
. // }
. //
. 
. 
. 
. //-------------------------------------------------------------
. // Close & export CSV
. //-------------------------------------------------------------
. postclose handle

. use `out', clear

. export delimited using "`result_dir'/consolidated_results.csv", ///
>     replace delimiter(",") quote
file ../results/raw/user_productivity_alternative_fe_precovid/consolidated_results.csv saved

.         
. *------------------------------------------------------------
. *  Write first-stage CSV to disk
. *------------------------------------------------------------
. postclose handle_fs

. use `out_fs', clear

. export delimited using "`result_dir'/first_stage_fstats.csv", ///
>         replace delimiter(",") quote
file ../results/raw/user_productivity_alternative_fe_precovid/first_stage_fstats.csv saved

.                 
. 
. display as result "→ main CSV       : `result_dir'/consolidated_results.csv"
→ main CSV       : ../results/raw/user_productivity_alternative_fe_precovid/consolidated_results.csv

. display as result "→ first-stage CSV: `result_dir'/first_stage_fstats.csv"
→ first-stage CSV: ../results/raw/user_productivity_alternative_fe_precovid/first_stage_fstats.csv

. 
. log close
      name:  <unnamed>
       log:  /Users/saul/Dropbox/Remote Work Startups/main/spec/log/user_productivity_alternative_fe_precovid.log
  log type:  text
 closed on:  26 Jun 2025, 10:49:56
-----------------------------------------------------------------------------------------------------------------------------------------
