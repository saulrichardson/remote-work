---------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/saul/Dropbox/Remote Work Startups/main/spec/log/remote_growth_specs_precovid.log
  log type:  text
 opened on:  11 Jul 2025, 12:03:06

. 
. *--------------------------------------------------------------------*
. * 1) Globals & result folder ---------------------------------------*
. *--------------------------------------------------------------------*
. do "../src/globals.do"                     // defines $processed_data, $results

. global raw_data "../data/raw"

. global processed_data  "../data/processed"

. global results "../results/raw"

. global clean_results "../results/cleaned"

. 
. 
. 
. 
. 
end of do-file

. local result_dir "$results/`specname'"

. cap mkdir "`result_dir'"

. 
. *--------------------------------------------------------------------*
. * 2) Load user panel once ------------------------------------------*
. *--------------------------------------------------------------------*
. use "$processed_data/user_panel_`panel_variant'.dta", clear

. tempfile userpanel

. save `userpanel', replace                     // keep a pristine copy
(file /var/folders/hg/s3xm9w393gxby64_zklmhgbc0000gn/T//S_20662.000001 not found)
file /var/folders/hg/s3xm9w393gxby64_zklmhgbc0000gn/T//S_20662.000001 saved as .dta format

. 
. *--------------------------------------------------------------------*
. * 3) Create company-level Covid-period growth -----------------------*
. *--------------------------------------------------------------------*
. tempfile industries industry_growth industry_growth_yh ///
>     company_growth company_growth_yh ///
>     msa_growth_yh size_yh ///
>     firm_growth

. 
. * 3a. map companies → industry & MSA
. preserve

.     collapse (last) industry (last) company_msa, by(companyname)

.     keep companyname industry company_msa

.     save `industries', replace
(file /var/folders/hg/s3xm9w393gxby64_zklmhgbc0000gn/T//S_20662.000002 not found)
file /var/folders/hg/s3xm9w393gxby64_zklmhgbc0000gn/T//S_20662.000002 saved as .dta format

. restore

. 
. * 3b. bring in Scoop head-count file once
. import delimited "$processed_data/Scoop_Positions_Firm_Collapse2.csv", clear
(encoding automatically selected: ISO-8859-1)
(6 vars, 323,675 obs)

. drop v1

. gen date_numeric = date(date, "YMD")

. drop date

. rename date_numeric date

. format date %td

. 
. gen yh = hofd(date)

. gen year = yofd(date)

. format yh %th

. 
. gen byte covid = yh >= 120                 // 2020-H1 and after

. 
. *── 3c. INDUSTRY‐growth by half‐year ───────────────────────────────*
. preserve

.     merge m:1 companyname using `industries', nogenerate

    Result                      Number of obs
    -----------------------------------------
    Not matched                       153,494
        from master                   153,494  
        from using                          0  

    Matched                           170,181  
    -----------------------------------------

.     collapse (last) total_employees covid industry, by(yh companyname)

.     encode companyname, gen(company_numeric)

.         xtset company_numeric yh

Panel variable: company_numeric (unbalanced)
 Time variable: yh, 2016h1 to 2022h1, but with gaps
         Delta: 1 halfyear

.     gen fg = (total_employees/L.total_employees)-1 if _n>1
(4,416 missing values generated)

.     winsor2 fg, cuts(1 99) suffix(_we)

.     * now average over firms within each industry×yh *
.     collapse (mean) fg_we if covid, by(industry yh)

.     rename fg_we ind_growth_favg_yh

.     save `industry_growth_yh', replace
(file /var/folders/hg/s3xm9w393gxby64_zklmhgbc0000gn/T//S_20662.000004 not found)
file /var/folders/hg/s3xm9w393gxby64_zklmhgbc0000gn/T//S_20662.000004 saved as .dta format

. restore

. 
. *── 3d. COMPANY‐growth by half‐year ────────────────────────────────*
. preserve

.     merge m:1 companyname using `industries', nogenerate

    Result                      Number of obs
    -----------------------------------------
    Not matched                       153,494
        from master                   153,494  
        from using                          0  

    Matched                           170,181  
    -----------------------------------------

.     collapse (last) total_employees covid, by(yh companyname)

.     encode companyname, gen(company_numeric)

.         xtset company_numeric yh

Panel variable: company_numeric (unbalanced)
 Time variable: yh, 2016h1 to 2022h1, but with gaps
         Delta: 1 halfyear

.     gen growth = (total_employees/L.total_employees)-1 if _n>1
(4,416 missing values generated)

.     winsor2 growth, cuts(1 99) suffix(_we)

.     * now average over that firm×yh *
.     collapse (mean) growth_we if covid, by(companyname yh)

.     rename growth_we growth_rate_we_post_c_yh

.     save `company_growth_yh', replace
(file /var/folders/hg/s3xm9w393gxby64_zklmhgbc0000gn/T//S_20662.000006 not found)
file /var/folders/hg/s3xm9w393gxby64_zklmhgbc0000gn/T//S_20662.000006 saved as .dta format

. restore

. 
. *── 3e. MSA‐growth by half‐year ────────────────────────────────────*
. preserve

.     merge m:1 companyname using `industries', nogenerate

    Result                      Number of obs
    -----------------------------------------
    Not matched                       153,494
        from master                   153,494  
        from using                          0  

    Matched                           170,181  
    -----------------------------------------

.     collapse (last) total_employees covid company_msa, by(yh companyname)

.     encode companyname, gen(company_numeric)

.         xtset company_numeric yh

Panel variable: company_numeric (unbalanced)
 Time variable: yh, 2016h1 to 2022h1, but with gaps
         Delta: 1 halfyear

.     gen fg = (total_employees/L.total_employees)-1 if _n>1
(4,420 missing values generated)

.     winsor2 fg, cuts(1 99) suffix(_we)

.     * now average over that MSA×yh *
.     collapse (mean) fg_we if covid, by(company_msa yh)

.     rename fg_we msa_growth_favg_yh

.     save `msa_growth_yh', replace
(file /var/folders/hg/s3xm9w393gxby64_zklmhgbc0000gn/T//S_20662.000007 not found)
file /var/folders/hg/s3xm9w393gxby64_zklmhgbc0000gn/T//S_20662.000007 saved as .dta format

. restore

. 
. 
. *── 3f. Firm size by half-year ─────────────────────────────────────*
. preserve

.     // start from the same scoop dataset you used for growth
.     import delimited "$processed_data/Scoop_Positions_Firm_Collapse2.csv", clear
(encoding automatically selected: ISO-8859-1)
(6 vars, 323,675 obs)

.     drop v1

.     gen date_numeric = date(date, "YMD")

.     drop date

.     rename date_numeric date

.     format date %td

. 
.     gen yh = hofd(date)

.     format yh %th

. 
.     // grab the last head-count in each half-year for each firm
.     collapse (last) total_employees, by(yh companyname)

.     rename total_employees emp_yh

. 
.     save `size_yh', replace
(file /var/folders/hg/s3xm9w393gxby64_zklmhgbc0000gn/T//S_20662.000008 not found)
file /var/folders/hg/s3xm9w393gxby64_zklmhgbc0000gn/T//S_20662.000008 saved as .dta format

. restore

. 
. 
. *--------------------------------------------------------------------*
. * 3e. Combine for leave-out means & growth bins ---------------------*
. *--------------------------------------------------------------------*
. use `company_growth_yh', clear   // now one row per firm×yh

. merge m:1 companyname using `industries', nogenerate

    Result                      Number of obs
    -----------------------------------------
    Not matched                        10,512
        from master                    10,512  
        from using                          0  

    Matched                            11,119  
    -----------------------------------------

. merge m:1 industry   yh  using `industry_growth_yh', nogenerate

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                            21,631  
    -----------------------------------------

. merge m:1 company_msa yh using `msa_growth_yh', nogenerate

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                            21,631  
    -----------------------------------------

. merge m:1 companyname yh using `size_yh', nogenerate

    Result                      Number of obs
    -----------------------------------------
    Not matched                        32,544
        from master                         0  
        from using                     32,544  

    Matched                            21,631  
    -----------------------------------------

. 
. *--------------------------------------------------------------------
. * Jackknife (leave-one-out) group means for instruments
. *--------------------------------------------------------------------
. 
. * Leave-one-out industry mean in each yh *
. bysort industry yh: egen ind_sum_yh = total(ind_growth_favg_yh)

. bysort industry yh: egen ind_n_yh   = count(ind_growth_favg_yh)

. gen   avg_ind_yh = (ind_sum_yh - ind_growth_favg_yh) / (ind_n_yh - 1) ///
>       if ind_n_yh>1
(32,544 missing values generated)

. 
. * Leave-one-out MSA mean in each yh *
. bysort company_msa yh: egen msa_sum_yh = total(msa_growth_favg_yh)

. bysort company_msa yh: egen msa_n_yh   = count(msa_growth_favg_yh)

. gen   avg_msa_yh = (msa_sum_yh - msa_growth_favg_yh)/(msa_n_yh-1) if msa_n_yh>1
(32,838 missing values generated)

. 
.           
. egen growth_bin_yh = xtile(growth_rate_we_post_c_yh), by(yh) nq(2)
(32,672 missing values generated)

. egen ind_bin_yh    = xtile(avg_ind_yh),                by(yh) nq(2)
(32,544 missing values generated)

. egen msa_bin_yh    = xtile(avg_msa_yh),                by(yh) nq(2)
(32,838 missing values generated)

. egen size_bin_yh   = xtile(emp_yh),                    by(yh) nq(2)

. 
. 
. 
. // capture drop ind_sum_raw ind_n_raw ind_sum_favg ind_n_favg
. 
. *--- CREATE the series you'll use in the tile regression -------------
. // gen   avg_ind_yh = avg_ind_favg_lo_yh    
. 
. 
. 
. // keep companyname growth_rate_we_post_c avg_ind avg_ind_favg_lo avg_msa 
. 
. save `firm_growth', replace
(file /var/folders/hg/s3xm9w393gxby64_zklmhgbc0000gn/T//S_20662.000009 not found)
file /var/folders/hg/s3xm9w393gxby64_zklmhgbc0000gn/T//S_20662.000009 saved as .dta format

. 
end of do-file

. do "/var/folders/hg/s3xm9w393gxby64_zklmhgbc0000gn/T//SD20662.000000"

. collapse (mean) avg_ind_yh avg_msa_yh, by(companyname)

. 
end of do-file

. save "/Users/saul/Dropbox/Remote Work Startups/main/spec/jackknife.dta"
file /Users/saul/Dropbox/Remote Work Startups/main/spec/jackknife.dta saved

. do "/var/folders/hg/s3xm9w393gxby64_zklmhgbc0000gn/T//SD20662.000000"

. *============================================================*
. * do/user_mechanisms_regressions.do
. *  — Automated export of OLS, IV & first-stage F's
. *    across 8 specification columns
. *============================================================*
. 
. capture log close
