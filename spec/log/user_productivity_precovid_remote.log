---------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/saul/Dropbox/Remote Work Startups/main/spec/log/user_productivity_precovid_remote.log
  log type:  text
 opened on:  22 Sep 2025, 22:56:03

. 
. // Setup environment
. do "../src/globals.do"

. global raw_data "../data/raw"

. global processed_data  "../data/processed"

. global results "../results/raw"

. global clean_results "../results/cleaned"

. 
. 
. 
. 
. 
end of do-file

. 
. // Load worker-level panel
. use "$processed_data/user_panel_`panel_variant'.dta", clear

. 
. // Prepare output directory
. local result_dir "$results/`specname'"

. capture mkdir "`result_dir'"

. 
. capture postclose handle

. tempfile out

. postfile handle ///
>     str8   model_type ///
>     str40  outcome     ///
>     str40  param       ///
>     double coef se pval pre_mean ///
>     double rkf nobs ///
>     using `out', replace
(file /var/folders/hg/s3xm9w393gxby64_zklmhgbc0000gn/T//S_61160.000001 not found)

. 
. // First-stage capture
. tempfile out_fs

. capture postclose handle_fs

. postfile handle_fs ///
>     str8   endovar ///
>     str40  param   ///
>     double coef se pval ///
>     double partialF rkf nobs ///
>     using `out_fs', replace
(file /var/folders/hg/s3xm9w393gxby64_zklmhgbc0000gn/T//S_61160.000002 not found)

. 
. // Construct treatment
. if "`treat'" == "remote" {
.     tempvar flag
.     capture drop var3_remote var5_remote
.     gen byte `flag' = remote == 1
.     gen var3_remote = `flag' * covid
.     gen var5_remote = `flag' * covid * startup
.     local v3 "var3_remote"
.     local v5 "var5_remote"
. }

. else if "`treat'" == "nonremote" {
.     tempvar flag
.     capture drop var3_nonremote var5_nonremote
.     gen byte `flag' = remote < 1
.     gen var3_nonremote = `flag' * covid
.     gen var5_nonremote = `flag' * covid * startup
.     local v3 "var3_nonremote"
.     local v5 "var5_nonremote"
. }

. else {
.     di as error "Unknown treat=`treat'—must be remote or nonremote"
.     exit 1
. }

. 
. local outcomes total_contributions_q100

. 
. foreach y of local outcomes {
  2.     di as text "→ Processing outcome: `y'"
  3. 
.     summarize `y' if covid == 0, meanonly
  4.     local pre_mean = r(mean)
  5. 
.     // OLS
.     reghdfe `y' `v3' `v5' var4, absorb(user_id#firm_id yh) vce(cluster user_id)
  6.     local N = e(N)
  7. 
.     foreach p in `v3' `v5' var4 {
  8.         local b    = _b[`p']
  9.         local se   = _se[`p']
 10.         local t    = `b'/`se'
 11.         local pval = 2*ttail(e(df_r), abs(`t'))
 12.         post handle ("OLS") ("`y'") ("`p'") (`b') (`se') (`pval') (`pre_mean') (.) (`N')
 13.     }
 14. 
.     // IV second stage
.     ivreghdfe `y' (`v3' `v5' = var6 var7) var4, absorb(user_id#firm_id yh) vce(cluster user_id) savefirst
 15.     local rkf = e(rkf)
 16.     local N = e(N)
 17. 
.     foreach p in `v3' `v5' var4 {
 18.         local b    = _b[`p']
 19.         local se   = _se[`p']
 20.         local t    = `b'/`se'
 21.         local pval = 2*ttail(e(df_r), abs(`t'))
 22.         post handle ("IV") ("`y'") ("`p'") (`b') (`se') (`pval') (`pre_mean') (`rkf') (`N')
 23.     }
 24. 
.     // First-stage exports
.     estimates restore _ivreg2_var3
 25.     if _rc { continue }
 26.     matrix FS = e(first)
 27.     local F3 = FS[4,1]
 28.     local N_fs = e(N)
 29.     foreach p in var6 var7 var4 {
 30.         local b    = _b[`p']
 31.         local se   = _se[`p']
 32.         local pval = 2*ttail(e(df_r), abs(`b'/`se'))
 33.         post handle_fs ("`v3'") ("`p'") (`b') (`se') (`pval') (`F3') (`rkf') (`N_fs')
 34.     }
 35. 
.     estimates restore _ivreg2_var5
 36.     if _rc { continue }
 37.     matrix FS = e(first)
 38.     local F5 = FS[4,1]
 39.     local N_fs = e(N)
 40.     foreach p in var6 var7 var4 {
 41.         local b    = _b[`p']
 42.         local se   = _se[`p']
 43.         local pval = 2*ttail(e(df_r), abs(`b'/`se'))
 44.         post handle_fs ("`v5'") ("`p'") (`b') (`se') (`pval') (`F5') (`rkf') (`N_fs')
 45.     }
 46. }
→ Processing outcome: total_contributions_q100
(dropped 6597 singleton observations)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   =    224,708
Absorbing 2 HDFE groups                           F(   3,  35478) =      16.32
Statistics robust to heteroskedasticity           Prob > F        =     0.0000
                                                  R-squared       =     0.7185
                                                  Adj R-squared   =     0.6525
                                                  Within R-sq.    =     0.0006
Number of clusters (user_id) =     35,479         Root MSE        =    17.6445

                           (Std. err. adjusted for 35,479 clusters in user_id)
------------------------------------------------------------------------------
             |               Robust
total_co~100 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
 var3_remote |  -.8558645   .3097593    -2.76   0.006    -1.463002   -.2487266
 var5_remote |   3.393155   .7075814     4.80   0.000     2.006274    4.780036
        var4 |  -3.734481   .5615355    -6.65   0.000    -4.835108   -2.633854
       _cons |   50.28975   .0580739   865.96   0.000     50.17592    50.40357
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------------+
       Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------------+---------------------------------------|
   user_id#firm_id |     42710       42710           0    *|
                yh |        11           1          10     |
-----------------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
(dropped 6597 singleton observations)
(MWFE estimator converged in 8 iterations)

Stored estimation results
-------------------------
----------------------------------------------------------------------------------
             |           Dependent  Number of        
        Name | Command    variable     param.  Title 
-------------+--------------------------------------------------------------------
_ivreg2_va~e | ivreg2    var3_remote        3  First-stage regression: var3_remote
_ivreg2_va~e | ivreg2    var5_remote        3  First-stage regression: var5_remote
----------------------------------------------------------------------------------

IV (2SLS) estimation
--------------------

Estimates efficient for homoskedasticity only
Statistics robust to heteroskedasticity and clustering on user_id

Number of clusters (user_id) =   35479                Number of obs =   224708
                                                      F(  3, 35478) =    10.58
                                                      Prob > F      =   0.0000
Total (centered) SS     =  56688987.29                Centered R2   =  -0.0008
Total (uncentered) SS   =  56688987.29                Uncentered R2 =  -0.0008
Residual SS             =  56733371.23                Root MSE      =    15.89

------------------------------------------------------------------------------
             |               Robust
total_co~100 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
 var3_remote |  -4.108658   1.766393    -2.33   0.020    -7.570842   -.6464734
 var5_remote |   5.609267   2.448735     2.29   0.022      .809671    10.40886
        var4 |  -4.143132   1.369743    -3.02   0.002    -6.827871   -1.458392
------------------------------------------------------------------------------
Underidentification test (Kleibergen-Paap rk LM statistic):            594.025
                                                   Chi-sq(1) P-val =    0.0000
------------------------------------------------------------------------------
Weak identification test (Cragg-Donald Wald F statistic):             3790.197
                         (Kleibergen-Paap rk Wald F statistic):        311.512
Stock-Yogo weak ID test critical values: 10% maximal IV size              7.03
                                         15% maximal IV size              4.58
                                         20% maximal IV size              3.95
                                         25% maximal IV size              3.63
Source: Stock-Yogo (2005).  Reproduced by permission.
NB: Critical values are for Cragg-Donald F statistic and i.i.d. errors.
------------------------------------------------------------------------------
Hansen J statistic (overidentification test of all instruments):         0.000
                                                 (equation exactly identified)
------------------------------------------------------------------------------
Instrumented:         var3_remote var5_remote
Included instruments: var4
Excluded instruments: var6 var7
Partialled-out:       _cons
                      nb: total SS, model F and R2s are after partialling-out;
                          any small-sample adjustments include partialled-out
                          variables in regressor count K
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------------+
       Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------------+---------------------------------------|
   user_id#firm_id |     42710       42710           0    *|
                yh |        11           1          10     |
-----------------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
estimation result _ivreg2_var3 not found
r(111);

end of do-file

r(111);

. use "/Users/saul/Dropbox/Remote Work Startups/main/data/raw/AKM/AKM_Estimate_FFE_2016to19.dta", clear

. use "/Users/saul/Dropbox/Remote Work Startups/main/data/raw/AKM/AKM_Estimate_PFE_2013to19.dta"

. use "/Users/saul/Dropbox/Remote Work Startups/main/data/raw/AKM/AKM_Estimate_FFE_2016to19.dta"

. use "/Users/saul/Dropbox/Remote Work Startups/main/data/raw/AKM/AKM_Estimate_PFE_2013to19.dta"

. use "/Users/saul/Dropbox/Remote Work Startups/main/data/processed/user_panel_precovid.dta"

. do "/Users/saul/Dropbox/Remote Work Startups/main/spec/user_event_study_export.do"

. * Export user event-study coefficients for downstream plotting -----------------
. * Usage:  do spec/user_event_study_export.do [panel_variant]
. 
. * 0) Parse optional panel variant argument (default = precovid)
. args panel_variant

. if "`panel_variant'" == "" local panel_variant "precovid"

. 
. local specname "user_event_study_export_`panel_variant'"

. 
. capture log close
