---------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/saul/Dropbox/Remote Work Startups/main/spec/log/user_mechanisms_lean_precovid.log
  log type:  text
 opened on:  18 Jul 2025, 11:56:51

. 
. 
. // 1) Globals + setup
. do "../src/globals.do"

. global raw_data "../data/raw"

. global processed_data  "../data/processed"

. global results "../results/raw"

. global clean_results "../results/cleaned"

. 
. 
. 
. 
. 
end of do-file

. local result_dir "$results/`specname'"

. capture mkdir "`result_dir'"

. 
. // 1) Load & prepare once
. use "$processed_data/user_panel_`panel_variant'.dta", clear

. gen seniority_4 = !inrange(seniority_levels,1,3)

. 
. 
. 
. 
. 
. 
. 
. preserve

. 
. 
. args panel_variant

. if "`panel_variant'" == "" local panel_variant "precovid"

. 
. 
. use "$processed_data/user_panel_`panel_variant'.dta", clear

. collapse (last) industry (last) company_msa (last) hqcity (last) hqstate, by(companyname)

. keep companyname industry company_msa

. tempfile industries

. save `industries', replace
(file /var/folders/hg/s3xm9w393gxby64_zklmhgbc0000gn/T//S_58965.000003 not found)
file /var/folders/hg/s3xm9w393gxby64_zklmhgbc0000gn/T//S_58965.000003 saved as .dta format

. 
. 
. 
. import delimited "$processed_data/Scoop_Positions_Firm_Collapse2.csv", clear
(encoding automatically selected: ISO-8859-1)
(6 vars, 323,675 obs)

. drop v1

. 
. gen date_numeric = date(date, "YMD")

. drop date

. rename date_numeric date

. format date %td

. 
. gen yh = hofd(date)

. gen year = yofd(date)

. format yh %th

. 
. 
. drop if date == 22797
(4,345 observations deleted)

. gen byte covid = yh >= 120     

. 
. merge m:1 companyname using `industries', nogenerate   

    Result                      Number of obs
    -----------------------------------------
    Not matched                       151,372
        from master                   151,372  
        from using                          0  

    Matched                           167,958  
    -----------------------------------------

. 
. 
. 
. collapse (last) total_employees date (sum) join leave (last) covid, by(yh industry)

. 
. 
. // encode companyname, gen(company_numeric)
. // xtset company_numeric yh
. // sort company_numeric yh
. 
. 
. encode industry, gen(industry_numeric)

. xtset industry_numeric yh

Panel variable: industry_numeric (weakly balanced)
 Time variable: yh, 2016h1 to 2022h1
         Delta: 1 halfyear

. sort industry_numeric yh

. 
. gen growth_rate = (total_employees / L.total_employees) - 1 if _n > 1
(20 missing values generated)

. 
. 
. winsor2 growth_rate, cuts(1 99) suffix(_we)

. drop growth_rate

. 
. collapse growth_rate_we, by(industry covid)

. drop if covid == 0
(20 observations deleted)

. 
. rename growth_rate_we growth_rate_we_ind

. drop covid 

. 
. tempfile industry_growth

. save `industry_growth', replace
(file /var/folders/hg/s3xm9w393gxby64_zklmhgbc0000gn/T//S_58965.000004 not found)
file /var/folders/hg/s3xm9w393gxby64_zklmhgbc0000gn/T//S_58965.000004 saved as .dta format

. 
. 
. 
. import delimited "$processed_data/Scoop_Positions_Firm_Collapse2.csv", clear
(encoding automatically selected: ISO-8859-1)
(6 vars, 323,675 obs)

. drop v1

. 
. gen date_numeric = date(date, "YMD")

. drop date

. rename date_numeric date

. format date %td

. 
. gen yh = hofd(date)

. gen year = yofd(date)

. format yh %th

. 
. 
. drop if date == 22797
(4,345 observations deleted)

. gen byte covid = yh >= 120     

. 
. 
. 
. 
. collapse (last) total_employees date (sum) join leave (last) covid, by(yh companyname)

. 
. 
. 
. encode companyname, gen(company_numeric)

. xtset company_numeric yh

Panel variable: company_numeric (unbalanced)
 Time variable: yh, 2016h1 to 2022h1, but with gaps
         Delta: 1 halfyear

. sort company_numeric yh

. 
. 
. 
. gen growth_rate = (total_employees / L.total_employees) - 1 if _n > 1
(4,420 missing values generated)

. 
. 
. winsor2 growth_rate, cuts(1 99) suffix(_we)

. drop growth_rate

. 
. collapse growth_rate_we, by(companyname covid)

. drop if covid == 0
(4,256 observations deleted)

. 
. rename growth_rate_we growth_rate_we_post_c

. 
. drop covid 

. 
. merge m:1 companyname using `industries', nogenerate   

    Result                      Number of obs
    -----------------------------------------
    Not matched                         2,129
        from master                     2,129  
        from using                          0  

    Matched                             2,224  
    -----------------------------------------

. 
. tempfile company_post_growth

. save `company_post_growth', replace
(file /var/folders/hg/s3xm9w393gxby64_zklmhgbc0000gn/T//S_58965.000005 not found)
file /var/folders/hg/s3xm9w393gxby64_zklmhgbc0000gn/T//S_58965.000005 saved as .dta format

. 
. 
. 
. merge m:1 industry using `industry_growth'

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                             4,353  (_merge==3)
    -----------------------------------------

. drop if industry == ""
(2,149 observations deleted)

. 
. 
. bysort company_msa : egen avg_msa = mean(growth_rate_we_post_c)

. bysort industry : egen avg_ind = mean(growth_rate_we_post_c)

. 
. merge m:1 companyname using `extra', nogenerate   

    Result                      Number of obs
    -----------------------------------------
    Not matched                           313
        from master                       293  
        from using                         20  

    Matched                             1,911  
    -----------------------------------------

. drop _merge

. 
. merge m:1 companyname using jackknife.dta 

    Result                      Number of obs
    -----------------------------------------
    Not matched                         2,147
        from master                         0  (_merge==1)
        from using                      2,147  (_merge==2)

    Matched                             2,224  (_merge==3)
    -----------------------------------------

. regress growth_rate_we_post_c rent hhi_1000 avg_ind_yh avg_msa_yh

      Source |       SS           df       MS      Number of obs   =     1,757
-------------+----------------------------------   F(4, 1752)      =    140.84
       Model |    8.628132         4    2.157033   Prob > F        =    0.0000
    Residual |  26.8331549     1,752  .015315728   R-squared       =    0.2433
-------------+----------------------------------   Adj R-squared   =    0.2416
       Total |  35.4612869     1,756  .020194355   Root MSE        =    .12376

------------------------------------------------------------------------------
growth_rat~c | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        rent |   .0006863    .000165     4.16   0.000     .0003625      .00101
    hhi_1000 |    .000046   3.13e-06    14.70   0.000     .0000399    .0000522
  avg_ind_yh |   .6007312   .0641818     9.36   0.000     .4748502    .7266121
  avg_msa_yh |   .4463367   .0663762     6.72   0.000     .3161518    .5765216
       _cons |  -.0452005   .0079248    -5.70   0.000    -.0607436   -.0296574
------------------------------------------------------------------------------

. 
. predict yhat
(option xb assumed; fitted values)
(2,596 missing values generated)

. sum yhat

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
        yhat |      1,775     .090516     .069813  -.1173552   .5916239

. 
. xtile lg_tile = growth_rate_we_post_c, nq(2)

. 
. 
. tempfile firm_growth          // temp filename macro

. save `firm_growth', replace   // dataset lives only this session
(file /var/folders/hg/s3xm9w393gxby64_zklmhgbc0000gn/T//S_58965.000006 not found)
file /var/folders/hg/s3xm9w393gxby64_zklmhgbc0000gn/T//S_58965.000006 saved as .dta format

. 
. 
. 
. restore

. 
. 
. 
. merge m:1 companyname using `firm_growth', nogenerate   
(label _merge already defined)

    Result                      Number of obs
    -----------------------------------------
    Not matched                         2,147
        from master                         0  
        from using                      2,147  

    Matched                           231,305  
    -----------------------------------------

. 
. 
. 
. // xtile lg_tile = growth_rate_we_post_c, nq(2)
. 
. 
. gen var17 = covid*lg_tile
(4,174 missing values generated)

. gen var18 = covid*lg_tile*startup
(4,174 missing values generated)

. // drop var17 var18
. 
. 
. // gen var17 = covid*growth_rate_we_post_c
. // gen var18 = covid*growth_rate_we_post_c*startup
. 
. 
. // ivreghdfe total_contributions_q100 (var3 var5 = var6 var7) var4, ///
. //     absorb(firm_id#user_id yh) vce(cluster user_id) savefirst
.         
. ivreghdfe total_contributions_q100 (var3 var5 = var6 var7) var4 var17 var18, ///
>     absorb(firm_id#user_id yh) vce(cluster user_id) savefirst
(dropped 6557 singleton observations)
(MWFE estimator converged in 8 iterations)

Stored estimation results
-------------------------
---------------------------------------------------------------------------
             |           Dependent  Number of        
        Name | Command    variable     param.  Title 
-------------+-------------------------------------------------------------
_ivreg2_var3 | ivreg2         var3          5  First-stage regression: var3
_ivreg2_var5 | ivreg2         var5          5  First-stage regression: var5
---------------------------------------------------------------------------

IV (2SLS) estimation
--------------------

Estimates efficient for homoskedasticity only
Statistics robust to heteroskedasticity and clustering on user_id

Number of clusters (user_id) =   35221                Number of obs =   222721
                                                      F(  5, 35220) =    13.24
                                                      Prob > F      =   0.0000
Total (centered) SS     =  56209829.19                Centered R2   =  -0.0005
Total (uncentered) SS   =  56209829.19                Uncentered R2 =  -0.0005
Residual SS             =   56238969.5                Root MSE      =    15.89

------------------------------------------------------------------------------
             |               Robust
total_co~100 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        var3 |  -6.522202   4.813701    -1.35   0.175    -15.95721    2.912803
        var5 |   11.54615    6.38924     1.81   0.071    -.9769621    24.06926
        var4 |  -10.01598    3.82911    -2.62   0.009    -17.52115     -2.5108
       var17 |  -1.241986   .5727815    -2.17   0.030    -2.364656   -.1193168
       var18 |   .1312476   1.007144     0.13   0.896    -1.842786    2.105282
------------------------------------------------------------------------------
Underidentification test (Kleibergen-Paap rk LM statistic):            167.639
                                                   Chi-sq(1) P-val =    0.0000
------------------------------------------------------------------------------
Weak identification test (Cragg-Donald Wald F statistic):             1306.252
                         (Kleibergen-Paap rk Wald F statistic):         87.771
Stock-Yogo weak ID test critical values: 10% maximal IV size              7.03
                                         15% maximal IV size              4.58
                                         20% maximal IV size              3.95
                                         25% maximal IV size              3.63
Source: Stock-Yogo (2005).  Reproduced by permission.
NB: Critical values are for Cragg-Donald F statistic and i.i.d. errors.
------------------------------------------------------------------------------
Hansen J statistic (overidentification test of all instruments):         0.000
                                                 (equation exactly identified)
------------------------------------------------------------------------------
Instrumented:         var3 var5
Included instruments: var4 var17 var18
Excluded instruments: var6 var7
Partialled-out:       _cons
                      nb: total SS, model F and R2s are after partialling-out;
                          any small-sample adjustments include partialled-out
                          variables in regressor count K
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------------+
       Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------------+---------------------------------------|
   firm_id#user_id |     42378       42378           0    *|
                yh |        11           1          10     |
-----------------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation

.         
.         
. 
end of do-file

