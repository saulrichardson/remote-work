-----------------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/saul/Dropbox/Remote Work Startups/main/spec/log/user_productivity_alternative_fe_precovid.log
  log type:  text
 opened on:  22 Jun 2025, 18:15:34

. 
. // 0) Setup environment
. do "../src/globals.do"

. global raw_data "../data/raw"

. global processed_data  "../data/processed"

. global results "../results/raw"

. global clean_results "../results/cleaned"

. 
. 
. 
. 
. 
end of do-file

. 
. // 1) Common settings
. local result_dir "$results/`specname'"

. capture mkdir "`result_dir'"

. 
. // -------------------------------------------------------------------------
. // Outcomes to export -------------------------------------------------------
. //   • total_contributions_q100      – Total contributions (pct. rank)
. //   • restricted_contributions_q100 – Restricted contributions (pct. rank)
. //   • total_contributions_we        – Total contributions (winsorised)
. //   • restricted_contributions_we   – Restricted contributions (winsorised)
. // -------------------------------------------------------------------------
. 
. local outcomes total_contributions_q100 ///
>                 restricted_contributions_q100 ///
>                 total_contributions_we ///
>                 restricted_contributions_we

. 
. *--- main results -------------------------------------------------------------
. tempfile out  

. capture postclose handle

. postfile handle ///
>     str20   model_type          ///
>     str20   fe_tag              ///
>     str40  outcome             ///
>     str40  param               ///
>     double coef se pval pre_mean ///
>     double rkf nobs            ///
>     using `out', replace
(file /var/folders/hg/s3xm9w393gxby64_zklmhgbc0000gn/T//S_46739.000001 not found)

. 
. 
. *--- first-stage results (coefficients + diagnostics) -------------------------
. tempfile out_fs

. capture postclose handle_fs

. postfile handle_fs ///
>     str20   fe_tag              ///  "fyh", "time", "firm", "none"
>     str40  outcome             ///
>     str20   endovar             ///  "var3" / "var5"
>     str40  param               ///  var6 / var7 / var4
>     double coef se pval        ///
>     double partialF rkf nobs   ///
>     using `out_fs', replace
(file /var/folders/hg/s3xm9w393gxby64_zklmhgbc0000gn/T//S_46739.000002 not found)

. 
.         
. //-------------------------------------------------------------
. // Firm + user + year FE ("fyh")
. //-------------------------------------------------------------
. local feopt "absorb(firm_id user_id yh)"

. local tag   "fyhu"

. 
. 
. foreach y of local outcomes {
  2.     use "$processed_data/user_panel_`panel_variant'.dta", clear
  3.     display as text ">> FE spec: (tag=`tag')"
  4.     display as text "   – outcome: `y'"
  5. 
.     summarize `y' if covid == 0, meanonly
  6.     local pre_mean = r(mean)
  7. 
.     // OLS
.      reghdfe `y' var3 var5 var4, ///
>         `feopt' vce(cluster user_id)
  8.                 
.         local N = e(N)  
  9.         
.     foreach p in var3 var5 var4 {
 10.         local b    = _b[`p']
 11.         local se   = _se[`p']
 12.         local t    = `b'/`se'
 13.         local pval = 2*ttail(e(df_r), abs(`t'))
 14. 
.                 post handle ("OLS") ("`tag'") ("`y'") ("`p'") ///
>                                         (`b') (`se') (`pval') (`pre_mean') ///
>                                         (.) (`N')
 15.     }
 16. 
.     // IV (2nd stage)
.      ivreghdfe ///
>         `y' (var3 var5 = var6 var7) var4, ///
>         `feopt' vce(cluster user_id) savefirst
 17.     
.         local rkf = e(rkf)
 18.         local N = e(N)  
 19.         
.     foreach p in var3 var5 var4 {
 20.         local b    = _b[`p']
 21.         local se   = _se[`p']
 22.         local t    = `b'/`se'
 23.         local pval = 2*ttail(e(df_r), abs(`t'))
 24.                 post handle ("IV") ("`tag'") ("`y'") ("`p'") ///
>                                         (`b') (`se') (`pval') (`pre_mean') ///
>                                         (`rkf') (`N')
 25.     }
 26.         
.         *--- pull partial F's from the stacked matrix
.         matrix FS = e(first)
 27.         local F3 = FS[4,1]
 28.         local F5 = FS[4,2]
 29. 
.         *========= var3 first stage ===================================================
.         estimates restore _ivreg2_var3
 30.         local N_fs = e(N)
 31. 
.         foreach p in var6 var7 var4 {
 32.                 local b    = _b[`p']
 33.                 local se   = _se[`p']
 34.                 local t    = `b'/`se'
 35.                 local pval = 2*ttail(e(df_r), abs(`t'))
 36. 
.                 post handle_fs ("`tag'") ("`y'") ("var3") ("`p'") ///
>                                                 (`b') (`se') (`pval') ///
>                                                 (`F3') (`rkf') (`N_fs')
 37.         }
 38. 
.         *========= var5 first stage ===================================================
.         estimates restore _ivreg2_var5
 39.         local N_fs = e(N)
 40. 
.         foreach p in var6 var7 var4 {
 41.                 local b    = _b[`p']
 42.                 local se   = _se[`p']
 43.                 local t    = `b'/`se'
 44.                 local pval = 2*ttail(e(df_r), abs(`t'))
 45. 
.                 post handle_fs ("`tag'") ("`y'") ("var5") ("`p'") ///
>                                                 (`b') (`se') (`pval') ///
>                                                 (`F5') (`rkf') (`N_fs')
 46.         }
 47. 
. }
>> FE spec: (tag=fyhu)
   – outcome: total_contributions_q100
(dropped 1267 singleton observations)
(MWFE estimator converged in 79 iterations)

HDFE Linear regression                            Number of obs   =    245,105
Absorbing 3 HDFE groups                           F(   3,  37156) =      12.03
Statistics robust to heteroskedasticity           Prob > F        =     0.0000
                                                  R-squared       =     0.6755
                                                  Adj R-squared   =     0.6135
                                                  Within R-sq.    =     0.0004
Number of clusters (user_id) =     37,157         Root MSE        =    18.6180

                           (Std. err. adjusted for 37,157 clusters in user_id)
------------------------------------------------------------------------------
             |               Robust
total_co~100 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        var3 |  -1.039558   .4851571    -2.14   0.032    -1.990479   -.0886367
        var5 |   5.122111   1.246225     4.11   0.000     2.679475    7.564748
        var4 |   -5.55272   1.073613    -5.17   0.000    -7.657033   -3.448408
       _cons |   50.15585   .1413245   354.90   0.000     49.87885    50.43285
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
     firm_id |      2178           1        2177     |
     user_id |     37157       37157           0    *|
          yh |        12           1          11     |
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
(dropped 1267 singleton observations)
(MWFE estimator converged in 79 iterations)

Stored estimation results
-------------------------
---------------------------------------------------------------------------
             |           Dependent  Number of        
        Name | Command    variable     param.  Title 
-------------+-------------------------------------------------------------
_ivreg2_var3 | ivreg2         var3          3  First-stage regression: var3
_ivreg2_var5 | ivreg2         var5          3  First-stage regression: var5
---------------------------------------------------------------------------

IV (2SLS) estimation
--------------------

Estimates efficient for homoskedasticity only
Statistics robust to heteroskedasticity and clustering on user_id

Number of clusters (user_id) =   37157                Number of obs =   245105
                                                      F(  3, 37156) =     7.18
                                                      Prob > F      =   0.0001
Total (centered) SS     =   71347279.8                Centered R2   =  -0.0007
Total (uncentered) SS   =   71347279.8                Uncentered R2 =  -0.0007
Residual SS             =     71398573                Root MSE      =    17.14

------------------------------------------------------------------------------
             |               Robust
total_co~100 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        var3 |  -5.936247   3.964144    -1.50   0.134    -13.70608    1.833587
        var5 |   8.699744   5.457235     1.59   0.111    -1.996587    19.39608
        var4 |  -7.623262   4.111631    -1.85   0.064    -15.68217    .4356496
------------------------------------------------------------------------------
Underidentification test (Kleibergen-Paap rk LM statistic):            261.887
                                                   Chi-sq(1) P-val =    0.0000
------------------------------------------------------------------------------
Weak identification test (Cragg-Donald Wald F statistic):             1914.462
                         (Kleibergen-Paap rk Wald F statistic):        137.920
Stock-Yogo weak ID test critical values: 10% maximal IV size              7.03
                                         15% maximal IV size              4.58
                                         20% maximal IV size              3.95
                                         25% maximal IV size              3.63
Source: Stock-Yogo (2005).  Reproduced by permission.
NB: Critical values are for Cragg-Donald F statistic and i.i.d. errors.
------------------------------------------------------------------------------
Hansen J statistic (overidentification test of all instruments):         0.000
                                                 (equation exactly identified)
------------------------------------------------------------------------------
Instrumented:         var3 var5
Included instruments: var4
Excluded instruments: var6 var7
Partialled-out:       _cons
                      nb: total SS, model F and R2s are after partialling-out;
                          any small-sample adjustments include partialled-out
                          variables in regressor count K
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
     firm_id |      2178           1        2177     |
     user_id |     37157       37157           0    *|
          yh |        12           1          11     |
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
(results _ivreg2_var3 are active now)
(results _ivreg2_var5 are active now)
>> FE spec: (tag=fyhu)
   – outcome: restricted_contributions_q100
(dropped 1267 singleton observations)
(MWFE estimator converged in 81 iterations)

HDFE Linear regression                            Number of obs   =    245,105
Absorbing 3 HDFE groups                           F(   3,  37156) =      19.27
Statistics robust to heteroskedasticity           Prob > F        =     0.0000
                                                  R-squared       =     0.6530
                                                  Adj R-squared   =     0.5866
                                                  Within R-sq.    =     0.0005
Number of clusters (user_id) =     37,157         Root MSE        =    20.3789

                           (Std. err. adjusted for 37,157 clusters in user_id)
------------------------------------------------------------------------------
             |               Robust
restrict~100 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        var3 |  -1.455831   .5082906    -2.86   0.004    -2.452095   -.4595677
        var5 |   6.464754   1.256106     5.15   0.000     4.002752    8.926755
        var4 |  -7.026194   1.082326    -6.49   0.000    -9.147584   -4.904805
       _cons |   48.80134   .1480546   329.62   0.000     48.51115    49.09153
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
     firm_id |      2178           1        2177     |
     user_id |     37157       37157           0    *|
          yh |        12           1          11     |
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
(dropped 1267 singleton observations)
(MWFE estimator converged in 81 iterations)

Stored estimation results
-------------------------
---------------------------------------------------------------------------
             |           Dependent  Number of        
        Name | Command    variable     param.  Title 
-------------+-------------------------------------------------------------
_ivreg2_var3 | ivreg2         var3          3  First-stage regression: var3
_ivreg2_var5 | ivreg2         var5          3  First-stage regression: var5
---------------------------------------------------------------------------

IV (2SLS) estimation
--------------------

Estimates efficient for homoskedasticity only
Statistics robust to heteroskedasticity and clustering on user_id

Number of clusters (user_id) =   37157                Number of obs =   245105
                                                      F(  3, 37156) =    11.35
                                                      Prob > F      =   0.0000
Total (centered) SS     =  85492855.69                Centered R2   =  -0.0002
Total (uncentered) SS   =  85492855.69                Uncentered R2 =  -0.0002
Residual SS             =  85509934.25                Root MSE      =    18.76

------------------------------------------------------------------------------
             |               Robust
restrict~100 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        var3 |   -5.72354   4.145186    -1.38   0.167    -13.84822     2.40114
        var5 |    8.90212   5.523196     1.61   0.107    -1.923498    19.72774
        var4 |  -8.253066   4.115777    -2.01   0.045     -16.3201    -.186029
------------------------------------------------------------------------------
Underidentification test (Kleibergen-Paap rk LM statistic):            261.887
                                                   Chi-sq(1) P-val =    0.0000
------------------------------------------------------------------------------
Weak identification test (Cragg-Donald Wald F statistic):             1914.462
                         (Kleibergen-Paap rk Wald F statistic):        137.920
Stock-Yogo weak ID test critical values: 10% maximal IV size              7.03
                                         15% maximal IV size              4.58
                                         20% maximal IV size              3.95
                                         25% maximal IV size              3.63
Source: Stock-Yogo (2005).  Reproduced by permission.
NB: Critical values are for Cragg-Donald F statistic and i.i.d. errors.
------------------------------------------------------------------------------
Hansen J statistic (overidentification test of all instruments):         0.000
                                                 (equation exactly identified)
------------------------------------------------------------------------------
Instrumented:         var3 var5
Included instruments: var4
Excluded instruments: var6 var7
Partialled-out:       _cons
                      nb: total SS, model F and R2s are after partialling-out;
                          any small-sample adjustments include partialled-out
                          variables in regressor count K
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
     firm_id |      2178           1        2177     |
     user_id |     37157       37157           0    *|
          yh |        12           1          11     |
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
(results _ivreg2_var3 are active now)
(results _ivreg2_var5 are active now)
>> FE spec: (tag=fyhu)
   – outcome: total_contributions_we
(dropped 1267 singleton observations)
(MWFE estimator converged in 77 iterations)

HDFE Linear regression                            Number of obs   =    245,105
Absorbing 3 HDFE groups                           F(   3,  37156) =      14.73
Statistics robust to heteroskedasticity           Prob > F        =     0.0000
                                                  R-squared       =     0.6888
                                                  Adj R-squared   =     0.6292
                                                  Within R-sq.    =     0.0006
Number of clusters (user_id) =     37,157         Root MSE        =   157.4595

                           (Std. err. adjusted for 37,157 clusters in user_id)
------------------------------------------------------------------------------
             |               Robust
total_cont~e | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        var3 |  -17.48378   4.474728    -3.91   0.000    -26.25437   -8.713188
        var5 |   52.42375   13.62907     3.85   0.000     25.71039    79.13711
        var4 |  -56.83906   11.76216    -4.83   0.000    -79.89321    -33.7849
       _cons |   198.8274   1.303916   152.48   0.000     196.2717    201.3831
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
     firm_id |      2178           1        2177     |
     user_id |     37157       37157           0    *|
          yh |        12           1          11     |
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
(dropped 1267 singleton observations)
(MWFE estimator converged in 77 iterations)

Stored estimation results
-------------------------
---------------------------------------------------------------------------
             |           Dependent  Number of        
        Name | Command    variable     param.  Title 
-------------+-------------------------------------------------------------
_ivreg2_var3 | ivreg2         var3          3  First-stage regression: var3
_ivreg2_var5 | ivreg2         var5          3  First-stage regression: var5
---------------------------------------------------------------------------

IV (2SLS) estimation
--------------------

Estimates efficient for homoskedasticity only
Statistics robust to heteroskedasticity and clustering on user_id

Number of clusters (user_id) =   37157                Number of obs =   245105
                                                      F(  3, 37156) =    10.10
                                                      Prob > F      =   0.0000
Total (centered) SS     =   5104728484                Centered R2   =  -0.0035
Total (uncentered) SS   =   5104728484                Uncentered R2 =  -0.0035
Residual SS             =   5122505072                Root MSE      =    145.2

------------------------------------------------------------------------------
             |               Robust
total_cont~e | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        var3 |  -97.23456   32.72634    -2.97   0.003    -161.3791   -33.09003
        var5 |   90.96696   54.73891     1.66   0.097    -16.32282    198.2567
        var4 |  -73.82159   43.04006    -1.72   0.086    -158.1813    10.53812
------------------------------------------------------------------------------
Underidentification test (Kleibergen-Paap rk LM statistic):            261.887
                                                   Chi-sq(1) P-val =    0.0000
------------------------------------------------------------------------------
Weak identification test (Cragg-Donald Wald F statistic):             1914.462
                         (Kleibergen-Paap rk Wald F statistic):        137.920
Stock-Yogo weak ID test critical values: 10% maximal IV size              7.03
                                         15% maximal IV size              4.58
                                         20% maximal IV size              3.95
                                         25% maximal IV size              3.63
Source: Stock-Yogo (2005).  Reproduced by permission.
NB: Critical values are for Cragg-Donald F statistic and i.i.d. errors.
------------------------------------------------------------------------------
Hansen J statistic (overidentification test of all instruments):         0.000
                                                 (equation exactly identified)
------------------------------------------------------------------------------
Instrumented:         var3 var5
Included instruments: var4
Excluded instruments: var6 var7
Partialled-out:       _cons
                      nb: total SS, model F and R2s are after partialling-out;
                          any small-sample adjustments include partialled-out
                          variables in regressor count K
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
     firm_id |      2178           1        2177     |
     user_id |     37157       37157           0    *|
          yh |        12           1          11     |
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
(results _ivreg2_var3 are active now)
(results _ivreg2_var5 are active now)
>> FE spec: (tag=fyhu)
   – outcome: restricted_contributions_we
(dropped 1267 singleton observations)
(MWFE estimator converged in 77 iterations)

HDFE Linear regression                            Number of obs   =    245,105
Absorbing 3 HDFE groups                           F(   3,  37156) =      15.87
Statistics robust to heteroskedasticity           Prob > F        =     0.0000
                                                  R-squared       =     0.7027
                                                  Adj R-squared   =     0.6459
                                                  Within R-sq.    =     0.0007
Number of clusters (user_id) =     37,157         Root MSE        =   133.1912

                           (Std. err. adjusted for 37,157 clusters in user_id)
------------------------------------------------------------------------------
             |               Robust
restricted~e | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        var3 |  -15.62166   3.756174    -4.16   0.000    -22.98386    -8.25945
        var5 |   48.33966    12.1798     3.97   0.000     24.46692    72.21241
        var4 |  -52.18211   10.55343    -4.94   0.000    -72.86713   -31.49708
       _cons |   151.7858   1.094261   138.71   0.000      149.641    153.9306
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
     firm_id |      2178           1        2177     |
     user_id |     37157       37157           0    *|
          yh |        12           1          11     |
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
(dropped 1267 singleton observations)
(MWFE estimator converged in 77 iterations)

Stored estimation results
-------------------------
---------------------------------------------------------------------------
             |           Dependent  Number of        
        Name | Command    variable     param.  Title 
-------------+-------------------------------------------------------------
_ivreg2_var3 | ivreg2         var3          3  First-stage regression: var3
_ivreg2_var5 | ivreg2         var5          3  First-stage regression: var5
---------------------------------------------------------------------------

IV (2SLS) estimation
--------------------

Estimates efficient for homoskedasticity only
Statistics robust to heteroskedasticity and clustering on user_id

Number of clusters (user_id) =   37157                Number of obs =   245105
                                                      F(  3, 37156) =    11.53
                                                      Prob > F      =   0.0000
Total (centered) SS     =   3652812118                Centered R2   =  -0.0052
Total (uncentered) SS   =   3652812118                Uncentered R2 =  -0.0052
Residual SS             =   3671734473                Root MSE      =    122.9

------------------------------------------------------------------------------
             |               Robust
restricted~e | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        var3 |  -96.73137    27.2412    -3.55   0.000    -150.1249   -43.33786
        var5 |   91.45968   48.55697     1.88   0.060    -3.713343    186.6327
        var4 |  -72.78085   38.64439    -1.88   0.060    -148.5249     2.96322
------------------------------------------------------------------------------
Underidentification test (Kleibergen-Paap rk LM statistic):            261.887
                                                   Chi-sq(1) P-val =    0.0000
------------------------------------------------------------------------------
Weak identification test (Cragg-Donald Wald F statistic):             1914.462
                         (Kleibergen-Paap rk Wald F statistic):        137.920
Stock-Yogo weak ID test critical values: 10% maximal IV size              7.03
                                         15% maximal IV size              4.58
                                         20% maximal IV size              3.95
                                         25% maximal IV size              3.63
Source: Stock-Yogo (2005).  Reproduced by permission.
NB: Critical values are for Cragg-Donald F statistic and i.i.d. errors.
------------------------------------------------------------------------------
Hansen J statistic (overidentification test of all instruments):         0.000
                                                 (equation exactly identified)
------------------------------------------------------------------------------
Instrumented:         var3 var5
Included instruments: var4
Excluded instruments: var6 var7
Partialled-out:       _cons
                      nb: total SS, model F and R2s are after partialling-out;
                          any small-sample adjustments include partialled-out
                          variables in regressor count K
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
     firm_id |      2178           1        2177     |
     user_id |     37157       37157           0    *|
          yh |        12           1          11     |
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
(results _ivreg2_var3 are active now)
(results _ivreg2_var5 are active now)

. 
. 
. 
. //-------------------------------------------------------------
. // firm x user + yh
. //-------------------------------------------------------------
. local feopt "absorb(firm_id#user_id yh)"

. local tag   "firmbyuseryh"

. 
. 
. foreach y of local outcomes {
  2.     use "$processed_data/user_panel_`panel_variant'.dta", clear
  3.     display as text ">> FE spec: (tag=`tag')"
  4.     display as text "   – outcome: `y'"
  5.     summarize `y' if covid == 0, meanonly
  6.     local pre_mean = r(mean)
  7. 
.     // OLS
.      reghdfe `y' var3 var5 var4, ///
>         `feopt' vce(cluster user_id)
  8.                 
.         local N = e(N)  
  9.         
.     foreach p in var3 var5 var4 {
 10.         local b    = _b[`p']
 11.         local se   = _se[`p']
 12.         local t    = `b'/`se'
 13.         local pval = 2*ttail(e(df_r), abs(`t'))
 14. 
.                 post handle ("OLS") ("`tag'") ("`y'") ("`p'") ///
>                                         (`b') (`se') (`pval') (`pre_mean') ///
>                                         (.) (`N')
 15.     }
 16. 
.     // IV (2nd stage)
.      ivreghdfe ///
>         `y' (var3 var5 = var6 var7) var4, ///
>         `feopt' vce(cluster user_id) savefirst
 17.     
.         local rkf = e(rkf)
 18.         local N = e(N)  
 19.         
.     foreach p in var3 var5 var4 {
 20.         local b    = _b[`p']
 21.         local se   = _se[`p']
 22.         local t    = `b'/`se'
 23.         local pval = 2*ttail(e(df_r), abs(`t'))
 24.                 post handle ("IV") ("`tag'") ("`y'") ("`p'") ///
>                                         (`b') (`se') (`pval') (`pre_mean') ///
>                                         (`rkf') (`N')
 25.     }
 26.         
.         *--- pull partial F's from the stacked matrix
.         matrix FS = e(first)
 27.         local F3 = FS[4,1]
 28.         local F5 = FS[4,2]
 29. 
.         *========= var3 first stage ===================================================
.         estimates restore _ivreg2_var3
 30.         local N_fs = e(N)
 31. 
.         foreach p in var6 var7 var4 {
 32.                 local b    = _b[`p']
 33.                 local se   = _se[`p']
 34.                 local t    = `b'/`se'
 35.                 local pval = 2*ttail(e(df_r), abs(`t'))
 36. 
.                 post handle_fs ("`tag'") ("`y'") ("var3") ("`p'") ///
>                                                 (`b') (`se') (`pval') ///
>                                                 (`F3') (`rkf') (`N_fs')
 37.         }
 38. 
.         *========= var5 first stage ===================================================
.         estimates restore _ivreg2_var5
 39.         local N_fs = e(N)
 40. 
.         foreach p in var6 var7 var4 {
 41.                 local b    = _b[`p']
 42.                 local se   = _se[`p']
 43.                 local t    = `b'/`se'
 44.                 local pval = 2*ttail(e(df_r), abs(`t'))
 45. 
.                 post handle_fs ("`tag'") ("`y'") ("var5") ("`p'") ///
>                                                 (`b') (`se') (`pval') ///
>                                                 (`F5') (`rkf') (`N_fs')
 46.         }
 47. 
. }
>> FE spec: (tag=firmbyuseryh)
   – outcome: total_contributions_q100
(dropped 7057 singleton observations)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   =    239,315
Absorbing 2 HDFE groups                           F(   3,  36865) =      17.34
Statistics robust to heteroskedasticity           Prob > F        =     0.0000
                                                  R-squared       =     0.7133
                                                  Adj R-squared   =     0.6474
                                                  Within R-sq.    =     0.0006
Number of clusters (user_id) =     36,866         Root MSE        =    17.7634

                           (Std. err. adjusted for 36,866 clusters in user_id)
------------------------------------------------------------------------------
             |               Robust
total_co~100 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        var3 |  -1.341548   .5013465    -2.68   0.007    -2.324202   -.3588951
        var5 |   6.360281   1.286641     4.94   0.000     3.838428    8.882134
        var4 |  -6.877269   1.109545    -6.20   0.000     -9.05201   -4.702529
       _cons |   50.57833    .145952   346.54   0.000     50.29226     50.8644
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------------+
       Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------------+---------------------------------------|
   firm_id#user_id |     44740       44740           0    *|
                yh |        12           1          11     |
-----------------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
(dropped 7057 singleton observations)
(MWFE estimator converged in 8 iterations)

Stored estimation results
-------------------------
---------------------------------------------------------------------------
             |           Dependent  Number of        
        Name | Command    variable     param.  Title 
-------------+-------------------------------------------------------------
_ivreg2_var3 | ivreg2         var3          3  First-stage regression: var3
_ivreg2_var5 | ivreg2         var5          3  First-stage regression: var5
---------------------------------------------------------------------------

IV (2SLS) estimation
--------------------

Estimates efficient for homoskedasticity only
Statistics robust to heteroskedasticity and clustering on user_id

Number of clusters (user_id) =   36866                Number of obs =   239315
                                                      F(  3, 36865) =    10.79
                                                      Prob > F      =   0.0000
Total (centered) SS     =  61426875.62                Centered R2   =  -0.0023
Total (uncentered) SS   =  61426875.62                Uncentered R2 =  -0.0023
Residual SS             =  61569193.02                Root MSE      =    16.04

------------------------------------------------------------------------------
             |               Robust
total_co~100 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        var3 |  -9.154619    4.11165    -2.23   0.026    -17.21357   -1.095668
        var5 |   12.27705   5.502212     2.23   0.026     1.492561    23.06154
        var4 |  -10.35951   4.121706    -2.51   0.012    -18.43817   -2.280851
------------------------------------------------------------------------------
Underidentification test (Kleibergen-Paap rk LM statistic):            222.802
                                                   Chi-sq(1) P-val =    0.0000
------------------------------------------------------------------------------
Weak identification test (Cragg-Donald Wald F statistic):             1902.210
                         (Kleibergen-Paap rk Wald F statistic):        118.654
Stock-Yogo weak ID test critical values: 10% maximal IV size              7.03
                                         15% maximal IV size              4.58
                                         20% maximal IV size              3.95
                                         25% maximal IV size              3.63
Source: Stock-Yogo (2005).  Reproduced by permission.
NB: Critical values are for Cragg-Donald F statistic and i.i.d. errors.
------------------------------------------------------------------------------
Hansen J statistic (overidentification test of all instruments):         0.000
                                                 (equation exactly identified)
------------------------------------------------------------------------------
Instrumented:         var3 var5
Included instruments: var4
Excluded instruments: var6 var7
Partialled-out:       _cons
                      nb: total SS, model F and R2s are after partialling-out;
                          any small-sample adjustments include partialled-out
                          variables in regressor count K
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------------+
       Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------------+---------------------------------------|
   firm_id#user_id |     44740       44740           0    *|
                yh |        12           1          11     |
-----------------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
(results _ivreg2_var3 are active now)
(results _ivreg2_var5 are active now)
>> FE spec: (tag=firmbyuseryh)
   – outcome: restricted_contributions_q100
(dropped 7057 singleton observations)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   =    239,315
Absorbing 2 HDFE groups                           F(   3,  36865) =      24.03
Statistics robust to heteroskedasticity           Prob > F        =     0.0000
                                                  R-squared       =     0.6910
                                                  Adj R-squared   =     0.6199
                                                  Within R-sq.    =     0.0007
Number of clusters (user_id) =     36,866         Root MSE        =    19.5160

                           (Std. err. adjusted for 36,866 clusters in user_id)
------------------------------------------------------------------------------
             |               Robust
restrict~100 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        var3 |  -1.565398    .524764    -2.98   0.003    -2.593951    -.536846
        var5 |   7.581067   1.281875     5.91   0.000     5.068556    10.09358
        var4 |  -8.168386    1.10341    -7.40   0.000     -10.3311   -6.005672
       _cons |   49.19511   .1527511   322.06   0.000     48.89571    49.49451
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------------+
       Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------------+---------------------------------------|
   firm_id#user_id |     44740       44740           0    *|
                yh |        12           1          11     |
-----------------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
(dropped 7057 singleton observations)
(MWFE estimator converged in 8 iterations)

Stored estimation results
-------------------------
---------------------------------------------------------------------------
             |           Dependent  Number of        
        Name | Command    variable     param.  Title 
-------------+-------------------------------------------------------------
_ivreg2_var3 | ivreg2         var3          3  First-stage regression: var3
_ivreg2_var5 | ivreg2         var5          3  First-stage regression: var5
---------------------------------------------------------------------------

IV (2SLS) estimation
--------------------

Estimates efficient for homoskedasticity only
Statistics robust to heteroskedasticity and clustering on user_id

Number of clusters (user_id) =   36866                Number of obs =   239315
                                                      F(  3, 36865) =    13.68
                                                      Prob > F      =   0.0000
Total (centered) SS     =  74152405.67                Centered R2   =  -0.0004
Total (uncentered) SS   =  74152405.67                Uncentered R2 =  -0.0004
Residual SS             =  74185419.24                Root MSE      =    17.61

------------------------------------------------------------------------------
             |               Robust
restrict~100 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        var3 |  -6.845203   4.284485    -1.60   0.110    -15.24292    1.552509
        var5 |   10.79966   5.534824     1.95   0.051     -.048755    21.64807
        var4 |   -9.85802   4.094131    -2.41   0.016    -17.88263   -1.833408
------------------------------------------------------------------------------
Underidentification test (Kleibergen-Paap rk LM statistic):            222.802
                                                   Chi-sq(1) P-val =    0.0000
------------------------------------------------------------------------------
Weak identification test (Cragg-Donald Wald F statistic):             1902.210
                         (Kleibergen-Paap rk Wald F statistic):        118.654
Stock-Yogo weak ID test critical values: 10% maximal IV size              7.03
                                         15% maximal IV size              4.58
                                         20% maximal IV size              3.95
                                         25% maximal IV size              3.63
Source: Stock-Yogo (2005).  Reproduced by permission.
NB: Critical values are for Cragg-Donald F statistic and i.i.d. errors.
------------------------------------------------------------------------------
Hansen J statistic (overidentification test of all instruments):         0.000
                                                 (equation exactly identified)
------------------------------------------------------------------------------
Instrumented:         var3 var5
Included instruments: var4
Excluded instruments: var6 var7
Partialled-out:       _cons
                      nb: total SS, model F and R2s are after partialling-out;
                          any small-sample adjustments include partialled-out
                          variables in regressor count K
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------------+
       Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------------+---------------------------------------|
   firm_id#user_id |     44740       44740           0    *|
                yh |        12           1          11     |
-----------------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
(results _ivreg2_var3 are active now)
(results _ivreg2_var5 are active now)
>> FE spec: (tag=firmbyuseryh)
   – outcome: total_contributions_we
(dropped 7057 singleton observations)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   =    239,315
Absorbing 2 HDFE groups                           F(   3,  36865) =      19.80
Statistics robust to heteroskedasticity           Prob > F        =     0.0000
                                                  R-squared       =     0.7184
                                                  Adj R-squared   =     0.6536
                                                  Within R-sq.    =     0.0010
Number of clusters (user_id) =     36,866         Root MSE        =   152.9566

                           (Std. err. adjusted for 36,866 clusters in user_id)
------------------------------------------------------------------------------
             |               Robust
total_cont~e | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        var3 |    -20.721   4.695052    -4.41   0.000    -29.92344   -11.51857
        var5 |   60.94575   14.37575     4.24   0.000     32.76886    89.12263
        var4 |  -67.60253    12.4211    -5.44   0.000    -91.94823   -43.25683
       _cons |   202.4922   1.366937   148.14   0.000      199.813    205.1714
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------------+
       Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------------+---------------------------------------|
   firm_id#user_id |     44740       44740           0    *|
                yh |        12           1          11     |
-----------------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
(dropped 7057 singleton observations)
(MWFE estimator converged in 8 iterations)

Stored estimation results
-------------------------
---------------------------------------------------------------------------
             |           Dependent  Number of        
        Name | Command    variable     param.  Title 
-------------+-------------------------------------------------------------
_ivreg2_var3 | ivreg2         var3          3  First-stage regression: var3
_ivreg2_var5 | ivreg2         var5          3  First-stage regression: var5
---------------------------------------------------------------------------

IV (2SLS) estimation
--------------------

Estimates efficient for homoskedasticity only
Statistics robust to heteroskedasticity and clustering on user_id

Number of clusters (user_id) =   36866                Number of obs =   239315
                                                      F(  3, 36865) =    14.51
                                                      Prob > F      =   0.0000
Total (centered) SS     =   4556307646                Centered R2   =  -0.0058
Total (uncentered) SS   =   4556307646                Uncentered R2 =  -0.0058
Residual SS             =   4582738018                Root MSE      =    138.4

------------------------------------------------------------------------------
             |               Robust
total_cont~e | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        var3 |  -123.0047   34.62825    -3.55   0.000    -190.8771   -55.13237
        var5 |   125.9673   56.10994     2.25   0.025      15.9902    235.9443
        var4 |  -102.6064   43.97767    -2.33   0.020    -188.8038   -16.40887
------------------------------------------------------------------------------
Underidentification test (Kleibergen-Paap rk LM statistic):            222.802
                                                   Chi-sq(1) P-val =    0.0000
------------------------------------------------------------------------------
Weak identification test (Cragg-Donald Wald F statistic):             1902.210
                         (Kleibergen-Paap rk Wald F statistic):        118.654
Stock-Yogo weak ID test critical values: 10% maximal IV size              7.03
                                         15% maximal IV size              4.58
                                         20% maximal IV size              3.95
                                         25% maximal IV size              3.63
Source: Stock-Yogo (2005).  Reproduced by permission.
NB: Critical values are for Cragg-Donald F statistic and i.i.d. errors.
------------------------------------------------------------------------------
Hansen J statistic (overidentification test of all instruments):         0.000
                                                 (equation exactly identified)
------------------------------------------------------------------------------
Instrumented:         var3 var5
Included instruments: var4
Excluded instruments: var6 var7
Partialled-out:       _cons
                      nb: total SS, model F and R2s are after partialling-out;
                          any small-sample adjustments include partialled-out
                          variables in regressor count K
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------------+
       Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------------+---------------------------------------|
   firm_id#user_id |     44740       44740           0    *|
                yh |        12           1          11     |
-----------------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
(results _ivreg2_var3 are active now)
(results _ivreg2_var5 are active now)
>> FE spec: (tag=firmbyuseryh)
   – outcome: restricted_contributions_we
(dropped 7057 singleton observations)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   =    239,315
Absorbing 2 HDFE groups                           F(   3,  36865) =      21.01
Statistics robust to heteroskedasticity           Prob > F        =     0.0000
                                                  R-squared       =     0.7325
                                                  Adj R-squared   =     0.6710
                                                  Within R-sq.    =     0.0011
Number of clusters (user_id) =     36,866         Root MSE        =   129.1597

                           (Std. err. adjusted for 36,866 clusters in user_id)
------------------------------------------------------------------------------
             |               Robust
restricted~e | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        var3 |  -17.61363    3.93192    -4.48   0.000     -25.3203   -9.906953
        var5 |   56.80613   12.83484     4.43   0.000     31.64948    81.96277
        var4 |  -62.86049   11.14391    -5.64   0.000    -84.70287   -41.01811
       _cons |   154.7913   1.144066   135.30   0.000     152.5489    157.0337
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------------+
       Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------------+---------------------------------------|
   firm_id#user_id |     44740       44740           0    *|
                yh |        12           1          11     |
-----------------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
(dropped 7057 singleton observations)
(MWFE estimator converged in 8 iterations)

Stored estimation results
-------------------------
---------------------------------------------------------------------------
             |           Dependent  Number of        
        Name | Command    variable     param.  Title 
-------------+-------------------------------------------------------------
_ivreg2_var3 | ivreg2         var3          3  First-stage regression: var3
_ivreg2_var5 | ivreg2         var5          3  First-stage regression: var5
---------------------------------------------------------------------------

IV (2SLS) estimation
--------------------

Estimates efficient for homoskedasticity only
Statistics robust to heteroskedasticity and clustering on user_id

Number of clusters (user_id) =   36866                Number of obs =   239315
                                                      F(  3, 36865) =    15.17
                                                      Prob > F      =   0.0000
Total (centered) SS     =   3249317405                Centered R2   =  -0.0061
Total (uncentered) SS   =   3249317405                Uncentered R2 =  -0.0061
Residual SS             =   3268981894                Root MSE      =    116.9

------------------------------------------------------------------------------
             |               Robust
restricted~e | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        var3 |  -106.2081   28.75022    -3.69   0.000    -162.5594   -49.85685
        var5 |   109.1232   49.64217     2.20   0.028     11.82316    206.4233
        var4 |  -89.77383   39.41548    -2.28   0.023    -167.0293   -12.51837
------------------------------------------------------------------------------
Underidentification test (Kleibergen-Paap rk LM statistic):            222.802
                                                   Chi-sq(1) P-val =    0.0000
------------------------------------------------------------------------------
Weak identification test (Cragg-Donald Wald F statistic):             1902.210
                         (Kleibergen-Paap rk Wald F statistic):        118.654
Stock-Yogo weak ID test critical values: 10% maximal IV size              7.03
                                         15% maximal IV size              4.58
                                         20% maximal IV size              3.95
                                         25% maximal IV size              3.63
Source: Stock-Yogo (2005).  Reproduced by permission.
NB: Critical values are for Cragg-Donald F statistic and i.i.d. errors.
------------------------------------------------------------------------------
Hansen J statistic (overidentification test of all instruments):         0.000
                                                 (equation exactly identified)
------------------------------------------------------------------------------
Instrumented:         var3 var5
Included instruments: var4
Excluded instruments: var6 var7
Partialled-out:       _cons
                      nb: total SS, model F and R2s are after partialling-out;
                          any small-sample adjustments include partialled-out
                          variables in regressor count K
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------------+
       Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------------+---------------------------------------|
   firm_id#user_id |     44740       44740           0    *|
                yh |        12           1          11     |
-----------------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
(results _ivreg2_var3 are active now)
(results _ivreg2_var5 are active now)

. 
. 
. 
. 
. //-------------------------------------------------------------
. // //  Firm + year FE ("fyh")
. // //-------------------------------------------------------------
. // local feopt "absorb(firm_id yh)"
. // local tag   "fyh"
. //
. // foreach y of local outcomes {
. //     use "$processed_data/user_panel_`panel_variant'.dta", clear
. //     display as text ">> FE spec: (tag=`tag')"
. //     display as text "   – outcome: `y'"
. //     summarize `y' if covid == 0, meanonly
. //     local pre_mean = r(mean)
. //
. //     // OLS
. //      reghdfe `y' var3 var5 var4, ///
. //         `feopt' vce(cluster user_id)
. //              
. //      local N = e(N)  
. //      
. //     foreach p in var3 var5 var4 {
. //         local b    = _b[`p']
. //         local se   = _se[`p']
. //         local t    = `b'/`se'
. //         local pval = 2*ttail(e(df_r), abs(`t'))
. //
. //                 post handle ("OLS") ("`tag'") ("`y'") ("`p'") ///
. //                                         (`b') (`se') (`pval') (`pre_mean') ///
. //                                         (.) (`N')
. //     }
. //
. //     // IV (2nd stage)
. //      ivreghdfe ///
. //         `y' (var3 var5 = var6 var7) var4, ///
. //         `feopt' vce(cluster user_id) savefirst
. //    
. //      local rkf = e(rkf)
. //      local N = e(N)  
. //      
. //     foreach p in var3 var5 var4 {
. //         local b    = _b[`p']
. //         local se   = _se[`p']
. //         local t    = `b'/`se'
. //         local pval = 2*ttail(e(df_r), abs(`t'))
. //                 post handle ("IV") ("`tag'") ("`y'") ("`p'") ///
. //                                         (`b') (`se') (`pval') (`pre_mean') ///
. //                                         (`rkf') (`N')
. //     }
. //      
. //      *--- pull partial F's from the stacked matrix
. //      matrix FS = e(first)
. //      local F3 = FS[4,1]
. //      local F5 = FS[4,2]
. //
. //      *========= var3 first stage ===================================================
. //      estimates restore _ivreg2_var3
. //      local N_fs = e(N)
. //
. //      foreach p in var6 var7 var4 {
. //              local b    = _b[`p']
. //              local se   = _se[`p']
. //              local t    = `b'/`se'
. //              local pval = 2*ttail(e(df_r), abs(`t'))
. //
. //              post handle_fs ("`tag'") ("`y'") ("var3") ("`p'") ///
. //                                              (`b') (`se') (`pval') ///
. //                                              (`F3') (`rkf') (`N_fs')
. //      }
. //
. //      *========= var5 first stage ===================================================
. //      estimates restore _ivreg2_var5
. //      local N_fs = e(N)
. //
. //      foreach p in var6 var7 var4 {
. //              local b    = _b[`p']
. //              local se   = _se[`p']
. //              local t    = `b'/`se'
. //              local pval = 2*ttail(e(df_r), abs(`t'))
. //
. //              post handle_fs ("`tag'") ("`y'") ("var5") ("`p'") ///
. //                                              (`b') (`se') (`pval') ///
. //                                              (`F5') (`rkf') (`N_fs')
. //      }
. //
. // }
. //
. //
. //
. // local feopt "absorb(user_id yh)"
. // local tag   "useryh"
. //
. // foreach y of local outcomes {
. //     use "$processed_data/user_panel_`panel_variant'.dta", clear
. //     display as text ">> FE spec: (tag=`tag')"
. //     display as text "   – outcome: `y'"
. //     summarize `y' if covid == 0, meanonly
. //     local pre_mean = r(mean)
. //
. //     // OLS
. //      reghdfe `y' var3 var5 var4, ///
. //         `feopt' vce(cluster user_id)
. //              
. //      local N = e(N)  
. //      
. //     foreach p in var3 var5 var4 {
. //         local b    = _b[`p']
. //         local se   = _se[`p']
. //         local t    = `b'/`se'
. //         local pval = 2*ttail(e(df_r), abs(`t'))
. //
. //                 post handle ("OLS") ("`tag'") ("`y'") ("`p'") ///
. //                                         (`b') (`se') (`pval') (`pre_mean') ///
. //                                         (.) (`N')
. //     }
. //
. //     // IV (2nd stage)
. //      ivreghdfe ///
. //         `y' (var3 var5 = var6 var7) var4, ///
. //         `feopt' vce(cluster user_id) savefirst
. //    
. //      local rkf = e(rkf)
. //      local N = e(N)  
. //      
. //     foreach p in var3 var5 var4 {
. //         local b    = _b[`p']
. //         local se   = _se[`p']
. //         local t    = `b'/`se'
. //         local pval = 2*ttail(e(df_r), abs(`t'))
. //                 post handle ("IV") ("`tag'") ("`y'") ("`p'") ///
. //                                         (`b') (`se') (`pval') (`pre_mean') ///
. //                                         (`rkf') (`N')
. //     }
. //      
. //      *--- pull partial F's from the stacked matrix
. //      matrix FS = e(first)
. //      local F3 = FS[4,1]
. //      local F5 = FS[4,2]
. //
. //      *========= var3 first stage ===================================================
. //      estimates restore _ivreg2_var3
. //      local N_fs = e(N)
. //
. //      foreach p in var6 var7 var4 {
. //              local b    = _b[`p']
. //              local se   = _se[`p']
. //              local t    = `b'/`se'
. //              local pval = 2*ttail(e(df_r), abs(`t'))
. //
. //              post handle_fs ("`tag'") ("`y'") ("var3") ("`p'") ///
. //                                              (`b') (`se') (`pval') ///
. //                                              (`F3') (`rkf') (`N_fs')
. //      }
. //
. //      *========= var5 first stage ===================================================
. //      estimates restore _ivreg2_var5
. //      local N_fs = e(N)
. //
. //      foreach p in var6 var7 var4 {
. //              local b    = _b[`p']
. //              local se   = _se[`p']
. //              local t    = `b'/`se'
. //              local pval = 2*ttail(e(df_r), abs(`t'))
. //
. //              post handle_fs ("`tag'") ("`y'") ("var5") ("`p'") ///
. //                                              (`b') (`se') (`pval') ///
. //                                              (`F5') (`rkf') (`N_fs')
. //      }
. //
. // }
. //
. //
. // //-------------------------------------------------------------
. // // Time FE ("time")
. // //-------------------------------------------------------------
. // local feopt "absorb(yh)"
. // local tag   "time"
. //
. // foreach y of local outcomes {
. //     use "$processed_data/user_panel_`panel_variant'.dta", clear
. //
. //         gen var8 = remote * startup
. //         gen var9 = teleworkable*startup
. //
. //     summarize `y' if covid == 0, meanonly
. //     local pre_mean = r(mean)
. //      
. //     display as text ">> FE spec: time  (tag=`tag')"
. //     display as text "   – outcome: `y'"
. //
. //     // OLS
. //     reghdfe `y' var3 var5 var4 remote startup var8 covid, ///
. //         `feopt' vce(cluster user_id)
. //      local N   = e(N)
. //      
. //     foreach p in var3 var5 var4 {
. //         local b    = _b[`p']
. //         local se   = _se[`p']
. //         local t    = `b'/`se'
. //         local pval = 2*ttail(e(df_r), abs(`t'))
. //
. //                 post handle ("OLS") ("`tag'") ("`y'") ("`p'") ///
. //                                         (`b') (`se') (`pval') (`pre_mean') ///
. //                                         (.) (`N')
. //     }
. //
. //     // IV (2nd stage)
. //      ivreghdfe ///
. //         `y' (var3 var5 var8 remote = var6 var7 var9 teleworkable) var4 startup covid, ///
. //         `feopt' vce(cluster user_id) savefirst
. //              
. //     local rkf = e(rkf)
. //      local N   = e(N)
. //      
. //     foreach p in var3 var5 var4 {
. //         local b    = _b[`p']
. //         local se   = _se[`p']
. //         local t    = `b'/`se'
. //         local pval = 2*ttail(e(df_r), abs(`t'))
. //                 post handle ("IV") ("`tag'") ("`y'") ("`p'") ///
. //                                         (`b') (`se') (`pval') (`pre_mean') ///
. //                                         (`rkf') (`N')
. //     }
. //
. //      *--- pull partial F's from the stacked matrix
. //      matrix FS = e(first)
. //      local F3 = FS[4,1]
. //      local F5 = FS[4,2]
. //
. //      *========= var3 first stage ===================================================
. //      estimates restore _ivreg2_var3
. //      local N_fs = e(N)
. //
. //      foreach p in var6 var7 var4 {
. //              local b    = _b[`p']
. //              local se   = _se[`p']
. //              local t    = `b'/`se'
. //              local pval = 2*ttail(e(df_r), abs(`t'))
. //
. //              post handle_fs ("`tag'") ("`y'") ("var3") ("`p'") ///
. //                                              (`b') (`se') (`pval') ///
. //                                              (`F3') (`rkf') (`N_fs')
. //      }
. //
. //      *========= var5 first stage ===================================================
. //      estimates restore _ivreg2_var5
. //      local N_fs = e(N)
. //
. //      foreach p in var6 var7 var4 {
. //              local b    = _b[`p']
. //              local se   = _se[`p']
. //              local t    = `b'/`se'
. //              local pval = 2*ttail(e(df_r), abs(`t'))
. //
. //              post handle_fs ("`tag'") ("`y'") ("var5") ("`p'") ///
. //                                              (`b') (`se') (`pval') ///
. //                                              (`F5') (`rkf') (`N_fs')
. //      }
. //
. // }
. //
. // //-------------------------------------------------------------
. // // Firm FE ("firm")
. // //-------------------------------------------------------------
. // local feopt "absorb(firm_id)"
. // local tag   "firm"
. //
. // foreach y of local outcomes {
. //     use "$processed_data/user_panel_`panel_variant'.dta", clear
. //
. //     display as text ">> FE spec: firm  (tag=`tag')"
. //     display as text "   – outcome: `y'"
. //
. //     summarize `y' if covid == 0, meanonly
. //     local pre_mean = r(mean)
. //
. //     // OLS
. //      reghdfe `y' var3 var5 var4 covid, ///
. //         `feopt' vce(cluster user_id)
. //      
. //      local N   = e(N)
. //      
. //     foreach p in var3 var5 var4 {
. //         local b    = _b[`p']
. //         local se   = _se[`p']
. //         local t    = `b'/`se'
. //         local pval = 2*ttail(e(df_r), abs(`t'))
. //
. //                 post handle ("OLS") ("`tag'") ("`y'") ("`p'") ///
. //                                         (`b') (`se') (`pval') (`pre_mean') ///
. //                                         (.) (`N')
. //     }
. //
. //     // IV (2nd stage)
. //      ivreghdfe ///
. //         `y' (var3 var5 = var6 var7) var4 covid, ///
. //         `feopt' vce(cluster user_id) savefirst
. //              
. //     local rkf = e(rkf)
. //      local N   = e(N)
. //      
. //     foreach p in var3 var5 var4 {
. //         local b    = _b[`p']
. //         local se   = _se[`p']
. //         local t    = `b'/`se'
. //         local pval = 2*ttail(e(df_r), abs(`t'))
. //                 post handle ("IV") ("`tag'") ("`y'") ("`p'") ///
. //                                         (`b') (`se') (`pval') (`pre_mean') ///
. //                                         (`rkf') (`N')
. //     }
. //
. //      *--- pull partial F's from the stacked matrix
. //      matrix FS = e(first)
. //      local F3 = FS[4,1]
. //      local F5 = FS[4,2]
. //
. //      *========= var3 first stage ===================================================
. //      estimates restore _ivreg2_var3
. //      local N_fs = e(N)
. //
. //      foreach p in var6 var7 var4 {
. //              local b    = _b[`p']
. //              local se   = _se[`p']
. //              local t    = `b'/`se'
. //              local pval = 2*ttail(e(df_r), abs(`t'))
. //
. //              post handle_fs ("`tag'") ("`y'") ("var3") ("`p'") ///
. //                                              (`b') (`se') (`pval') ///
. //                                              (`F3') (`rkf') (`N_fs')
. //      }
. //
. //      *========= var5 first stage ===================================================
. //      estimates restore _ivreg2_var5
. //      local N_fs = e(N)
. //
. //      foreach p in var6 var7 var4 {
. //              local b    = _b[`p']
. //              local se   = _se[`p']
. //              local t    = `b'/`se'
. //              local pval = 2*ttail(e(df_r), abs(`t'))
. //
. //              post handle_fs ("`tag'") ("`y'") ("var5") ("`p'") ///
. //                                              (`b') (`se') (`pval') ///
. //                                              (`F5') (`rkf') (`N_fs')
. //      }
. //
. // }
. //
. // //-------------------------------------------------------------
. // // No FE ("none")
. // //-------------------------------------------------------------
. // local feopt ""
. // local tag   "none"
. //
. // foreach y of local outcomes {
. //     use "$processed_data/user_panel_`panel_variant'.dta", clear
. //      
. //      gen var8 = remote * startup
. //     gen var9 = teleworkable*startup
. //
. //     summarize `y' if covid == 0, meanonly
. //     local pre_mean = r(mean)
. //
. //     display as text ">> FE spec: none  (tag=`tag')"
. //     display as text "   – outcome: `y'"
. //
. //     // OLS
. //     reghdfe `y' var3 var5 var4 remote startup var8 covid, ///
. //         absorb() vce(cluster user_id)
. //              
. //      local N   = e(N)
. //      
. //     foreach p in var3 var5 var4 {
. //         local b    = _b[`p']
. //         local se   = _se[`p']
. //         local t    = `b'/`se'
. //         local pval = 2*ttail(e(df_r), abs(`t'))
. //
. //                 post handle ("OLS") ("`tag'") ("`y'") ("`p'") ///
. //                                         (`b') (`se') (`pval') (`pre_mean') ///
. //                                         (.) (`N')
. //     }
. //
. //     // IV (2nd stage)
. //     ivreghdfe ///
. //         `y' (var3 var5 var8 remote = var6 var7 var9 teleworkable) var4 startup covid, ///
. //         absorb() vce(cluster user_id) savefirst
. //     local rkf = e(rkf)
. //      local N   = e(N)
. //      
. //     foreach p in var3 var5 var4 {
. //         local b    = _b[`p']
. //         local se   = _se[`p']
. //         local t    = `b'/`se'
. //         local pval = 2*ttail(e(df_r), abs(`t'))
. //                 post handle ("IV") ("`tag'") ("`y'") ("`p'") ///
. //                                         (`b') (`se') (`pval') (`pre_mean') ///
. //                                         (`rkf') (`N')
. //     }
. //
. //      *--- pull partial F's from the stacked matrix
. //      matrix FS = e(first)
. //      local F3 = FS[4,1]
. //      local F5 = FS[4,2]
. //
. //      *========= var3 first stage ===================================================
. //      estimates restore _ivreg2_var3
. //      local N_fs = e(N)
. //
. //      foreach p in var6 var7 var4 {
. //              local b    = _b[`p']
. //              local se   = _se[`p']
. //              local t    = `b'/`se'
. //              local pval = 2*ttail(e(df_r), abs(`t'))
. //
. //              post handle_fs ("`tag'") ("`y'") ("var3") ("`p'") ///
. //                                              (`b') (`se') (`pval') ///
. //                                              (`F3') (`rkf') (`N_fs')
. //      }
. //
. //      *========= var5 first stage ===================================================
. //      estimates restore _ivreg2_var5
. //      local N_fs = e(N)
. //
. //      foreach p in var6 var7 var4 {
. //              local b    = _b[`p']
. //              local se   = _se[`p']
. //              local t    = `b'/`se'
. //              local pval = 2*ttail(e(df_r), abs(`t'))
. //
. //              post handle_fs ("`tag'") ("`y'") ("var5") ("`p'") ///
. //                                              (`b') (`se') (`pval') ///
. //                                              (`F5') (`rkf') (`N_fs')
. //      }
. //
. // }
. //
. //
. //
. // local feopt "absorb(firm_id user_id industry_id#yh)"
. // local tag   "industrytime"
. //
. //
. // foreach y of local outcomes {
. //     use "$processed_data/user_panel_`panel_variant'.dta", clear
. //     display as text ">> FE spec: (tag=`tag')"
. //     display as text "   – outcome: `y'"
. //
. //     summarize `y' if covid == 0, meanonly
. //     local pre_mean = r(mean)
. //
. //     // OLS
. //      reghdfe `y' var3 var5 var4, ///
. //         `feopt' vce(cluster user_id)
. //              
. //      local N = e(N)  
. //      
. //     foreach p in var3 var5 var4 {
. //         local b    = _b[`p']
. //         local se   = _se[`p']
. //         local t    = `b'/`se'
. //         local pval = 2*ttail(e(df_r), abs(`t'))
. //
. //                 post handle ("OLS") ("`tag'") ("`y'") ("`p'") ///
. //                                         (`b') (`se') (`pval') (`pre_mean') ///
. //                                         (.) (`N')
. //     }
. //
. //     // IV (2nd stage)
. //      ivreghdfe ///
. //         `y' (var3 var5 = var6 var7) var4, ///
. //         `feopt' vce(cluster user_id) savefirst
. //    
. //      local rkf = e(rkf)
. //      local N = e(N)  
. //      
. //     foreach p in var3 var5 var4 {
. //         local b    = _b[`p']
. //         local se   = _se[`p']
. //         local t    = `b'/`se'
. //         local pval = 2*ttail(e(df_r), abs(`t'))
. //                 post handle ("IV") ("`tag'") ("`y'") ("`p'") ///
. //                                         (`b') (`se') (`pval') (`pre_mean') ///
. //                                         (`rkf') (`N')
. //     }
. //      
. //      *--- pull partial F's from the stacked matrix
. //      matrix FS = e(first)
. //      local F3 = FS[4,1]
. //      local F5 = FS[4,2]
. //
. //      *========= var3 first stage ===================================================
. //      estimates restore _ivreg2_var3
. //      local N_fs = e(N)
. //
. //      foreach p in var6 var7 var4 {
. //              local b    = _b[`p']
. //              local se   = _se[`p']
. //              local t    = `b'/`se'
. //              local pval = 2*ttail(e(df_r), abs(`t'))
. //
. //              post handle_fs ("`tag'") ("`y'") ("var3") ("`p'") ///
. //                                              (`b') (`se') (`pval') ///
. //                                              (`F3') (`rkf') (`N_fs')
. //      }
. //
. //      *========= var5 first stage ===================================================
. //      estimates restore _ivreg2_var5
. //      local N_fs = e(N)
. //
. //      foreach p in var6 var7 var4 {
. //              local b    = _b[`p']
. //              local se   = _se[`p']
. //              local t    = `b'/`se'
. //              local pval = 2*ttail(e(df_r), abs(`t'))
. //
. //              post handle_fs ("`tag'") ("`y'") ("var5") ("`p'") ///
. //                                              (`b') (`se') (`pval') ///
. //                                              (`F5') (`rkf') (`N_fs')
. //      }
. //
. // }
. //
. //
. // local feopt "absorb(firm_id user_id msa_id#yh)"
. // local tag   "msatime"
. //
. //
. // foreach y of local outcomes {
. //     use "$processed_data/user_panel_`panel_variant'.dta", clear
. //     display as text ">> FE spec: (tag=`tag')"
. //     display as text "   – outcome: `y'"
. //
. //     summarize `y' if covid == 0, meanonly
. //     local pre_mean = r(mean)
. //
. //     // OLS
. //      reghdfe `y' var3 var5 var4, ///
. //         `feopt' vce(cluster user_id)
. //              
. //      local N = e(N)  
. //      
. //     foreach p in var3 var5 var4 {
. //         local b    = _b[`p']
. //         local se   = _se[`p']
. //         local t    = `b'/`se'
. //         local pval = 2*ttail(e(df_r), abs(`t'))
. //
. //                 post handle ("OLS") ("`tag'") ("`y'") ("`p'") ///
. //                                         (`b') (`se') (`pval') (`pre_mean') ///
. //                                         (.) (`N')
. //     }
. //
. //     // IV (2nd stage)
. //      ivreghdfe ///
. //         `y' (var3 var5 = var6 var7) var4, ///
. //         `feopt' vce(cluster user_id) savefirst
. //    
. //      local rkf = e(rkf)
. //      local N = e(N)  
. //      
. //     foreach p in var3 var5 var4 {
. //         local b    = _b[`p']
. //         local se   = _se[`p']
. //         local t    = `b'/`se'
. //         local pval = 2*ttail(e(df_r), abs(`t'))
. //                 post handle ("IV") ("`tag'") ("`y'") ("`p'") ///
. //                                         (`b') (`se') (`pval') (`pre_mean') ///
. //                                         (`rkf') (`N')
. //     }
. //      
. //      *--- pull partial F's from the stacked matrix
. //      matrix FS = e(first)
. //      local F3 = FS[4,1]
. //      local F5 = FS[4,2]
. //
. //      *========= var3 first stage ===================================================
. //      estimates restore _ivreg2_var3
. //      local N_fs = e(N)
. //
. //      foreach p in var6 var7 var4 {
. //              local b    = _b[`p']
. //              local se   = _se[`p']
. //              local t    = `b'/`se'
. //              local pval = 2*ttail(e(df_r), abs(`t'))
. //
. //              post handle_fs ("`tag'") ("`y'") ("var3") ("`p'") ///
. //                                              (`b') (`se') (`pval') ///
. //                                              (`F3') (`rkf') (`N_fs')
. //      }
. //
. //      *========= var5 first stage ===================================================
. //      estimates restore _ivreg2_var5
. //      local N_fs = e(N)
. //
. //      foreach p in var6 var7 var4 {
. //              local b    = _b[`p']
. //              local se   = _se[`p']
. //              local t    = `b'/`se'
. //              local pval = 2*ttail(e(df_r), abs(`t'))
. //
. //              post handle_fs ("`tag'") ("`y'") ("var5") ("`p'") ///
. //                                              (`b') (`se') (`pval') ///
. //                                              (`F5') (`rkf') (`N_fs')
. //      }
. //
. // }
. //
. //
. //
. //
. // local feopt "absorb(firm_id user_id msa_id#industry_id#yh)"
. // local tag   "msaindustrytime"
. //
. //
. // foreach y of local outcomes {
. //     use "$processed_data/user_panel_`panel_variant'.dta", clear
. //     display as text ">> FE spec: (tag=`tag')"
. //     display as text "   – outcome: `y'"
. //
. //     summarize `y' if covid == 0, meanonly
. //     local pre_mean = r(mean)
. //
. //     // OLS
. //      reghdfe `y' var3 var5 var4, ///
. //         `feopt' vce(cluster user_id)
. //              
. //      local N = e(N)  
. //      
. //     foreach p in var3 var5 var4 {
. //         local b    = _b[`p']
. //         local se   = _se[`p']
. //         local t    = `b'/`se'
. //         local pval = 2*ttail(e(df_r), abs(`t'))
. //
. //                 post handle ("OLS") ("`tag'") ("`y'") ("`p'") ///
. //                                         (`b') (`se') (`pval') (`pre_mean') ///
. //                                         (.) (`N')
. //     }
. //
. //     // IV (2nd stage)
. //      ivreghdfe ///
. //         `y' (var3 var5 = var6 var7) var4, ///
. //         `feopt' vce(cluster user_id) savefirst
. //    
. //      local rkf = e(rkf)
. //      local N = e(N)  
. //      
. //     foreach p in var3 var5 var4 {
. //         local b    = _b[`p']
. //         local se   = _se[`p']
. //         local t    = `b'/`se'
. //         local pval = 2*ttail(e(df_r), abs(`t'))
. //                 post handle ("IV") ("`tag'") ("`y'") ("`p'") ///
. //                                         (`b') (`se') (`pval') (`pre_mean') ///
. //                                         (`rkf') (`N')
. //     }
. //      
. //      *--- pull partial F's from the stacked matrix
. //      matrix FS = e(first)
. //      local F3 = FS[4,1]
. //      local F5 = FS[4,2]
. //
. //      *========= var3 first stage ===================================================
. //      estimates restore _ivreg2_var3
. //      local N_fs = e(N)
. //
. //      foreach p in var6 var7 var4 {
. //              local b    = _b[`p']
. //              local se   = _se[`p']
. //              local t    = `b'/`se'
. //              local pval = 2*ttail(e(df_r), abs(`t'))
. //
. //              post handle_fs ("`tag'") ("`y'") ("var3") ("`p'") ///
. //                                              (`b') (`se') (`pval') ///
. //                                              (`F3') (`rkf') (`N_fs')
. //      }
. //
. //      *========= var5 first stage ===================================================
. //      estimates restore _ivreg2_var5
. //      local N_fs = e(N)
. //
. //      foreach p in var6 var7 var4 {
. //              local b    = _b[`p']
. //              local se   = _se[`p']
. //              local t    = `b'/`se'
. //              local pval = 2*ttail(e(df_r), abs(`t'))
. //
. //              post handle_fs ("`tag'") ("`y'") ("var5") ("`p'") ///
. //                                              (`b') (`se') (`pval') ///
. //                                              (`F5') (`rkf') (`N_fs')
. //      }
. //
. // }
. //
. 
. 
. 
. //-------------------------------------------------------------
. // Close & export CSV
. //-------------------------------------------------------------
. postclose handle

. use `out', clear

. export delimited using "`result_dir'/consolidated_results.csv", ///
>     replace delimiter(",") quote
file ../results/raw/user_productivity_alternative_fe_precovid/consolidated_results.csv saved

.         
. *------------------------------------------------------------
. *  Write first-stage CSV to disk
. *------------------------------------------------------------
. postclose handle_fs

. use `out_fs', clear

. export delimited using "`result_dir'/first_stage_fstats.csv", ///
>         replace delimiter(",") quote
file ../results/raw/user_productivity_alternative_fe_precovid/first_stage_fstats.csv saved

.                 
. 
. display as result "→ main CSV       : `result_dir'/consolidated_results.csv"
→ main CSV       : ../results/raw/user_productivity_alternative_fe_precovid/consolidated_results.csv

. display as result "→ first-stage CSV: `result_dir'/first_stage_fstats.csv"
→ first-stage CSV: ../results/raw/user_productivity_alternative_fe_precovid/first_stage_fstats.csv

. 
. log close
      name:  <unnamed>
       log:  /Users/saul/Dropbox/Remote Work Startups/main/spec/log/user_productivity_alternative_fe_precovid.log
  log type:  text
 closed on:  22 Jun 2025, 18:17:44
-----------------------------------------------------------------------------------------------------------------------------------------
