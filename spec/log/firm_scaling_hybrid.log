---------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/saul/Dropbox/Remote Work Startups/main/spec/log/firm_scaling_hybrid.log
  log type:  text
 opened on:  17 Sep 2025, 05:13:26

. 
. local result_dir "$results/`specname'"

. capture mkdir "`result_dir'"

. 
. 
. 
. capture postclose handle

. tempfile out

. *--- postfile header (main results) -------------------------------------------
. postfile handle ///
>     str8   model_type ///
>     str40  outcome     ///
>     str40  param       ///
>     double coef se pval pre_mean ///
>     double rkf nobs     ///
>     using `out', replace
(file /var/folders/hg/s3xm9w393gxby64_zklmhgbc0000gn/T//S_47022.000001 not found)

. 
. 
. *------------------------------------------------------------------
. *  First-stage results → first_stage_fstats.csv
. *------------------------------------------------------------------
. tempfile out_fs

. capture postclose handle_fs

. postfile handle_fs ///
>     str8   endovar            ///  var3 / var5
>     str40  param              ///  var6 / var7 / var4
>     double coef se pval       ///
>     double partialF rkf nobs  ///
>     using `out_fs', replace
(file /var/folders/hg/s3xm9w393gxby64_zklmhgbc0000gn/T//S_47022.000002 not found)

. 
. 
. if "`treat'" == "fullremote" {
.     local v3 = "var3_fullrem"
.     local v5 = "var5_fullrem"
.     // Ensure required interactions exist even if not present in panel
.     capture confirm variable var3_fullrem
.     if _rc {
.         gen byte fullrem = (remote==1)
.         gen var3_fullrem = fullrem * covid
.         gen var5_fullrem = fullrem * covid * startup
.     }
. }

. else if "`treat'" == "hybrid" {
.     local v3 = "var3_hybrid"
.     local v5 = "var5_hybrid"
.     capture confirm variable var3_hybrid
.     if _rc {
.         gen byte hybrid = (remote>0 & remote<1)
.         gen var3_hybrid = hybrid * covid
.         gen var5_hybrid = hybrid * covid * startup
.     }
. }

. else if "`treat'" == "inperson" {
.     local v3 = "var3_inperson"
.     local v5 = "var5_inperson"
.     capture confirm variable var3_inperson
.     if _rc {
.         gen byte inperson = (remote==0)
.         gen var3_inperson = inperson * covid
.         gen var5_inperson = inperson * covid * startup
.     }
. }

. else if "`treat'" == "anyremote" {
.     local v3 = "var3_anyremote"
.     local v5 = "var5_anyremote"
.     capture confirm variable var3_anyremote
.     if _rc {
.         gen byte anyremote = (remote>0)
.         gen var3_anyremote = anyremote * covid
.         gen var5_anyremote = anyremote * covid * startup
.     }
. }

. else if "`treat'" == "nonremote" {
.     local v3 = "var3_nonrem"
.     local v5 = "var5_nonrem"
.     capture confirm variable var3_nonrem
.     if _rc {
.         gen byte nonrem = (remote==0)
.         gen var3_nonrem = nonrem * covid
.         gen var5_nonrem = nonrem * covid * startup
.     }
. }

. else {
.     di as error "Unknown treat=`treat'—must be fullremote, hybrid, inperson, anyremote, or nonremote"
.     exit 1
. }

. 
. // 3) Loop over outcomes
. local outcome_vars growth_rate_we join_rate_we leave_rate_we

. 
. local fs_done = 0

. 
. foreach y of local outcome_vars {
  2.     di as text "→ Processing `y'"
  3. 
.     summarize `y' if covid == 0, meanonly
  4.     local pre_mean = r(mean)
  5. 
.     // --- OLS ---
.      reghdfe `y' `v3' `v5' var4, absorb(firm_id yh) vce(cluster firm_id)
  6.         
.         local N = e(N) 
  7. 
.     foreach p in `v3' `v5' var4 {
  8.         local b    = _b[`p']
  9.         local se   = _se[`p']
 10.         local t    = `b'/`se'
 11.         local pval = 2*ttail(e(df_r), abs(`t'))
 12.                 post handle ("OLS") ("`y'") ("`p'") ///
>                                         (`b') (`se') (`pval') (`pre_mean') ///
>                                         (.) (`N')                 // dot for rkf, then nobs
 13.     }
 14. 
.     // --- IV (2nd stage) ---
.      ivreghdfe ///
>         `y' (`v3' `v5' = var6 var7) var4, ///
>         absorb(firm_id yh) vce(cluster firm_id) savefirst
 15. 
.     local rkf   = e(rkf)
 16.         local N = e(N) 
 17. 
.     foreach p in `v3' `v5' var4 {
 18.         local b    = _b[`p']
 19.         local se   = _se[`p']
 20.         local t    = `b'/`se'
 21.         local pval = 2*ttail(e(df_r), abs(`t'))
 22.                 *--- inside the IV loop -------------------------------------------------------
.                 post handle ("IV") ("`y'") ("`p'") ///
>                                         (`b') (`se') (`pval') (`pre_mean') ///
>                                         (`rkf') (`N')            // rkf, then nobs
 23.     }
 24. 
.     // --- FIRST STAGE: only once on first loop pass ---
. //      if !`fs_done' {
.                 
. //              matrix FS = e(first)
. //         local F3 = FS[4,1]
. //         local F5 = FS[4,2]
. //
. //              /* -------- var3 first stage -------------------------------- */
. //              estimates restore _ivreg2_var3
. //              local N_fs = e(N)
. //              foreach p in var6 var7 var4 {
. //                      local b    = _b[`p']
. //                      local se   = _se[`p']
. //                      local t    = `b'/`se'
. //                      local pval = 2*ttail(e(df_r), abs(`t'))
. //
. //                      post handle_fs ("v3") ("`p'") ///
. //                                                      (`b') (`se') (`pval') ///
. //                                                      (`F3') (`rkf') (`N_fs')
. //              }
. //
. //              /* -------- var5 first stage -------------------------------- */
. //              estimates restore _ivreg2_var5
. //              local N_fs = e(N)
. //              foreach p in var6 var7 var4 {
. //                      local b    = _b[`p']
. //                      local se   = _se[`p']
. //                      local t    = `b'/`se'
. //                      local pval = 2*ttail(e(df_r), abs(`t'))
. //
. //                      post handle_fs ("v5") ("`p'") ///
. //                                                      (`b') (`se') (`pval') ///
. //                                                      (`F5') (`rkf') (`N_fs')
. //              }
. 
. //              local fs_done 1
. //      }
. 
. }
→ Processing growth_rate_we
(MWFE estimator converged in 4 iterations)

HDFE Linear regression                            Number of obs   =     41,980
Absorbing 2 HDFE groups                           F(   3,   3507) =      27.89
Statistics robust to heteroskedasticity           Prob > F        =     0.0000
                                                  R-squared       =     0.3485
                                                  Adj R-squared   =     0.2889
                                                  Within R-sq.    =     0.0051
Number of clusters (firm_id) =      3,508         Root MSE        =     0.1853

                            (Std. err. adjusted for 3,508 clusters in firm_id)
------------------------------------------------------------------------------
             |               Robust
growth_rat~e | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
 var3_hybrid |   .0131521   .0037229     3.53   0.000      .005853    .0204513
 var5_hybrid |  -.0456507   .0188459    -2.42   0.015    -.0826008   -.0087006
        var4 |  -.0466669   .0078645    -5.93   0.000    -.0620865   -.0312474
       _cons |   .0987407   .0009323   105.91   0.000     .0969129    .1005686
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
     firm_id |      3508        3508           0    *|
          yh |        12           1          11     |
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
(MWFE estimator converged in 4 iterations)

Stored estimation results
-------------------------
----------------------------------------------------------------------------------
             |           Dependent  Number of        
        Name | Command    variable     param.  Title 
-------------+--------------------------------------------------------------------
_ivreg2_va~d | ivreg2    var3_hybrid        3  First-stage regression: var3_hybrid
_ivreg2_va~d | ivreg2    var5_hybrid        3  First-stage regression: var5_hybrid
----------------------------------------------------------------------------------

IV (2SLS) estimation
--------------------

Estimates efficient for homoskedasticity only
Statistics robust to heteroskedasticity and clustering on firm_id

Number of clusters (firm_id) =    3508                Number of obs =    41980
                                                      F(  3,  3507) =     3.11
                                                      Prob > F      =   0.0252
Total (centered) SS     =   1327.10484                Centered R2   =  -0.5387
Total (uncentered) SS   =   1327.10484                Uncentered R2 =  -0.5387
Residual SS             =  2042.044292                Root MSE      =    .2206

------------------------------------------------------------------------------
             |               Robust
growth_rat~e | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
 var3_hybrid |   .0206641   .0334007     0.62   0.536    -.0448226    .0861508
 var5_hybrid |   -1.47285   1.873369    -0.79   0.432    -5.145854    2.200154
        var4 |   .1977079   .3197659     0.62   0.536    -.4292383     .824654
------------------------------------------------------------------------------
Underidentification test (Kleibergen-Paap rk LM statistic):              0.693
                                                   Chi-sq(1) P-val =    0.4053
------------------------------------------------------------------------------
Weak identification test (Cragg-Donald Wald F statistic):               17.312
                         (Kleibergen-Paap rk Wald F statistic):          0.345
Stock-Yogo weak ID test critical values: 10% maximal IV size              7.03
                                         15% maximal IV size              4.58
                                         20% maximal IV size              3.95
                                         25% maximal IV size              3.63
Source: Stock-Yogo (2005).  Reproduced by permission.
NB: Critical values are for Cragg-Donald F statistic and i.i.d. errors.
------------------------------------------------------------------------------
Hansen J statistic (overidentification test of all instruments):         0.000
                                                 (equation exactly identified)
------------------------------------------------------------------------------
Instrumented:         var3_hybrid var5_hybrid
Included instruments: var4
Excluded instruments: var6 var7
Partialled-out:       _cons
                      nb: total SS, model F and R2s are after partialling-out;
                          any small-sample adjustments include partialled-out
                          variables in regressor count K
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
     firm_id |      3508        3508           0    *|
          yh |        12           1          11     |
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
→ Processing join_rate_we
(MWFE estimator converged in 4 iterations)

HDFE Linear regression                            Number of obs   =     41,980
Absorbing 2 HDFE groups                           F(   3,   3507) =      20.04
Statistics robust to heteroskedasticity           Prob > F        =     0.0000
                                                  R-squared       =     0.4472
                                                  Adj R-squared   =     0.3965
                                                  Within R-sq.    =     0.0035
Number of clusters (firm_id) =      3,508         Root MSE        =     0.1826

                            (Std. err. adjusted for 3,508 clusters in firm_id)
------------------------------------------------------------------------------
             |               Robust
join_rate_we | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
 var3_hybrid |   .0140877   .0037512     3.76   0.000     .0067329    .0214425
 var5_hybrid |  -.0350689   .0185048    -1.90   0.058    -.0713503    .0012124
        var4 |  -.0374747   .0080378    -4.66   0.000    -.0532338   -.0217155
       _cons |   .2223139   .0009424   235.91   0.000     .2204663    .2241615
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
     firm_id |      3508        3508           0    *|
          yh |        12           1          11     |
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
(MWFE estimator converged in 4 iterations)

Stored estimation results
-------------------------
----------------------------------------------------------------------------------
             |           Dependent  Number of        
        Name | Command    variable     param.  Title 
-------------+--------------------------------------------------------------------
_ivreg2_va~d | ivreg2    var3_hybrid        3  First-stage regression: var3_hybrid
_ivreg2_va~d | ivreg2    var5_hybrid        3  First-stage regression: var5_hybrid
----------------------------------------------------------------------------------

IV (2SLS) estimation
--------------------

Estimates efficient for homoskedasticity only
Statistics robust to heteroskedasticity and clustering on firm_id

Number of clusters (firm_id) =    3508                Number of obs =    41980
                                                      F(  3,  3507) =     5.86
                                                      Prob > F      =   0.0005
Total (centered) SS     =  1286.526586                Centered R2   =  -0.9256
Total (uncentered) SS   =  1286.526586                Uncentered R2 =  -0.9256
Residual SS             =  2477.394124                Root MSE      =     .243

------------------------------------------------------------------------------
             |               Robust
join_rate_we | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
 var3_hybrid |   .1483927   .0400314     3.71   0.000     .0699054    .2268799
 var5_hybrid |  -1.972943   2.323317    -0.85   0.396    -6.528132    2.582247
        var4 |    .314638   .3963802     0.79   0.427    -.4625212    1.091797
------------------------------------------------------------------------------
Underidentification test (Kleibergen-Paap rk LM statistic):              0.693
                                                   Chi-sq(1) P-val =    0.4053
------------------------------------------------------------------------------
Weak identification test (Cragg-Donald Wald F statistic):               17.312
                         (Kleibergen-Paap rk Wald F statistic):          0.345
Stock-Yogo weak ID test critical values: 10% maximal IV size              7.03
                                         15% maximal IV size              4.58
                                         20% maximal IV size              3.95
                                         25% maximal IV size              3.63
Source: Stock-Yogo (2005).  Reproduced by permission.
NB: Critical values are for Cragg-Donald F statistic and i.i.d. errors.
------------------------------------------------------------------------------
Hansen J statistic (overidentification test of all instruments):         0.000
                                                 (equation exactly identified)
------------------------------------------------------------------------------
Instrumented:         var3_hybrid var5_hybrid
Included instruments: var4
Excluded instruments: var6 var7
Partialled-out:       _cons
                      nb: total SS, model F and R2s are after partialling-out;
                          any small-sample adjustments include partialled-out
                          variables in regressor count K
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
     firm_id |      3508        3508           0    *|
          yh |        12           1          11     |
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
→ Processing leave_rate_we
(MWFE estimator converged in 4 iterations)

HDFE Linear regression                            Number of obs   =     41,980
Absorbing 2 HDFE groups                           F(   3,   3507) =      14.50
Statistics robust to heteroskedasticity           Prob > F        =     0.0000
                                                  R-squared       =     0.9177
                                                  Adj R-squared   =     0.9102
                                                  Within R-sq.    =     0.0031
Number of clusters (firm_id) =      3,508         Root MSE        =     0.0866

                            (Std. err. adjusted for 3,508 clusters in firm_id)
------------------------------------------------------------------------------
             |               Robust
leave_rate~e | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
 var3_hybrid |  -.0002561    .001994    -0.13   0.898    -.0041657    .0036536
 var5_hybrid |   .0025468   .0081672     0.31   0.755    -.0134661    .0185598
        var4 |   .0211053   .0037313     5.66   0.000     .0137896    .0284211
       _cons |   .2178578   .0004541   479.76   0.000     .2169674    .2187481
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
     firm_id |      3508        3508           0    *|
          yh |        12           1          11     |
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
(MWFE estimator converged in 4 iterations)

Stored estimation results
-------------------------
----------------------------------------------------------------------------------
             |           Dependent  Number of        
        Name | Command    variable     param.  Title 
-------------+--------------------------------------------------------------------
_ivreg2_va~d | ivreg2    var3_hybrid        3  First-stage regression: var3_hybrid
_ivreg2_va~d | ivreg2    var5_hybrid        3  First-stage regression: var5_hybrid
----------------------------------------------------------------------------------

IV (2SLS) estimation
--------------------

Estimates efficient for homoskedasticity only
Statistics robust to heteroskedasticity and clustering on firm_id

Number of clusters (firm_id) =    3508                Number of obs =    41980
                                                      F(  3,  3507) =    11.92
                                                      Prob > F      =   0.0000
Total (centered) SS     =   289.094656                Centered R2   =  -1.3618
Total (uncentered) SS   =   289.094656                Uncentered R2 =  -1.3618
Residual SS             =  682.7979156                Root MSE      =    .1276

------------------------------------------------------------------------------
             |               Robust
leave_rate~e | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
 var3_hybrid |   .1817872   .0322959     5.63   0.000     .1184665    .2451078
 var5_hybrid |  -1.151319   1.208021    -0.95   0.341    -3.519814    1.217175
        var4 |   .2474571   .2060369     1.20   0.230    -.1565072    .6514215
------------------------------------------------------------------------------
Underidentification test (Kleibergen-Paap rk LM statistic):              0.693
                                                   Chi-sq(1) P-val =    0.4053
------------------------------------------------------------------------------
Weak identification test (Cragg-Donald Wald F statistic):               17.312
                         (Kleibergen-Paap rk Wald F statistic):          0.345
Stock-Yogo weak ID test critical values: 10% maximal IV size              7.03
                                         15% maximal IV size              4.58
                                         20% maximal IV size              3.95
                                         25% maximal IV size              3.63
Source: Stock-Yogo (2005).  Reproduced by permission.
NB: Critical values are for Cragg-Donald F statistic and i.i.d. errors.
------------------------------------------------------------------------------
Hansen J statistic (overidentification test of all instruments):         0.000
                                                 (equation exactly identified)
------------------------------------------------------------------------------
Instrumented:         var3_hybrid var5_hybrid
Included instruments: var4
Excluded instruments: var6 var7
Partialled-out:       _cons
                      nb: total SS, model F and R2s are after partialling-out;
                          any small-sample adjustments include partialled-out
                          variables in regressor count K
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
     firm_id |      3508        3508           0    *|
          yh |        12           1          11     |
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation

. 
. 
. // 4) Close & export to CSV
. postclose handle

. use `out', clear

. export delimited using "`result_dir'/consolidated_results.csv", ///
>     replace delimiter(",") quote
file ../results/raw/firm_scaling_hybrid/consolidated_results.csv saved

. 
. * --- write first-stage CSV -----------------------------------------
. postclose handle_fs

. use `out_fs', clear

. export delimited using "`result_dir'/first_stage.csv", ///
>         replace delimiter(",") quote
file ../results/raw/firm_scaling_hybrid/first_stage.csv saved

. 
. di as result "→ second-stage CSV : `result_dir'/consolidated_results.csv"
→ second-stage CSV : ../results/raw/firm_scaling_hybrid/consolidated_results.csv

. di as result "→ first-stage  CSV : `result_dir'/first_stage.csv"
→ first-stage  CSV : ../results/raw/firm_scaling_hybrid/first_stage.csv

. 
end of do-file
