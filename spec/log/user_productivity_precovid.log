-----------------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/saul/Dropbox/Remote Work Startups/main/spec/log/user_productivity_precovid.log
  log type:  text
 opened on:  27 Jun 2025, 04:47:24

. 
. // 0) Setup environment
. do "../src/globals.do"

. global raw_data "../data/raw"

. global processed_data  "../data/processed"

. global results "../results/raw"

. global clean_results "../results/cleaned"

. 
. 
. 
. 
. 
end of do-file

. 
. // 1) Load worker‐level panel
. use "$processed_data/user_panel_`panel_variant'.dta", clear

. 
. generate byte in_modal_msa = (cbsacode == company_cbsacode) ///
>       if !missing(cbsacode, company_cbsacode)
(56,944 missing values generated)

. label var in_modal_msa "User in firm's modal CBSA (yh-specific)"

. 
. * 3) Three-way categorical variable: 0 outside | 1 inside | 2 unknown
. generate byte modal_cat = .
(231,305 missing values generated)

. replace  modal_cat = 1 if in_modal_msa == 1
(98,819 real changes made)

. replace  modal_cat = 0 if in_modal_msa == 0
(75,542 real changes made)

. replace  modal_cat = 2 if missing(in_modal_msa)
(56,944 real changes made)

. 
. 
. 
. 
. ivreghdfe total_contributions_q100                                   ///
>        ( c.(var3 var5)##i.modal_cat                                  /// endogenous
>          = c.(var6 var7)##i.modal_cat )                              /// instruments
>        var4 `spec_iv_exog'                                           ///
>        , absorb(firm_id#user_id yh) vce(cluster user_id) savefirst
(dropped 6597 singleton observations)
Warning - duplicate variables detected
Duplicates:         1.modal_cat 2.modal_cat
(MWFE estimator converged in 8 iterations)
equation not identified; must have at least as many instruments
not in the regression as there are instrumented variables
r(481);

end of do-file

r(481);

. do "/var/folders/hg/s3xm9w393gxby64_zklmhgbc0000gn/T//SD22469.000000"

.  
. ivreghdfe ///
>         total_contributions_q100  (var3 var5 = var6 var7) var4, ///
>         absorb(user_id firm_id yh) vce(cluster user_id) 
(dropped 1443 singleton observations)
(MWFE estimator converged in 80 iterations)

IV (2SLS) estimation
--------------------

Estimates efficient for homoskedasticity only
Statistics robust to heteroskedasticity and clustering on user_id

Number of clusters (user_id) =   35789                Number of obs =   229862
                                                      F(  3, 35788) =     7.03
                                                      Prob > F      =   0.0001
Total (centered) SS     =  65286353.41                Centered R2   =  -0.0014
Total (uncentered) SS   =  65286353.41                Uncentered R2 =  -0.0014
Residual SS             =  65377411.43                Root MSE      =    16.94

------------------------------------------------------------------------------
             |               Robust
total_co~100 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        var3 |  -7.151334   3.898685    -1.83   0.067    -14.79287    .4902066
        var5 |   9.937201   5.370722     1.85   0.064    -.5895776    20.46398
        var4 |  -8.364159    4.04877    -2.07   0.039    -16.29987    -.428447
------------------------------------------------------------------------------
Underidentification test (Kleibergen-Paap rk LM statistic):            266.393
                                                   Chi-sq(1) P-val =    0.0000
------------------------------------------------------------------------------
Weak identification test (Cragg-Donald Wald F statistic):             1850.988
                         (Kleibergen-Paap rk Wald F statistic):        140.597
Stock-Yogo weak ID test critical values: 10% maximal IV size              7.03
                                         15% maximal IV size              4.58
                                         20% maximal IV size              3.95
                                         25% maximal IV size              3.63
Source: Stock-Yogo (2005).  Reproduced by permission.
NB: Critical values are for Cragg-Donald F statistic and i.i.d. errors.
------------------------------------------------------------------------------
Hansen J statistic (overidentification test of all instruments):         0.000
                                                 (equation exactly identified)
------------------------------------------------------------------------------
Instrumented:         var3 var5
Included instruments: var4
Excluded instruments: var6 var7
Partialled-out:       _cons
                      nb: total SS, model F and R2s are after partialling-out;
                          any small-sample adjustments include partialled-out
                          variables in regressor count K
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
     user_id |     35789       35789           0    *|
     firm_id |      2151           1        2150     |
          yh |        11           1          10     |
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation

. 
end of do-file

. do "/var/folders/hg/s3xm9w393gxby64_zklmhgbc0000gn/T//SD22469.000000"

. *-----------------------------------------------------------------------
. * heterogeneity_distance_base.do   —  IV split by distance tercile
. *   base controls:  var3  var4
. *-----------------------------------------------------------------------
. args panel_variant

. if "`panel_variant'"=="" local panel_variant "precovid"

. 
. use "$processed_data/user_panel_`panel_variant'.dta", clear

. 
. * 1.  Build firm-level distance terciles ---------------------------------
. preserve

.     keep firm_id avg_dist_2019
variable avg_dist_2019 not found
r(111);

end of do-file

r(111);

. do "/var/folders/hg/s3xm9w393gxby64_zklmhgbc0000gn/T//SD22469.000000"

. *-----------------------------------------------------------------------
. * heterogeneity_distance_base.do   —  IV split by distance tercile
. *   base controls:  var3  var4
. *-----------------------------------------------------------------------
. args panel_variant

. if "`panel_variant'"=="" local panel_variant "precovid"

. 
. use "$processed_data/user_panel_`panel_variant'.dta", clear

. 
. * 1.  Build firm-level distance terciles ---------------------------------
. preserve

.     keep firm_id avg_dist_2019
variable avg_dist_2019 not found
r(111);

end of do-file

r(111);

. do "/var/folders/hg/s3xm9w393gxby64_zklmhgbc0000gn/T//SD22469.000000"

. *-----------------------------------------------------------------------
. * heterogeneity_distance_base.do   —  IV split by distance tercile
. *   base controls:  var3  var4
. *-----------------------------------------------------------------------
. args panel_variant

. if "`panel_variant'"=="" local panel_variant "precovid"

. 
. use "$processed_data/user_panel_`panel_variant'.dta", clear

. 
. * 1.  Build firm-level distance terciles ---------------------------------
. preserve

.     keep firm_id avgdist_km

.     duplicates drop firm_id, force          // one row per firm

Duplicates in terms of firm_id

(229,081 observations deleted)

.     xtile gdist_tile = avgdist_km, nq(3) // 1=short  2=med  3=long

.     keep firm_id gdist_tile

.     tempfile dist_tiles

.     save `dist_tiles'
file /var/folders/hg/s3xm9w393gxby64_zklmhgbc0000gn/T//S_22469.000002 saved as .dta format

. restore

. 
. merge m:1 firm_id using `dist_tiles', nogenerate
(label firm_id already defined)

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                           231,305  
    -----------------------------------------

. label define gdt 1 "short-dist" 2 "medium" 3 "long-dist"

. label values gdist_tile gdt

. 
. * 2.  Prepare logging & output ------------------------------------------
. cap mkdir "log"

. capture log close
