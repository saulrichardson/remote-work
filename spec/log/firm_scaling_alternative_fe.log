-----------------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/saul/Dropbox/Remote Work Startups/main/spec/log/firm_scaling_alternative_fe.log
  log type:  text
 opened on:  28 May 2025, 04:24:52

. 
. // 0) Setup environment
. do "../src/globals.do"

. global raw_data "../data/raw"

. global processed_data  "../data/processed"

. global results "../results/raw"

. global clean_results "../results/cleaned"

. 
. 
. 
end of do-file

. 
. // 1) Common settings
. local result_dir "$results/`specname'"

. capture mkdir "`result_dir'"

. 
. local outcomes    growth_rate_we join_rate_we leave_rate_we

. 
. *--- main results -------------------------------------------------------------
. tempfile out  

. capture postclose handle

. postfile handle ///
>     str40   model_type          ///
>     str40   fe_tag              ///
>     str40  outcome             ///
>     str40  param               ///
>     double coef se pval pre_mean ///
>     double rkf nobs            ///
>     using `out', replace
(file /var/folders/hg/s3xm9w393gxby64_zklmhgbc0000gn/T//S_39148.000001 not found)

. 
. 
. *--- first-stage results (coefficients + diagnostics) -------------------------
. tempfile out_fs

. capture postclose handle_fs

. postfile handle_fs ///
>     str8   fe_tag              ///  "fyh", "time", "firm", "none"
>     str20  outcome             ///
>     str8   endovar             ///  "var3" / "var5"
>     str40  param               ///  var6 / var7 / var4
>     double coef se pval        ///
>     double partialF rkf nobs   ///
>     using `out_fs', replace
(file /var/folders/hg/s3xm9w393gxby64_zklmhgbc0000gn/T//S_39148.000002 not found)

. 
. //-------------------------------------------------------------
. //  Firm × year FE ("fyh")
. //-------------------------------------------------------------
. local feopt "absorb(firm_id yh)"

. local tag   "fyh"

. 
. foreach y of local outcomes {
  2.     use "$processed_data/firm_panel.dta", clear
  3.     display as text ">> FE spec: firm×year  (tag=`tag')"
  4.     display as text "   – outcome: `y'"
  5. 
.     summarize `y' if covid == 0, meanonly
  6.     local pre_mean = r(mean)
  7. 
.     // OLS
.      reghdfe `y' var3 var5 var4, ///
>         `feopt' vce(cluster firm_id)
  8.                 
.         local N = e(N)  
  9.         
.     foreach p in var3 var5 var4 {
 10.         local b    = _b[`p']
 11.         local se   = _se[`p']
 12.         local t    = `b'/`se'
 13.         local pval = 2*ttail(e(df_r), abs(`t'))
 14. 
.                 post handle ("OLS") ("`tag'") ("`y'") ("`p'") ///
>                                         (`b') (`se') (`pval') (`pre_mean') ///
>                                         (.) (`N')
 15.     }
 16. 
.     // IV (2nd stage)
.      ivreghdfe ///
>         `y' (var3 var5 = var6 var7) var4, ///
>         `feopt' vce(cluster firm_id) savefirst
 17.     
.         local rkf = e(rkf)
 18.         local N = e(N)  
 19.         
.     foreach p in var3 var5 var4 {
 20.         local b    = _b[`p']
 21.         local se   = _se[`p']
 22.         local t    = `b'/`se'
 23.         local pval = 2*ttail(e(df_r), abs(`t'))
 24.                 post handle ("IV") ("`tag'") ("`y'") ("`p'") ///
>                                         (`b') (`se') (`pval') (`pre_mean') ///
>                                         (`rkf') (`N')
 25.     }
 26.         
.         *--- pull partial F's from the stacked matrix
.         matrix FS = e(first)
 27.         local F3 = FS[4,1]
 28.         local F5 = FS[4,2]
 29. 
.         *========= var3 first stage ===================================================
.         estimates restore _ivreg2_var3
 30.         local N_fs = e(N)
 31. 
.         foreach p in var6 var7 var4 {
 32.                 local b    = _b[`p']
 33.                 local se   = _se[`p']
 34.                 local t    = `b'/`se'
 35.                 local pval = 2*ttail(e(df_r), abs(`t'))
 36. 
.                 post handle_fs ("`tag'") ("`y'") ("var3") ("`p'") ///
>                                                 (`b') (`se') (`pval') ///
>                                                 (`F3') (`rkf') (`N_fs')
 37.         }
 38. 
.         *========= var5 first stage ===================================================
.         estimates restore _ivreg2_var5
 39.         local N_fs = e(N)
 40. 
.         foreach p in var6 var7 var4 {
 41.                 local b    = _b[`p']
 42.                 local se   = _se[`p']
 43.                 local t    = `b'/`se'
 44.                 local pval = 2*ttail(e(df_r), abs(`t'))
 45. 
.                 post handle_fs ("`tag'") ("`y'") ("var5") ("`p'") ///
>                                                 (`b') (`se') (`pval') ///
>                                                 (`F5') (`rkf') (`N_fs')
 46.         }
 47. 
. }
>> FE spec: firm×year  (tag=fyh)
   – outcome: growth_rate_we
(MWFE estimator converged in 4 iterations)

HDFE Linear regression                            Number of obs   =     41,980
Absorbing 2 HDFE groups                           F(   3,   3507) =      24.67
Statistics robust to heteroskedasticity           Prob > F        =     0.0000
                                                  R-squared       =     0.3488
                                                  Adj R-squared   =     0.2892
                                                  Within R-sq.    =     0.0055
Number of clusters (firm_id) =      3,508         Root MSE        =     0.1853

                            (Std. err. adjusted for 3,508 clusters in firm_id)
------------------------------------------------------------------------------
             |               Robust
growth_rat~e | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        var3 |   .0032223   .0046965     0.69   0.493    -.0059859    .0124305
        var5 |   .0699523   .0236946     2.95   0.003     .0234957     .116409
        var4 |   -.117261   .0211647    -5.54   0.000    -.1587573   -.0757646
       _cons |   .0998093   .0012425    80.33   0.000     .0973732    .1022453
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
     firm_id |      3508        3508           0    *|
          yh |        12           1          11     |
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
(MWFE estimator converged in 4 iterations)

Stored estimation results
-------------------------
---------------------------------------------------------------------------
             |           Dependent  Number of        
        Name | Command    variable     param.  Title 
-------------+-------------------------------------------------------------
_ivreg2_var3 | ivreg2         var3          3  First-stage regression: var3
_ivreg2_var5 | ivreg2         var5          3  First-stage regression: var5
---------------------------------------------------------------------------

IV (2SLS) estimation
--------------------

Estimates efficient for homoskedasticity only
Statistics robust to heteroskedasticity and clustering on firm_id

Number of clusters (firm_id) =    3508                Number of obs =    41980
                                                      F(  3,  3507) =    22.94
                                                      Prob > F      =   0.0000
Total (centered) SS     =   1327.10484                Centered R2   =   0.0022
Total (uncentered) SS   =   1327.10484                Uncentered R2 =   0.0022
Residual SS             =  1324.192664                Root MSE      =    .1776

------------------------------------------------------------------------------
             |               Robust
growth_rat~e | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        var3 |   .0057809   .0093488     0.62   0.536    -.0125488    .0241105
        var5 |   .2088021   .1017564     2.05   0.040     .0092944    .4083098
        var4 |   -.236576   .0865024    -2.73   0.006     -.406176    -.066976
------------------------------------------------------------------------------
Underidentification test (Kleibergen-Paap rk LM statistic):             25.467
                                                   Chi-sq(1) P-val =    0.0000
------------------------------------------------------------------------------
Weak identification test (Cragg-Donald Wald F statistic):             1388.072
                         (Kleibergen-Paap rk Wald F statistic):         16.530
Stock-Yogo weak ID test critical values: 10% maximal IV size              7.03
                                         15% maximal IV size              4.58
                                         20% maximal IV size              3.95
                                         25% maximal IV size              3.63
Source: Stock-Yogo (2005).  Reproduced by permission.
NB: Critical values are for Cragg-Donald F statistic and i.i.d. errors.
------------------------------------------------------------------------------
Hansen J statistic (overidentification test of all instruments):         0.000
                                                 (equation exactly identified)
------------------------------------------------------------------------------
Instrumented:         var3 var5
Included instruments: var4
Excluded instruments: var6 var7
Partialled-out:       _cons
                      nb: total SS, model F and R2s are after partialling-out;
                          any small-sample adjustments include partialled-out
                          variables in regressor count K
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
     firm_id |      3508        3508           0    *|
          yh |        12           1          11     |
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
(results _ivreg2_var3 are active now)
(results _ivreg2_var5 are active now)
>> FE spec: firm×year  (tag=fyh)
   – outcome: join_rate_we
(MWFE estimator converged in 4 iterations)

HDFE Linear regression                            Number of obs   =     41,980
Absorbing 2 HDFE groups                           F(   3,   3507) =      16.09
Statistics robust to heteroskedasticity           Prob > F        =     0.0000
                                                  R-squared       =     0.4474
                                                  Adj R-squared   =     0.3968
                                                  Within R-sq.    =     0.0039
Number of clusters (firm_id) =      3,508         Root MSE        =     0.1825

                            (Std. err. adjusted for 3,508 clusters in firm_id)
------------------------------------------------------------------------------
             |               Robust
join_rate_we | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        var3 |   .0115876   .0047489     2.44   0.015     .0022767    .0208986
        var5 |   .0499891   .0255344     1.96   0.050    -.0000747     .100053
        var4 |  -.0917713   .0229648    -4.00   0.000    -.1367969   -.0467456
       _cons |   .2215334   .0012685   174.64   0.000     .2190464    .2240205
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
     firm_id |      3508        3508           0    *|
          yh |        12           1          11     |
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
(MWFE estimator converged in 4 iterations)

Stored estimation results
-------------------------
---------------------------------------------------------------------------
             |           Dependent  Number of        
        Name | Command    variable     param.  Title 
-------------+-------------------------------------------------------------
_ivreg2_var3 | ivreg2         var3          3  First-stage regression: var3
_ivreg2_var5 | ivreg2         var5          3  First-stage regression: var5
---------------------------------------------------------------------------

IV (2SLS) estimation
--------------------

Estimates efficient for homoskedasticity only
Statistics robust to heteroskedasticity and clustering on firm_id

Number of clusters (firm_id) =    3508                Number of obs =    41980
                                                      F(  3,  3507) =    19.32
                                                      Prob > F      =   0.0000
Total (centered) SS     =  1286.526586                Centered R2   =  -0.0044
Total (uncentered) SS   =  1286.526586                Uncentered R2 =  -0.0044
Residual SS             =   1292.12859                Root MSE      =    .1755

------------------------------------------------------------------------------
             |               Robust
join_rate_we | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        var3 |    .041513   .0097864     4.24   0.000     .0223253    .0607007
        var5 |   .2280918   .1118871     2.04   0.042     .0087214    .4474622
        var4 |  -.2524649   .0954801    -2.64   0.008    -.4396672   -.0652627
------------------------------------------------------------------------------
Underidentification test (Kleibergen-Paap rk LM statistic):             25.467
                                                   Chi-sq(1) P-val =    0.0000
------------------------------------------------------------------------------
Weak identification test (Cragg-Donald Wald F statistic):             1388.072
                         (Kleibergen-Paap rk Wald F statistic):         16.530
Stock-Yogo weak ID test critical values: 10% maximal IV size              7.03
                                         15% maximal IV size              4.58
                                         20% maximal IV size              3.95
                                         25% maximal IV size              3.63
Source: Stock-Yogo (2005).  Reproduced by permission.
NB: Critical values are for Cragg-Donald F statistic and i.i.d. errors.
------------------------------------------------------------------------------
Hansen J statistic (overidentification test of all instruments):         0.000
                                                 (equation exactly identified)
------------------------------------------------------------------------------
Instrumented:         var3 var5
Included instruments: var4
Excluded instruments: var6 var7
Partialled-out:       _cons
                      nb: total SS, model F and R2s are after partialling-out;
                          any small-sample adjustments include partialled-out
                          variables in regressor count K
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
     firm_id |      3508        3508           0    *|
          yh |        12           1          11     |
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
(results _ivreg2_var3 are active now)
(results _ivreg2_var5 are active now)
>> FE spec: firm×year  (tag=fyh)
   – outcome: leave_rate_we
(MWFE estimator converged in 4 iterations)

HDFE Linear regression                            Number of obs   =     41,980
Absorbing 2 HDFE groups                           F(   3,   3507) =      29.72
Statistics robust to heteroskedasticity           Prob > F        =     0.0000
                                                  R-squared       =     0.9178
                                                  Adj R-squared   =     0.9103
                                                  Within R-sq.    =     0.0042
Number of clusters (firm_id) =      3,508         Root MSE        =     0.0865

                            (Std. err. adjusted for 3,508 clusters in firm_id)
------------------------------------------------------------------------------
             |               Robust
leave_rate~e | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        var3 |   .0157066   .0024799     6.33   0.000     .0108445    .0205687
        var5 |  -.0129816   .0114508    -1.13   0.257    -.0354325    .0094693
        var4 |   .0281589    .010186     2.76   0.006     .0081879    .0481299
       _cons |   .2141062   .0006591   324.85   0.000     .2128139    .2153984
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
     firm_id |      3508        3508           0    *|
          yh |        12           1          11     |
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
(MWFE estimator converged in 4 iterations)

Stored estimation results
-------------------------
---------------------------------------------------------------------------
             |           Dependent  Number of        
        Name | Command    variable     param.  Title 
-------------+-------------------------------------------------------------
_ivreg2_var3 | ivreg2         var3          3  First-stage regression: var3
_ivreg2_var5 | ivreg2         var5          3  First-stage regression: var5
---------------------------------------------------------------------------

IV (2SLS) estimation
--------------------

Estimates efficient for homoskedasticity only
Statistics robust to heteroskedasticity and clustering on firm_id

Number of clusters (firm_id) =    3508                Number of obs =    41980
                                                      F(  3,  3507) =    47.95
                                                      Prob > F      =   0.0000
Total (centered) SS     =   289.094656                Centered R2   =  -0.0162
Total (uncentered) SS   =   289.094656                Uncentered R2 =  -0.0162
Residual SS             =  293.7884509                Root MSE      =   .08367

------------------------------------------------------------------------------
             |               Robust
leave_rate~e | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        var3 |   .0508551   .0052991     9.60   0.000     .0404655    .0612447
        var5 |   .0924074   .0577613     1.60   0.110    -.0208418    .2056565
        var4 |  -.0719351   .0496241    -1.45   0.147    -.1692301      .02536
------------------------------------------------------------------------------
Underidentification test (Kleibergen-Paap rk LM statistic):             25.467
                                                   Chi-sq(1) P-val =    0.0000
------------------------------------------------------------------------------
Weak identification test (Cragg-Donald Wald F statistic):             1388.072
                         (Kleibergen-Paap rk Wald F statistic):         16.530
Stock-Yogo weak ID test critical values: 10% maximal IV size              7.03
                                         15% maximal IV size              4.58
                                         20% maximal IV size              3.95
                                         25% maximal IV size              3.63
Source: Stock-Yogo (2005).  Reproduced by permission.
NB: Critical values are for Cragg-Donald F statistic and i.i.d. errors.
------------------------------------------------------------------------------
Hansen J statistic (overidentification test of all instruments):         0.000
                                                 (equation exactly identified)
------------------------------------------------------------------------------
Instrumented:         var3 var5
Included instruments: var4
Excluded instruments: var6 var7
Partialled-out:       _cons
                      nb: total SS, model F and R2s are after partialling-out;
                          any small-sample adjustments include partialled-out
                          variables in regressor count K
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
     firm_id |      3508        3508           0    *|
          yh |        12           1          11     |
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
(results _ivreg2_var3 are active now)
(results _ivreg2_var5 are active now)

. 
. //-------------------------------------------------------------
. // Time FE ("time")
. //-------------------------------------------------------------
. local feopt "absorb(yh)"

. local tag   "time"

. 
. foreach y of local outcomes {
  2.     use "$processed_data/firm_panel.dta", clear
  3. 
.         gen var8 = remote * startup
  4.         gen var9 = teleworkable*startup
  5. 
.     summarize `y' if covid == 0, meanonly
  6.     local pre_mean = r(mean)
  7. 
.     summarize `y' if covid == 0, meanonly
  8.     local pre_mean = r(mean)
  9.         
.     display as text ">> FE spec: time  (tag=`tag')"
 10.     display as text "   – outcome: `y'"
 11. 
.     // OLS
.     reghdfe `y' var3 var5 var4 remote startup var8 covid, ///
>         `feopt' vce(cluster firm_id)
 12.         local N   = e(N)
 13.         
.     foreach p in var3 var5 var4 {
 14.         local b    = _b[`p']
 15.         local se   = _se[`p']
 16.         local t    = `b'/`se'
 17.         local pval = 2*ttail(e(df_r), abs(`t'))
 18. 
.                 post handle ("OLS") ("`tag'") ("`y'") ("`p'") ///
>                                         (`b') (`se') (`pval') (`pre_mean') ///
>                                         (.) (`N')
 19.     }
 20. 
.     // IV (2nd stage)
.      ivreghdfe ///
>         `y' (var3 var5 var8 remote = var6 var7 var9 teleworkable) var4 startup covid, ///
>         `feopt' vce(cluster firm_id) savefirst
 21.                 
.     local rkf = e(rkf)
 22.         local N   = e(N)
 23.         
.     foreach p in var3 var5 var4 {
 24.         local b    = _b[`p']
 25.         local se   = _se[`p']
 26.         local t    = `b'/`se'
 27.         local pval = 2*ttail(e(df_r), abs(`t'))
 28.                 post handle ("IV") ("`tag'") ("`y'") ("`p'") ///
>                                         (`b') (`se') (`pval') (`pre_mean') ///
>                                         (`rkf') (`N')
 29.     }
 30. 
.         *--- pull partial F's from the stacked matrix
.         matrix FS = e(first)
 31.         local F3 = FS[4,1]
 32.         local F5 = FS[4,2]
 33. 
.         *========= var3 first stage ===================================================
.         estimates restore _ivreg2_var3
 34.         local N_fs = e(N)
 35. 
.         foreach p in var6 var7 var4 {
 36.                 local b    = _b[`p']
 37.                 local se   = _se[`p']
 38.                 local t    = `b'/`se'
 39.                 local pval = 2*ttail(e(df_r), abs(`t'))
 40. 
.                 post handle_fs ("`tag'") ("`y'") ("var3") ("`p'") ///
>                                                 (`b') (`se') (`pval') ///
>                                                 (`F3') (`rkf') (`N_fs')
 41.         }
 42. 
.         *========= var5 first stage ===================================================
.         estimates restore _ivreg2_var5
 43.         local N_fs = e(N)
 44. 
.         foreach p in var6 var7 var4 {
 45.                 local b    = _b[`p']
 46.                 local se   = _se[`p']
 47.                 local t    = `b'/`se'
 48.                 local pval = 2*ttail(e(df_r), abs(`t'))
 49. 
.                 post handle_fs ("`tag'") ("`y'") ("var5") ("`p'") ///
>                                                 (`b') (`se') (`pval') ///
>                                                 (`F5') (`rkf') (`N_fs')
 50.         }
 51. 
. }
>> FE spec: time  (tag=time)
   – outcome: growth_rate_we
(MWFE estimator converged in 1 iterations)
note: covid is probably collinear with the fixed effects (all partialled-out values are close to zero; tol = 1.0e-09)

HDFE Linear regression                            Number of obs   =     41,980
Absorbing 1 HDFE group                            F(   6,   3507) =     186.05
Statistics robust to heteroskedasticity           Prob > F        =     0.0000
                                                  R-squared       =     0.1151
                                                  Adj R-squared   =     0.1147
                                                  Within R-sq.    =     0.0915
Number of clusters (firm_id) =      3,508         Root MSE        =     0.2067

                            (Std. err. adjusted for 3,508 clusters in firm_id)
------------------------------------------------------------------------------
             |               Robust
growth_rat~e | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        var3 |    .004299   .0047528     0.90   0.366    -.0050196    .0136176
        var5 |   .0657488   .0237122     2.77   0.006     .0192578    .1122399
        var4 |  -.1115675   .0211614    -5.27   0.000    -.1530574   -.0700776
      remote |   .0509947   .0051925     9.82   0.000     .0408141    .0611753
     startup |   .2281365    .021367    10.68   0.000     .1862436    .2700294
        var8 |  -.0911639   .0234642    -3.89   0.000    -.1371688   -.0451591
       covid |          0  (omitted)
       _cons |   .0293244   .0022782    12.87   0.000     .0248577    .0337911
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
          yh |        12           0          12     |
-----------------------------------------------------+
(MWFE estimator converged in 1 iterations)
--Break--
r(1);

end of do-file

--Break--
r(1);

. capture postclose handle

. do "/Users/saul/Dropbox/Remote Work Startups/main/spec/user_productivity.do"

. *============================================================*
. *  do/worker_productivity_regressions.do
. *  — Automated export of OLS, IV, and first‐stage partial F's
. *    for worker productivity outcomes
. *============================================================*
. 
. // 0) Setup environment
. do "../src/globals.do"

. global raw_data "../data/raw"

. global processed_data  "../data/processed"

. global results "../results/raw"

. global clean_results "../results/cleaned"

. 
. 
. 
end of do-file

. 
. // 1) Load worker‐level panel
. use "$processed_data/user_panel.dta", clear

. 
. // 2) Prepare output dir & reset any old postfile
. local specname    "user_productivity"

. local result_dir  "$results/`specname'"

. capture mkdir "`result_dir'"

. 
. capture postclose handle

. tempfile out

. *--- postfile header (main results) -------------------------------------------
. postfile handle ///
>     str8   model_type ///
>     str40  outcome     ///
>     str40  param       ///
>     double coef se pval pre_mean ///
>     double rkf nobs     ///
>     using `out', replace
(file /var/folders/hg/s3xm9w393gxby64_zklmhgbc0000gn/T//S_39148.000001 not found)

. 
. 
. *------------------------------------------------------------------
. *  First-stage results → first_stage_fstats.csv
. *------------------------------------------------------------------
. tempfile out_fs

. capture postclose handle_fs

. postfile handle_fs ///
>     str8   endovar            ///  var3 / var5
>     str40  param              ///  var6 / var7 / var4
>     double coef se pval       ///
>     double partialF rkf nobs  ///
>     using `out_fs', replace
(file /var/folders/hg/s3xm9w393gxby64_zklmhgbc0000gn/T//S_39148.000002 not found)

.         
. // 3) Loop over outcomes
. local outcomes total_contributions_q100 restricted_contributions_q100

. local fs_done 0

. 
. foreach y of local outcomes {
  2.     di as text "→ Processing outcome: `y'"
  3. 
.     summarize `y' if covid == 0, meanonly
  4.     local pre_mean = r(mean)
  5. 
.     // ----- OLS -----
.     reghdfe `y' var3 var5 var4, absorb(user_id firm_id yh) ///
>         vce(cluster user_id)
  6.                 
.         local N = e(N) 
  7.         
.     foreach p in var3 var5 var4 {
  8.         local b    = _b[`p']
  9.         local se   = _se[`p']
 10.         local t    = `b'/`se'
 11.         local pval = 2*ttail(e(df_r), abs(`t'))
 12.                 *--- inside the OLS loop ------------------------------------------------------
.         post handle ("OLS") ("`y'") ("`p'") ///
>                                         (`b') (`se') (`pval') (`pre_mean') ///
>                                         (.) (`N')                 // dot for rkf, then nobs
 13.     }
 14. 
.     // ----- IV (2nd‐stage) -----
.     ivreghdfe ///
>         `y' (var3 var5 = var6 var7) var4, ///
>         absorb(user_id firm_id yh) vce(cluster user_id) savefirst
 15.                 
.     local rkf = e(rkf)
 16.         local N = e(N) 
 17.         
.     foreach p in var3 var5 var4 {
 18.         local b    = _b[`p']
 19.         local se   = _se[`p']
 20.         local t    = `b'/`se'
 21.         local pval = 2*ttail(e(df_r), abs(`t'))
 22.                 *--- inside the IV loop -------------------------------------------------------
.         post handle ("IV") ("`y'") ("`p'") ///
>                                         (`b') (`se') (`pval') (`pre_mean') ///
>                                         (`rkf') (`N')            // rkf, then nobs
 23.     }
 24. 
.         if !`fs_done' {
 25.                 
.                 matrix FS = e(first)
 26.         local F3 = FS[4,1]
 27.         local F5 = FS[4,2]
 28. 
.                 /* -------- var3 first stage -------------------------------- */
.                 estimates restore _ivreg2_var3
 29.                 local N_fs = e(N)
 30.                 foreach p in var6 var7 var4 {
 31.                         local b    = _b[`p']
 32.                         local se   = _se[`p']
 33.                         local t    = `b'/`se'
 34.                         local pval = 2*ttail(e(df_r), abs(`t'))
 35. 
.                         post handle_fs ("var3") ("`p'") ///
>                                                         (`b') (`se') (`pval') ///
>                                                         (`F3') (`rkf') (`N_fs')
 36.                 }
 37. 
.                 /* -------- var5 first stage -------------------------------- */
.                 estimates restore _ivreg2_var5
 38.                 local N_fs = e(N)
 39.                 foreach p in var6 var7 var4 {
 40.                         local b    = _b[`p']
 41.                         local se   = _se[`p']
 42.                         local t    = `b'/`se'
 43.                         local pval = 2*ttail(e(df_r), abs(`t'))
 44. 
.                         post handle_fs ("var5") ("`p'") ///
>                                                         (`b') (`se') (`pval') ///
>                                                         (`F5') (`rkf') (`N_fs')
 45.                 }
 46. 
.                 local fs_done 1
 47.         }
 48. }
→ Processing outcome: total_contributions_q100
(dropped 25 singleton observations)
(MWFE estimator converged in 107 iterations)

HDFE Linear regression                            Number of obs   =     52,995
Absorbing 3 HDFE groups                           F(   3,   4819) =      19.81
Statistics robust to heteroskedasticity           Prob > F        =     0.0000
                                                  R-squared       =     0.7042
                                                  Adj R-squared   =     0.6669
                                                  Within R-sq.    =     0.0039
Number of clusters (user_id) =      4,820         Root MSE        =    16.8281

                            (Std. err. adjusted for 4,820 clusters in user_id)
------------------------------------------------------------------------------
             |               Robust
total_co~100 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        var3 |  -2.657995   .9855688    -2.70   0.007     -4.59016   -.7258303
        var5 |   9.178957   2.686348     3.42   0.001     3.912488    14.44543
        var4 |  -12.00981   2.334944    -5.14   0.000    -16.58736   -7.432249
       _cons |   51.52695   .3105467   165.92   0.000     50.91814    52.13577
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
     user_id |      4820        4820           0    *|
     firm_id |      1113           1        1112     |
          yh |        11           1          10     |
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
(dropped 25 singleton observations)
--Break--
r(1);

end of do-file

--Break--
r(1);

. capture postclose handle

. do "/Users/saul/Dropbox/Remote Work Startups/main/spec/user_productivity_alternative_fe.do"

. *============================================================*
. *  do/firm_scaling_alternative_fe_regressions.do
. *  — Automated export of OLS, IV, and first‐stage F's
. *    across four explicit FE specifications
. *============================================================*
. capture log close
