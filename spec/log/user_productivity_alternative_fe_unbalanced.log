-----------------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/saul/Dropbox/Remote Work Startups/main/spec/log/user_productivity_alternative_fe_unbalanced.log
  log type:  text
 opened on:   5 Jun 2025, 21:52:53

. 
. // 0) Setup environment
. do "../src/globals.do"

. global raw_data "../data/raw"

. global processed_data  "../data/processed"

. global results "../results/raw"

. global clean_results "../results/cleaned"

. 
. // default user panel variant (unbalanced | balanced | precovid)
. 
. *------------------------------------------------------------------*
. * Global controlling which user panel variant downstream scripts use.
. * If a value has already been set (e.g. by a driver file such as
. * `spec/run_productivity_variants.do`) we **respect** that choice; otherwise
. * fall back to the default "unbalanced".
. *------------------------------------------------------------------*
. 
. capture confirm global user_panel_variant

. if _rc {    // not yet defined → set default
.     global user_panel_variant "unbalanced"
. }

. 
. 
. 
end of do-file

. 
. // 1) Common settings
. local result_dir "$results/`specname'"

. capture mkdir "`result_dir'"

. 
. local outcomes total_contributions_q100 

. // restricted_contributions_q100
. 
. *--- main results -------------------------------------------------------------
. tempfile out  

. capture postclose handle

. postfile handle ///
>     str20   model_type          ///
>     str20   fe_tag              ///
>     str40  outcome             ///
>     str40  param               ///
>     double coef se pval pre_mean ///
>     double rkf nobs            ///
>     using `out', replace
(file /var/folders/hg/s3xm9w393gxby64_zklmhgbc0000gn/T//S_56802.000001 not found)

. 
. 
. *--- first-stage results (coefficients + diagnostics) -------------------------
. tempfile out_fs

. capture postclose handle_fs

. postfile handle_fs ///
>     str20   fe_tag              ///  "fyh", "time", "firm", "none"
>     str40  outcome             ///
>     str20   endovar             ///  "var3" / "var5"
>     str40  param               ///  var6 / var7 / var4
>     double coef se pval        ///
>     double partialF rkf nobs   ///
>     using `out_fs', replace
(file /var/folders/hg/s3xm9w393gxby64_zklmhgbc0000gn/T//S_56802.000002 not found)

. 
.         
. //-------------------------------------------------------------
. // Firm + user + year FE ("fyh")
. //-------------------------------------------------------------
. local feopt "absorb(firm_id user_id yh)"

. local tag   "fyhu"

. 
. 
. foreach y of local outcomes {
  2.     use "$processed_data/user_panel_${user_panel_variant}.dta", clear
  3.     display as text ">> FE spec: (tag=`tag')"
  4.     display as text "   – outcome: `y'"
  5. 
.     summarize `y' if covid == 0, meanonly
  6.     local pre_mean = r(mean)
  7. 
.     // OLS
.      reghdfe `y' var3 var5 var4, ///
>         `feopt' vce(cluster user_id)
  8.                 
.         local N = e(N)  
  9.         
.     foreach p in var3 var5 var4 {
 10.         local b    = _b[`p']
 11.         local se   = _se[`p']
 12.         local t    = `b'/`se'
 13.         local pval = 2*ttail(e(df_r), abs(`t'))
 14. 
.                 post handle ("OLS") ("`tag'") ("`y'") ("`p'") ///
>                                         (`b') (`se') (`pval') (`pre_mean') ///
>                                         (.) (`N')
 15.     }
 16. 
.     // IV (2nd stage)
.      ivreghdfe ///
>         `y' (var3 var5 = var6 var7) var4, ///
>         `feopt' vce(cluster user_id) savefirst
 17.     
.         local rkf = e(rkf)
 18.         local N = e(N)  
 19.         
.     foreach p in var3 var5 var4 {
 20.         local b    = _b[`p']
 21.         local se   = _se[`p']
 22.         local t    = `b'/`se'
 23.         local pval = 2*ttail(e(df_r), abs(`t'))
 24.                 post handle ("IV") ("`tag'") ("`y'") ("`p'") ///
>                                         (`b') (`se') (`pval') (`pre_mean') ///
>                                         (`rkf') (`N')
 25.     }
 26.         
.         *--- pull partial F's from the stacked matrix
.         matrix FS = e(first)
 27.         local F3 = FS[4,1]
 28.         local F5 = FS[4,2]
 29. 
.         *========= var3 first stage ===================================================
.         estimates restore _ivreg2_var3
 30.         local N_fs = e(N)
 31. 
.         foreach p in var6 var7 var4 {
 32.                 local b    = _b[`p']
 33.                 local se   = _se[`p']
 34.                 local t    = `b'/`se'
 35.                 local pval = 2*ttail(e(df_r), abs(`t'))
 36. 
.                 post handle_fs ("`tag'") ("`y'") ("var3") ("`p'") ///
>                                                 (`b') (`se') (`pval') ///
>                                                 (`F3') (`rkf') (`N_fs')
 37.         }
 38. 
.         *========= var5 first stage ===================================================
.         estimates restore _ivreg2_var5
 39.         local N_fs = e(N)
 40. 
.         foreach p in var6 var7 var4 {
 41.                 local b    = _b[`p']
 42.                 local se   = _se[`p']
 43.                 local t    = `b'/`se'
 44.                 local pval = 2*ttail(e(df_r), abs(`t'))
 45. 
.                 post handle_fs ("`tag'") ("`y'") ("var5") ("`p'") ///
>                                                 (`b') (`se') (`pval') ///
>                                                 (`F5') (`rkf') (`N_fs')
 46.         }
 47. 
. }
>> FE spec: (tag=fyhu)
   – outcome: total_contributions_q100
(dropped 5213 singleton observations)
(MWFE estimator converged in 85 iterations)

HDFE Linear regression                            Number of obs   =  1,226,437
Absorbing 3 HDFE groups                           F(   3, 171670) =       2.95
Statistics robust to heteroskedasticity           Prob > F        =     0.0313
                                                  R-squared       =     0.5991
                                                  Adj R-squared   =     0.5325
                                                  Within R-sq.    =     0.0000
Number of clusters (user_id) =    171,671         Root MSE        =    26.1900

                          (Std. err. adjusted for 171,671 clusters in user_id)
------------------------------------------------------------------------------
             |               Robust
total_co~100 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        var3 |   .3223181   .2543368     1.27   0.205    -.1761763    .8208125
        var5 |  -.4054472   .8094312    -0.50   0.616    -1.991914     1.18102
        var4 |  -.3104058   .6950712    -0.45   0.655     -1.67273    1.051918
       _cons |   37.58141   .0794106   473.25   0.000     37.42577    37.73706
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
     firm_id |      2908           1        2907     |
     user_id |    171671      171671           0    *|
          yh |        11           1          10     |
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
(dropped 5213 singleton observations)
(MWFE estimator converged in 85 iterations)

Stored estimation results
-------------------------
---------------------------------------------------------------------------
             |           Dependent  Number of        
        Name | Command    variable     param.  Title 
-------------+-------------------------------------------------------------
_ivreg2_var3 | ivreg2         var3          3  First-stage regression: var3
_ivreg2_var5 | ivreg2         var5          3  First-stage regression: var5
---------------------------------------------------------------------------

IV (2SLS) estimation
--------------------

Estimates efficient for homoskedasticity only
Statistics robust to heteroskedasticity and clustering on user_id

Number of clusters (user_id) =  171671                Number of obs =  1226437
                                                      F(  3,171670) =    16.97
                                                      Prob > F      =   0.0000
Total (centered) SS     =  721483497.2                Centered R2   =  -0.0072
Total (uncentered) SS   =  721483497.2                Uncentered R2 =  -0.0072
Residual SS             =  726708762.9                Root MSE      =    24.37

------------------------------------------------------------------------------
             |               Robust
total_co~100 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        var3 |   18.02349   2.774247     6.50   0.000     12.58603    23.46095
        var5 |  -14.02267   4.197679    -3.34   0.001    -22.25002   -5.795309
        var4 |   7.107938   3.135877     2.27   0.023      .961689    13.25419
------------------------------------------------------------------------------
Underidentification test (Kleibergen-Paap rk LM statistic):            739.157
                                                   Chi-sq(1) P-val =    0.0000
------------------------------------------------------------------------------
Weak identification test (Cragg-Donald Wald F statistic):             5564.793
                         (Kleibergen-Paap rk Wald F statistic):        382.383
Stock-Yogo weak ID test critical values: 10% maximal IV size              7.03
                                         15% maximal IV size              4.58
                                         20% maximal IV size              3.95
                                         25% maximal IV size              3.63
Source: Stock-Yogo (2005).  Reproduced by permission.
NB: Critical values are for Cragg-Donald F statistic and i.i.d. errors.
------------------------------------------------------------------------------
Hansen J statistic (overidentification test of all instruments):         0.000
                                                 (equation exactly identified)
------------------------------------------------------------------------------
Instrumented:         var3 var5
Included instruments: var4
Excluded instruments: var6 var7
Partialled-out:       _cons
                      nb: total SS, model F and R2s are after partialling-out;
                          any small-sample adjustments include partialled-out
                          variables in regressor count K
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
     firm_id |      2908           1        2907     |
     user_id |    171671      171671           0    *|
          yh |        11           1          10     |
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
(results _ivreg2_var3 are active now)
(results _ivreg2_var5 are active now)

. 
. 
. 
. //-------------------------------------------------------------
. // firm x user + yh
. //-------------------------------------------------------------
. local feopt "absorb(firm_id#user_id yh)"

. local tag   "firmbyuseryh"

. 
. 
. foreach y of local outcomes {
  2.     use "$processed_data/user_panel_${user_panel_variant}.dta", clear
  3.     display as text ">> FE spec: (tag=`tag')"
  4.     display as text "   – outcome: `y'"
  5.     summarize `y' if covid == 0, meanonly
  6.     local pre_mean = r(mean)
  7. 
.     // OLS
.      reghdfe `y' var3 var5 var4, ///
>         `feopt' vce(cluster user_id)
  8.                 
.         local N = e(N)  
  9.         
.     foreach p in var3 var5 var4 {
 10.         local b    = _b[`p']
 11.         local se   = _se[`p']
 12.         local t    = `b'/`se'
 13.         local pval = 2*ttail(e(df_r), abs(`t'))
 14. 
.                 post handle ("OLS") ("`tag'") ("`y'") ("`p'") ///
>                                         (`b') (`se') (`pval') (`pre_mean') ///
>                                         (.) (`N')
 15.     }
 16. 
.     // IV (2nd stage)
.      ivreghdfe ///
>         `y' (var3 var5 = var6 var7) var4, ///
>         `feopt' vce(cluster user_id) savefirst
 17.     
.         local rkf = e(rkf)
 18.         local N = e(N)  
 19.         
.     foreach p in var3 var5 var4 {
 20.         local b    = _b[`p']
 21.         local se   = _se[`p']
 22.         local t    = `b'/`se'
 23.         local pval = 2*ttail(e(df_r), abs(`t'))
 24.                 post handle ("IV") ("`tag'") ("`y'") ("`p'") ///
>                                         (`b') (`se') (`pval') (`pre_mean') ///
>                                         (`rkf') (`N')
 25.     }
 26.         
.         *--- pull partial F's from the stacked matrix
.         matrix FS = e(first)
 27.         local F3 = FS[4,1]
 28.         local F5 = FS[4,2]
 29. 
.         *========= var3 first stage ===================================================
.         estimates restore _ivreg2_var3
 30.         local N_fs = e(N)
 31. 
.         foreach p in var6 var7 var4 {
 32.                 local b    = _b[`p']
 33.                 local se   = _se[`p']
 34.                 local t    = `b'/`se'
 35.                 local pval = 2*ttail(e(df_r), abs(`t'))
 36. 
.                 post handle_fs ("`tag'") ("`y'") ("var3") ("`p'") ///
>                                                 (`b') (`se') (`pval') ///
>                                                 (`F3') (`rkf') (`N_fs')
 37.         }
 38. 
.         *========= var5 first stage ===================================================
.         estimates restore _ivreg2_var5
 39.         local N_fs = e(N)
 40. 
.         foreach p in var6 var7 var4 {
 41.                 local b    = _b[`p']
 42.                 local se   = _se[`p']
 43.                 local t    = `b'/`se'
 44.                 local pval = 2*ttail(e(df_r), abs(`t'))
 45. 
.                 post handle_fs ("`tag'") ("`y'") ("var5") ("`p'") ///
>                                                 (`b') (`se') (`pval') ///
>                                                 (`F5') (`rkf') (`N_fs')
 46.         }
 47. 
. }
>> FE spec: (tag=firmbyuseryh)
   – outcome: total_contributions_q100
(dropped 22156 singleton observations)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   =  1,209,494
Absorbing 2 HDFE groups                           F(   3, 170803) =       5.01
Statistics robust to heteroskedasticity           Prob > F        =     0.0018
                                                  R-squared       =     0.6249
                                                  Adj R-squared   =     0.5497
                                                  Within R-sq.    =     0.0000
Number of clusters (user_id) =    170,804         Root MSE        =    25.7028

                          (Std. err. adjusted for 170,804 clusters in user_id)
------------------------------------------------------------------------------
             |               Robust
total_co~100 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        var3 |   .2682453   .2623293     1.02   0.307    -.2459144     .782405
        var5 |   .1944829   .8390778     0.23   0.817    -1.450091    1.839057
        var4 |  -1.041445   .7207107    -1.45   0.148    -2.454022    .3711319
       _cons |   37.53529   .0818185   458.76   0.000     37.37493    37.69565
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------------+
       Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------------+---------------------------------------|
   firm_id#user_id |    201967      201967           0    *|
                yh |        11           1          10     |
-----------------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
(dropped 22156 singleton observations)
(MWFE estimator converged in 8 iterations)

Stored estimation results
-------------------------
---------------------------------------------------------------------------
             |           Dependent  Number of        
        Name | Command    variable     param.  Title 
-------------+-------------------------------------------------------------
_ivreg2_var3 | ivreg2         var3          3  First-stage regression: var3
_ivreg2_var5 | ivreg2         var5          3  First-stage regression: var5
---------------------------------------------------------------------------

IV (2SLS) estimation
--------------------

Estimates efficient for homoskedasticity only
Statistics robust to heteroskedasticity and clustering on user_id

Number of clusters (user_id) =  170804                Number of obs =  1209494
                                                      F(  3,170803) =    14.20
                                                      Prob > F      =   0.0000
Total (centered) SS     =  665608786.2                Centered R2   =  -0.0051
Total (uncentered) SS   =  665608786.2                Uncentered R2 =  -0.0051
Residual SS             =  669021780.8                Root MSE      =    23.52

------------------------------------------------------------------------------
             |               Robust
total_co~100 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        var3 |   15.21811   2.855205     5.33   0.000      9.62197    20.81425
        var5 |  -12.52659   4.245283    -2.95   0.003    -20.84725   -4.205929
        var4 |   6.229553   3.162297     1.97   0.049     .0315204    12.42759
------------------------------------------------------------------------------
Underidentification test (Kleibergen-Paap rk LM statistic):            636.371
                                                   Chi-sq(1) P-val =    0.0000
------------------------------------------------------------------------------
Weak identification test (Cragg-Donald Wald F statistic):             5446.192
                         (Kleibergen-Paap rk Wald F statistic):        329.916
Stock-Yogo weak ID test critical values: 10% maximal IV size              7.03
                                         15% maximal IV size              4.58
                                         20% maximal IV size              3.95
                                         25% maximal IV size              3.63
Source: Stock-Yogo (2005).  Reproduced by permission.
NB: Critical values are for Cragg-Donald F statistic and i.i.d. errors.
------------------------------------------------------------------------------
Hansen J statistic (overidentification test of all instruments):         0.000
                                                 (equation exactly identified)
------------------------------------------------------------------------------
Instrumented:         var3 var5
Included instruments: var4
Excluded instruments: var6 var7
Partialled-out:       _cons
                      nb: total SS, model F and R2s are after partialling-out;
                          any small-sample adjustments include partialled-out
                          variables in regressor count K
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------------+
       Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------------+---------------------------------------|
   firm_id#user_id |    201967      201967           0    *|
                yh |        11           1          10     |
-----------------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
(results _ivreg2_var3 are active now)
(results _ivreg2_var5 are active now)

. 
. 
. 
. 
. //-------------------------------------------------------------
. //  Firm + year FE ("fyh")
. //-------------------------------------------------------------
. local feopt "absorb(firm_id yh)"

. local tag   "fyh"

. 
. foreach y of local outcomes {
  2.     use "$processed_data/user_panel_${user_panel_variant}.dta", clear
  3.     display as text ">> FE spec: (tag=`tag')"
  4.     display as text "   – outcome: `y'"
  5.     summarize `y' if covid == 0, meanonly
  6.     local pre_mean = r(mean)
  7. 
.     // OLS
.      reghdfe `y' var3 var5 var4, ///
>         `feopt' vce(cluster user_id)
  8.                 
.         local N = e(N)  
  9.         
.     foreach p in var3 var5 var4 {
 10.         local b    = _b[`p']
 11.         local se   = _se[`p']
 12.         local t    = `b'/`se'
 13.         local pval = 2*ttail(e(df_r), abs(`t'))
 14. 
.                 post handle ("OLS") ("`tag'") ("`y'") ("`p'") ///
>                                         (`b') (`se') (`pval') (`pre_mean') ///
>                                         (.) (`N')
 15.     }
 16. 
.     // IV (2nd stage)
.      ivreghdfe ///
>         `y' (var3 var5 = var6 var7) var4, ///
>         `feopt' vce(cluster user_id) savefirst
 17.     
.         local rkf = e(rkf)
 18.         local N = e(N)  
 19.         
.     foreach p in var3 var5 var4 {
 20.         local b    = _b[`p']
 21.         local se   = _se[`p']
 22.         local t    = `b'/`se'
 23.         local pval = 2*ttail(e(df_r), abs(`t'))
 24.                 post handle ("IV") ("`tag'") ("`y'") ("`p'") ///
>                                         (`b') (`se') (`pval') (`pre_mean') ///
>                                         (`rkf') (`N')
 25.     }
 26.         
.         *--- pull partial F's from the stacked matrix
.         matrix FS = e(first)
 27.         local F3 = FS[4,1]
 28.         local F5 = FS[4,2]
 29. 
.         *========= var3 first stage ===================================================
.         estimates restore _ivreg2_var3
 30.         local N_fs = e(N)
 31. 
.         foreach p in var6 var7 var4 {
 32.                 local b    = _b[`p']
 33.                 local se   = _se[`p']
 34.                 local t    = `b'/`se'
 35.                 local pval = 2*ttail(e(df_r), abs(`t'))
 36. 
.                 post handle_fs ("`tag'") ("`y'") ("var3") ("`p'") ///
>                                                 (`b') (`se') (`pval') ///
>                                                 (`F3') (`rkf') (`N_fs')
 37.         }
 38. 
.         *========= var5 first stage ===================================================
.         estimates restore _ivreg2_var5
 39.         local N_fs = e(N)
 40. 
.         foreach p in var6 var7 var4 {
 41.                 local b    = _b[`p']
 42.                 local se   = _se[`p']
 43.                 local t    = `b'/`se'
 44.                 local pval = 2*ttail(e(df_r), abs(`t'))
 45. 
.                 post handle_fs ("`tag'") ("`y'") ("var5") ("`p'") ///
>                                                 (`b') (`se') (`pval') ///
>                                                 (`F5') (`rkf') (`N_fs')
 46.         }
 47. 
. }
>> FE spec: (tag=fyh)
   – outcome: total_contributions_q100
(dropped 34 singleton observations)
(MWFE estimator converged in 5 iterations)

HDFE Linear regression                            Number of obs   =  1,231,616
Absorbing 2 HDFE groups                           F(   3, 176848) =       5.09
Statistics robust to heteroskedasticity           Prob > F        =     0.0016
                                                  R-squared       =     0.0940
                                                  Adj R-squared   =     0.0919
                                                  Within R-sq.    =     0.0000
Number of clusters (user_id) =    176,849         Root MSE        =    36.4982

                          (Std. err. adjusted for 176,849 clusters in user_id)
------------------------------------------------------------------------------
             |               Robust
total_co~100 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        var3 |   .3344855   .2901464     1.15   0.249    -.2341949     .903166
        var5 |  -.6922989   1.099214    -0.63   0.529    -2.846734    1.462137
        var4 |  -.5572912   .9503926    -0.59   0.558    -2.420039    1.305457
       _cons |   37.73044   .1151258   327.73   0.000      37.5048    37.95608
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
     firm_id |      2909           0        2909     |
          yh |        11           1          10     |
-----------------------------------------------------+
(dropped 34 singleton observations)
(MWFE estimator converged in 5 iterations)

Stored estimation results
-------------------------
---------------------------------------------------------------------------
             |           Dependent  Number of        
        Name | Command    variable     param.  Title 
-------------+-------------------------------------------------------------
_ivreg2_var3 | ivreg2         var3          3  First-stage regression: var3
_ivreg2_var5 | ivreg2         var5          3  First-stage regression: var5
---------------------------------------------------------------------------

IV (2SLS) estimation
--------------------

Estimates efficient for homoskedasticity only
Statistics robust to heteroskedasticity and clustering on user_id

Number of clusters (user_id) =  176849                Number of obs =  1231616
                                                      F(  3,176848) =    17.40
                                                      Prob > F      =   0.0000
Total (centered) SS     =   1636797038                Centered R2   =  -0.0033
Total (uncentered) SS   =   1636797038                Uncentered R2 =  -0.0033
Residual SS             =   1642272913                Root MSE      =    36.56

------------------------------------------------------------------------------
             |               Robust
total_co~100 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        var3 |   15.52046   2.861951     5.42   0.000     9.911103    21.12982
        var5 |  -.2713738   5.530495    -0.05   0.961    -11.11102    10.56827
        var4 |  -4.284604   4.349609    -0.99   0.325    -12.80974    4.240531
------------------------------------------------------------------------------
Underidentification test (Kleibergen-Paap rk LM statistic):           1169.866
                                                   Chi-sq(1) P-val =    0.0000
------------------------------------------------------------------------------
Weak identification test (Cragg-Donald Wald F statistic):             6265.728
                         (Kleibergen-Paap rk Wald F statistic):        607.291
Stock-Yogo weak ID test critical values: 10% maximal IV size              7.03
                                         15% maximal IV size              4.58
                                         20% maximal IV size              3.95
                                         25% maximal IV size              3.63
Source: Stock-Yogo (2005).  Reproduced by permission.
NB: Critical values are for Cragg-Donald F statistic and i.i.d. errors.
------------------------------------------------------------------------------
Hansen J statistic (overidentification test of all instruments):         0.000
                                                 (equation exactly identified)
------------------------------------------------------------------------------
Instrumented:         var3 var5
Included instruments: var4
Excluded instruments: var6 var7
Partialled-out:       _cons
                      nb: total SS, model F and R2s are after partialling-out;
                          any small-sample adjustments include partialled-out
                          variables in regressor count K
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
     firm_id |      2909           0        2909     |
          yh |        11           1          10     |
-----------------------------------------------------+
(results _ivreg2_var3 are active now)
(results _ivreg2_var5 are active now)

. 
. 
. 
. local feopt "absorb(user_id yh)"

. local tag   "useryh"

. 
. foreach y of local outcomes {
  2.     use "$processed_data/user_panel_${user_panel_variant}.dta", clear
  3.     display as text ">> FE spec: (tag=`tag')"
  4.     display as text "   – outcome: `y'"
  5.     summarize `y' if covid == 0, meanonly
  6.     local pre_mean = r(mean)
  7. 
.     // OLS
.      reghdfe `y' var3 var5 var4, ///
>         `feopt' vce(cluster user_id)
  8.                 
.         local N = e(N)  
  9.         
.     foreach p in var3 var5 var4 {
 10.         local b    = _b[`p']
 11.         local se   = _se[`p']
 12.         local t    = `b'/`se'
 13.         local pval = 2*ttail(e(df_r), abs(`t'))
 14. 
.                 post handle ("OLS") ("`tag'") ("`y'") ("`p'") ///
>                                         (`b') (`se') (`pval') (`pre_mean') ///
>                                         (.) (`N')
 15.     }
 16. 
.     // IV (2nd stage)
.      ivreghdfe ///
>         `y' (var3 var5 = var6 var7) var4, ///
>         `feopt' vce(cluster user_id) savefirst
 17.     
.         local rkf = e(rkf)
 18.         local N = e(N)  
 19.         
.     foreach p in var3 var5 var4 {
 20.         local b    = _b[`p']
 21.         local se   = _se[`p']
 22.         local t    = `b'/`se'
 23.         local pval = 2*ttail(e(df_r), abs(`t'))
 24.                 post handle ("IV") ("`tag'") ("`y'") ("`p'") ///
>                                         (`b') (`se') (`pval') (`pre_mean') ///
>                                         (`rkf') (`N')
 25.     }
 26.         
.         *--- pull partial F's from the stacked matrix
.         matrix FS = e(first)
 27.         local F3 = FS[4,1]
 28.         local F5 = FS[4,2]
 29. 
.         *========= var3 first stage ===================================================
.         estimates restore _ivreg2_var3
 30.         local N_fs = e(N)
 31. 
.         foreach p in var6 var7 var4 {
 32.                 local b    = _b[`p']
 33.                 local se   = _se[`p']
 34.                 local t    = `b'/`se'
 35.                 local pval = 2*ttail(e(df_r), abs(`t'))
 36. 
.                 post handle_fs ("`tag'") ("`y'") ("var3") ("`p'") ///
>                                                 (`b') (`se') (`pval') ///
>                                                 (`F3') (`rkf') (`N_fs')
 37.         }
 38. 
.         *========= var5 first stage ===================================================
.         estimates restore _ivreg2_var5
 39.         local N_fs = e(N)
 40. 
.         foreach p in var6 var7 var4 {
 41.                 local b    = _b[`p']
 42.                 local se   = _se[`p']
 43.                 local t    = `b'/`se'
 44.                 local pval = 2*ttail(e(df_r), abs(`t'))
 45. 
.                 post handle_fs ("`tag'") ("`y'") ("var5") ("`p'") ///
>                                                 (`b') (`se') (`pval') ///
>                                                 (`F5') (`rkf') (`N_fs')
 46.         }
 47. 
. }
>> FE spec: (tag=useryh)
   – outcome: total_contributions_q100
(dropped 5191 singleton observations)
(MWFE estimator converged in 7 iterations)

HDFE Linear regression                            Number of obs   =  1,226,459
Absorbing 2 HDFE groups                           F(   3, 171671) =      11.08
Statistics robust to heteroskedasticity           Prob > F        =     0.0000
                                                  R-squared       =     0.5953
                                                  Adj R-squared   =     0.5294
                                                  Within R-sq.    =     0.0000
Number of clusters (user_id) =    171,672         Root MSE        =    26.2774

                          (Std. err. adjusted for 171,672 clusters in user_id)
------------------------------------------------------------------------------
             |               Robust
total_co~100 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        var3 |   .6093411   .2448611     2.49   0.013     .1294188    1.089263
        var5 |   .1747514   .7439744     0.23   0.814    -1.283422    1.632925
        var4 |   .7667013   .6384164     1.20   0.230    -.4845806    2.017983
       _cons |   37.40151   .0765082   488.86   0.000     37.25156    37.55147
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
     user_id |    171672      171672           0    *|
          yh |        11           1          10     |
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
(dropped 5191 singleton observations)
(MWFE estimator converged in 7 iterations)

Stored estimation results
-------------------------
---------------------------------------------------------------------------
             |           Dependent  Number of        
        Name | Command    variable     param.  Title 
-------------+-------------------------------------------------------------
_ivreg2_var3 | ivreg2         var3          3  First-stage regression: var3
_ivreg2_var5 | ivreg2         var5          3  First-stage regression: var5
---------------------------------------------------------------------------

IV (2SLS) estimation
--------------------

Estimates efficient for homoskedasticity only
Statistics robust to heteroskedasticity and clustering on user_id

Number of clusters (user_id) =  171672                Number of obs =  1226459
                                                      F(  3,171671) =    46.55
                                                      Prob > F      =   0.0000
Total (centered) SS     =    728356328                Centered R2   =  -0.0199
Total (uncentered) SS   =    728356328                Uncentered R2 =  -0.0199
Residual SS             =  742843392.5                Root MSE      =    24.61

------------------------------------------------------------------------------
             |               Robust
total_co~100 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        var3 |   28.39056   2.709167    10.48   0.000     23.08066    33.70047
        var5 |   -20.7123     4.1288    -5.02   0.000    -28.80466   -12.61994
        var4 |   12.21378   3.099422     3.94   0.000     6.138981    18.28858
------------------------------------------------------------------------------
Underidentification test (Kleibergen-Paap rk LM statistic):            833.562
                                                   Chi-sq(1) P-val =    0.0000
------------------------------------------------------------------------------
Weak identification test (Cragg-Donald Wald F statistic):             5799.870
                         (Kleibergen-Paap rk Wald F statistic):        432.846
Stock-Yogo weak ID test critical values: 10% maximal IV size              7.03
                                         15% maximal IV size              4.58
                                         20% maximal IV size              3.95
                                         25% maximal IV size              3.63
Source: Stock-Yogo (2005).  Reproduced by permission.
NB: Critical values are for Cragg-Donald F statistic and i.i.d. errors.
------------------------------------------------------------------------------
Hansen J statistic (overidentification test of all instruments):         0.000
                                                 (equation exactly identified)
------------------------------------------------------------------------------
Instrumented:         var3 var5
Included instruments: var4
Excluded instruments: var6 var7
Partialled-out:       _cons
                      nb: total SS, model F and R2s are after partialling-out;
                          any small-sample adjustments include partialled-out
                          variables in regressor count K
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
     user_id |    171672      171672           0    *|
          yh |        11           1          10     |
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
(results _ivreg2_var3 are active now)
(results _ivreg2_var5 are active now)

. 
. 
. //-------------------------------------------------------------
. // Time FE ("time")
. //-------------------------------------------------------------
. local feopt "absorb(yh)"

. local tag   "time"

. 
. foreach y of local outcomes {
  2.     use "$processed_data/user_panel_${user_panel_variant}.dta", clear
  3. 
.         gen var8 = remote * startup
  4.         gen var9 = teleworkable*startup
  5. 
.     summarize `y' if covid == 0, meanonly
  6.     local pre_mean = r(mean)
  7.         
.     display as text ">> FE spec: time  (tag=`tag')"
  8.     display as text "   – outcome: `y'"
  9. 
.     // OLS
.     reghdfe `y' var3 var5 var4 remote startup var8 covid, ///
>         `feopt' vce(cluster user_id)
 10.         local N   = e(N)
 11.         
.     foreach p in var3 var5 var4 {
 12.         local b    = _b[`p']
 13.         local se   = _se[`p']
 14.         local t    = `b'/`se'
 15.         local pval = 2*ttail(e(df_r), abs(`t'))
 16. 
.                 post handle ("OLS") ("`tag'") ("`y'") ("`p'") ///
>                                         (`b') (`se') (`pval') (`pre_mean') ///
>                                         (.) (`N')
 17.     }
 18. 
.     // IV (2nd stage)
.      ivreghdfe ///
>         `y' (var3 var5 var8 remote = var6 var7 var9 teleworkable) var4 startup covid, ///
>         `feopt' vce(cluster user_id) savefirst
 19.                 
.     local rkf = e(rkf)
 20.         local N   = e(N)
 21.         
.     foreach p in var3 var5 var4 {
 22.         local b    = _b[`p']
 23.         local se   = _se[`p']
 24.         local t    = `b'/`se'
 25.         local pval = 2*ttail(e(df_r), abs(`t'))
 26.                 post handle ("IV") ("`tag'") ("`y'") ("`p'") ///
>                                         (`b') (`se') (`pval') (`pre_mean') ///
>                                         (`rkf') (`N')
 27.     }
 28. 
.         *--- pull partial F's from the stacked matrix
.         matrix FS = e(first)
 29.         local F3 = FS[4,1]
 30.         local F5 = FS[4,2]
 31. 
.         *========= var3 first stage ===================================================
.         estimates restore _ivreg2_var3
 32.         local N_fs = e(N)
 33. 
.         foreach p in var6 var7 var4 {
 34.                 local b    = _b[`p']
 35.                 local se   = _se[`p']
 36.                 local t    = `b'/`se'
 37.                 local pval = 2*ttail(e(df_r), abs(`t'))
 38. 
.                 post handle_fs ("`tag'") ("`y'") ("var3") ("`p'") ///
>                                                 (`b') (`se') (`pval') ///
>                                                 (`F3') (`rkf') (`N_fs')
 39.         }
 40. 
.         *========= var5 first stage ===================================================
.         estimates restore _ivreg2_var5
 41.         local N_fs = e(N)
 42. 
.         foreach p in var6 var7 var4 {
 43.                 local b    = _b[`p']
 44.                 local se   = _se[`p']
 45.                 local t    = `b'/`se'
 46.                 local pval = 2*ttail(e(df_r), abs(`t'))
 47. 
.                 post handle_fs ("`tag'") ("`y'") ("var5") ("`p'") ///
>                                                 (`b') (`se') (`pval') ///
>                                                 (`F5') (`rkf') (`N_fs')
 48.         }
 49. 
. }
(118,894 missing values generated)
>> FE spec: time  (tag=time)
   – outcome: total_contributions_q100
(MWFE estimator converged in 1 iterations)
note: covid is probably collinear with the fixed effects (all partialled-out values are close to zero; tol = 1.0e-09)

HDFE Linear regression                            Number of obs   =  1,231,650
Absorbing 1 HDFE group                            F(   6, 176862) =     793.74
Statistics robust to heteroskedasticity           Prob > F        =     0.0000
                                                  R-squared       =     0.0238
                                                  Adj R-squared   =     0.0238
                                                  Within R-sq.    =     0.0215
Number of clusters (user_id) =    176,863         Root MSE        =    37.8418

                          (Std. err. adjusted for 176,863 clusters in user_id)
------------------------------------------------------------------------------
             |               Robust
total_co~100 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        var3 |   1.001086    .303506     3.30   0.001     .4062209    1.595951
        var5 |  -.8336701   1.151382    -0.72   0.469    -3.090354    1.423013
        var4 |  -.4595636    .997177    -0.46   0.645    -2.414008    1.494881
      remote |   5.262082   .3052273    17.24   0.000     4.663843    5.860321
     startup |   14.84472   1.088548    13.64   0.000     12.71119    16.97825
        var8 |   2.777641   1.252443     2.22   0.027     .3228808      5.2324
       covid |          0  (omitted)
       _cons |   32.45364    .183817   176.55   0.000     32.09336    32.81392
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
          yh |        11           0          11     |
-----------------------------------------------------+
(MWFE estimator converged in 1 iterations)

Stored estimation results
-------------------------
-----------------------------------------------------------------------------
             |           Dependent  Number of        
        Name | Command    variable     param.  Title 
-------------+---------------------------------------------------------------
_ivreg2_var3 | ivreg2         var3          7  First-stage regression: var3
_ivreg2_var5 | ivreg2         var5          7  First-stage regression: var5
_ivreg2_var8 | ivreg2         var8          7  First-stage regression: var8
_ivreg2_re~e | ivreg2       remote          7  First-stage regression: remote
-----------------------------------------------------------------------------

IV (2SLS) estimation
--------------------

Estimates efficient for homoskedasticity only
Statistics robust to heteroskedasticity and clustering on user_id

Number of clusters (user_id) =  165109                Number of obs =  1112756
                                                      F(  6,165108) =    87.39
                                                      Prob > F      =   0.0000
Total (centered) SS     =   1637760756                Centered R2   = -2.6e+02
Total (uncentered) SS   =   1637760756                Uncentered R2 = -2.6e+02
Residual SS             =  4.27723e+11                Root MSE      =      620

------------------------------------------------------------------------------
             |               Robust
total_co~100 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        var3 |  -153.8179    35.6513    -4.31   0.000    -223.6937   -83.94217
        var5 |   11599.01   28860.38     0.40   0.688    -44966.72    68164.74
        var8 |  -11661.26    28860.2    -0.40   0.686    -68226.62    44904.11
      remote |   241.8916    35.9554     6.73   0.000     171.4198    312.3633
        var4 |  -9715.053   24258.56    -0.40   0.689     -57261.3     37831.2
     startup |   9765.441   24258.39     0.40   0.687    -37780.49    57311.37
       covid |          0  (omitted)
------------------------------------------------------------------------------
Underidentification test (Kleibergen-Paap rk LM statistic):              0.157
                                                   Chi-sq(1) P-val =    0.6919
------------------------------------------------------------------------------
Weak identification test (Cragg-Donald Wald F statistic):                1.428
                         (Kleibergen-Paap rk Wald F statistic):          0.039
Stock-Yogo weak ID test critical values:                       <not available>
------------------------------------------------------------------------------
Warning: estimated covariance matrix of moment conditions not of full rank.
         overidentification statistic not reported, and standard errors and
         model tests should be interpreted with caution.
Possible causes:
         number of clusters insufficient to calculate robust covariance matrix
         singleton dummy variable (dummy with one 1 and N-1 0s or vice versa)
partial option may address problem.
------------------------------------------------------------------------------
Collinearities detected among instruments: 1 instrument(s) dropped
Instrumented:         var3 var5 var8 remote
Included instruments: var4 startup covid
Excluded instruments: var6 var7 var9 teleworkable
Partialled-out:       _cons
                      nb: total SS, model F and R2s are after partialling-out;
                          any small-sample adjustments include partialled-out
                          variables in regressor count K
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
          yh |        11           0          11     |
-----------------------------------------------------+
(results _ivreg2_var3 are active now)
(results _ivreg2_var5 are active now)

. 
. //-------------------------------------------------------------
. // Firm FE ("firm")
. //-------------------------------------------------------------
. local feopt "absorb(firm_id)"

. local tag   "firm"

. 
. foreach y of local outcomes {
  2.     use "$processed_data/user_panel_${user_panel_variant}.dta", clear
  3. 
.     display as text ">> FE spec: firm  (tag=`tag')"
  4.     display as text "   – outcome: `y'"
  5. 
.     summarize `y' if covid == 0, meanonly
  6.     local pre_mean = r(mean)
  7. 
.     // OLS
.      reghdfe `y' var3 var5 var4 covid, ///
>         `feopt' vce(cluster user_id)
  8.         
.         local N   = e(N)
  9.         
.     foreach p in var3 var5 var4 {
 10.         local b    = _b[`p']
 11.         local se   = _se[`p']
 12.         local t    = `b'/`se'
 13.         local pval = 2*ttail(e(df_r), abs(`t'))
 14. 
.                 post handle ("OLS") ("`tag'") ("`y'") ("`p'") ///
>                                         (`b') (`se') (`pval') (`pre_mean') ///
>                                         (.) (`N')
 15.     }
 16. 
.     // IV (2nd stage)
.      ivreghdfe ///
>         `y' (var3 var5 = var6 var7) var4 covid, ///
>         `feopt' vce(cluster user_id) savefirst
 17.                 
.     local rkf = e(rkf)
 18.         local N   = e(N)
 19.         
.     foreach p in var3 var5 var4 {
 20.         local b    = _b[`p']
 21.         local se   = _se[`p']
 22.         local t    = `b'/`se'
 23.         local pval = 2*ttail(e(df_r), abs(`t'))
 24.                 post handle ("IV") ("`tag'") ("`y'") ("`p'") ///
>                                         (`b') (`se') (`pval') (`pre_mean') ///
>                                         (`rkf') (`N')
 25.     }
 26. 
.         *--- pull partial F's from the stacked matrix
.         matrix FS = e(first)
 27.         local F3 = FS[4,1]
 28.         local F5 = FS[4,2]
 29. 
.         *========= var3 first stage ===================================================
.         estimates restore _ivreg2_var3
 30.         local N_fs = e(N)
 31. 
.         foreach p in var6 var7 var4 {
 32.                 local b    = _b[`p']
 33.                 local se   = _se[`p']
 34.                 local t    = `b'/`se'
 35.                 local pval = 2*ttail(e(df_r), abs(`t'))
 36. 
.                 post handle_fs ("`tag'") ("`y'") ("var3") ("`p'") ///
>                                                 (`b') (`se') (`pval') ///
>                                                 (`F3') (`rkf') (`N_fs')
 37.         }
 38. 
.         *========= var5 first stage ===================================================
.         estimates restore _ivreg2_var5
 39.         local N_fs = e(N)
 40. 
.         foreach p in var6 var7 var4 {
 41.                 local b    = _b[`p']
 42.                 local se   = _se[`p']
 43.                 local t    = `b'/`se'
 44.                 local pval = 2*ttail(e(df_r), abs(`t'))
 45. 
.                 post handle_fs ("`tag'") ("`y'") ("var5") ("`p'") ///
>                                                 (`b') (`se') (`pval') ///
>                                                 (`F5') (`rkf') (`N_fs')
 46.         }
 47. 
. }
>> FE spec: firm  (tag=firm)
   – outcome: total_contributions_q100
(dropped 34 singleton observations)
(MWFE estimator converged in 1 iterations)

HDFE Linear regression                            Number of obs   =  1,231,616
Absorbing 1 HDFE group                            F(   4, 176848) =     449.75
Statistics robust to heteroskedasticity           Prob > F        =     0.0000
                                                  R-squared       =     0.0921
                                                  Adj R-squared   =     0.0899
                                                  Within R-sq.    =     0.0019
Number of clusters (user_id) =    176,849         Root MSE        =    36.5376

                          (Std. err. adjusted for 176,849 clusters in user_id)
------------------------------------------------------------------------------
             |               Robust
total_co~100 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        var3 |   .3431246   .2902677     1.18   0.237    -.2257935    .9120427
        var5 |  -.8533436   1.099828    -0.78   0.438    -3.008982    1.302295
        var4 |   -.255987    .950581    -0.27   0.788    -2.119104     1.60713
       covid |   -3.37067   .1948924   -17.30   0.000    -3.752655   -2.988686
       _cons |   39.40042   .0790532   498.40   0.000     39.24548    39.55537
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
     firm_id |      2909           0        2909     |
-----------------------------------------------------+
(dropped 34 singleton observations)
(MWFE estimator converged in 1 iterations)

Stored estimation results
-------------------------
---------------------------------------------------------------------------
             |           Dependent  Number of        
        Name | Command    variable     param.  Title 
-------------+-------------------------------------------------------------
_ivreg2_var3 | ivreg2         var3          4  First-stage regression: var3
_ivreg2_var5 | ivreg2         var5          4  First-stage regression: var5
---------------------------------------------------------------------------

IV (2SLS) estimation
--------------------

Estimates efficient for homoskedasticity only
Statistics robust to heteroskedasticity and clustering on user_id

Number of clusters (user_id) =  176849                Number of obs =  1231616
                                                      F(  4,176848) =   450.81
                                                      Prob > F      =   0.0000
Total (centered) SS     =   1643495414                Centered R2   =  -0.0013
Total (uncentered) SS   =   1643495414                Uncentered R2 =  -0.0013
Residual SS             =   1645602589                Root MSE      =     36.6

------------------------------------------------------------------------------
             |               Robust
total_co~100 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        var3 |   15.25396    2.86167     5.33   0.000     9.645146    20.86276
        var5 |  -.8200342   5.531481    -0.15   0.882    -11.66161    10.02154
        var4 |  -3.599578   4.350216    -0.83   0.408     -12.1259    4.926747
       covid |  -12.52295   1.757181    -7.13   0.000    -15.96698    -9.07891
------------------------------------------------------------------------------
Underidentification test (Kleibergen-Paap rk LM statistic):           1169.857
                                                   Chi-sq(1) P-val =    0.0000
------------------------------------------------------------------------------
Weak identification test (Cragg-Donald Wald F statistic):             6265.664
                         (Kleibergen-Paap rk Wald F statistic):        607.291
Stock-Yogo weak ID test critical values: 10% maximal IV size              7.03
                                         15% maximal IV size              4.58
                                         20% maximal IV size              3.95
                                         25% maximal IV size              3.63
Source: Stock-Yogo (2005).  Reproduced by permission.
NB: Critical values are for Cragg-Donald F statistic and i.i.d. errors.
------------------------------------------------------------------------------
Hansen J statistic (overidentification test of all instruments):         0.000
                                                 (equation exactly identified)
------------------------------------------------------------------------------
Instrumented:         var3 var5
Included instruments: var4 covid
Excluded instruments: var6 var7
Partialled-out:       _cons
                      nb: total SS, model F and R2s are after partialling-out;
                          any small-sample adjustments include partialled-out
                          variables in regressor count K
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
     firm_id |      2909           0        2909     |
-----------------------------------------------------+
(results _ivreg2_var3 are active now)
(results _ivreg2_var5 are active now)

. 
. //-------------------------------------------------------------
. // No FE ("none")
. //-------------------------------------------------------------
. local feopt ""

. local tag   "none"

. 
. foreach y of local outcomes {
  2.     use "$processed_data/user_panel_${user_panel_variant}.dta", clear
  3.         
.         gen var8 = remote * startup
  4.     gen var9 = teleworkable*startup
  5. 
.     summarize `y' if covid == 0, meanonly
  6.     local pre_mean = r(mean)
  7. 
.     display as text ">> FE spec: none  (tag=`tag')"
  8.     display as text "   – outcome: `y'"
  9. 
.     // OLS
.     reghdfe `y' var3 var5 var4 remote startup var8 covid, ///
>         absorb() vce(cluster user_id)
 10.                 
.         local N   = e(N)
 11.         
.     foreach p in var3 var5 var4 {
 12.         local b    = _b[`p']
 13.         local se   = _se[`p']
 14.         local t    = `b'/`se'
 15.         local pval = 2*ttail(e(df_r), abs(`t'))
 16. 
.                 post handle ("OLS") ("`tag'") ("`y'") ("`p'") ///
>                                         (`b') (`se') (`pval') (`pre_mean') ///
>                                         (.) (`N')
 17.     }
 18. 
.     // IV (2nd stage)
.     ivreghdfe ///
>         `y' (var3 var5 var8 remote = var6 var7 var9 teleworkable) var4 startup covid, ///
>         absorb() vce(cluster user_id) savefirst
 19.     local rkf = e(rkf)
 20.         local N   = e(N)
 21.         
.     foreach p in var3 var5 var4 {
 22.         local b    = _b[`p']
 23.         local se   = _se[`p']
 24.         local t    = `b'/`se'
 25.         local pval = 2*ttail(e(df_r), abs(`t'))
 26.                 post handle ("IV") ("`tag'") ("`y'") ("`p'") ///
>                                         (`b') (`se') (`pval') (`pre_mean') ///
>                                         (`rkf') (`N')
 27.     }
 28. 
.         *--- pull partial F's from the stacked matrix
.         matrix FS = e(first)
 29.         local F3 = FS[4,1]
 30.         local F5 = FS[4,2]
 31. 
.         *========= var3 first stage ===================================================
.         estimates restore _ivreg2_var3
 32.         local N_fs = e(N)
 33. 
.         foreach p in var6 var7 var4 {
 34.                 local b    = _b[`p']
 35.                 local se   = _se[`p']
 36.                 local t    = `b'/`se'
 37.                 local pval = 2*ttail(e(df_r), abs(`t'))
 38. 
.                 post handle_fs ("`tag'") ("`y'") ("var3") ("`p'") ///
>                                                 (`b') (`se') (`pval') ///
>                                                 (`F3') (`rkf') (`N_fs')
 39.         }
 40. 
.         *========= var5 first stage ===================================================
.         estimates restore _ivreg2_var5
 41.         local N_fs = e(N)
 42. 
.         foreach p in var6 var7 var4 {
 43.                 local b    = _b[`p']
 44.                 local se   = _se[`p']
 45.                 local t    = `b'/`se'
 46.                 local pval = 2*ttail(e(df_r), abs(`t'))
 47. 
.                 post handle_fs ("`tag'") ("`y'") ("var5") ("`p'") ///
>                                                 (`b') (`se') (`pval') ///
>                                                 (`F5') (`rkf') (`N_fs')
 48.         }
 49. 
. }
(118,894 missing values generated)
>> FE spec: none  (tag=none)
   – outcome: total_contributions_q100
(MWFE estimator converged in 1 iterations)

HDFE Linear regression                            Number of obs   =  1,231,650
Absorbing 1 HDFE group                            F(   7, 176862) =     821.46
Statistics robust to heteroskedasticity           Prob > F        =     0.0000
                                                  R-squared       =     0.0221
                                                  Adj R-squared   =     0.0221
                                                  Within R-sq.    =     0.0221
Number of clusters (user_id) =    176,863         Root MSE        =    37.8749

                          (Std. err. adjusted for 176,863 clusters in user_id)
------------------------------------------------------------------------------
             |               Robust
total_co~100 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        var3 |   .9953323   .3036181     3.28   0.001     .4002477    1.590417
        var5 |  -.9717242   1.151658    -0.84   0.399    -3.228948      1.2855
        var4 |  -.2675098   .9971814    -0.27   0.788    -2.221963    1.686943
      remote |   5.236956   .3051641    17.16   0.000     4.638841    5.835071
     startup |    14.5631   1.088821    13.38   0.000     12.42904    16.69717
        var8 |   2.921914   1.252987     2.33   0.020     .4660873     5.37774
       covid |  -3.359225   .2016837   -16.66   0.000     -3.75452   -2.963929
       _cons |   34.15963   .2010592   169.90   0.000     33.76556     34.5537
------------------------------------------------------------------------------

Stored estimation results
-------------------------
-----------------------------------------------------------------------------
             |           Dependent  Number of        
        Name | Command    variable     param.  Title 
-------------+---------------------------------------------------------------
_ivreg2_var3 | ivreg2         var3          8  First-stage regression: var3
_ivreg2_var5 | ivreg2         var5          8  First-stage regression: var5
_ivreg2_var8 | ivreg2         var8          8  First-stage regression: var8
_ivreg2_re~e | ivreg2       remote          8  First-stage regression: remote
-----------------------------------------------------------------------------

IV (2SLS) estimation
--------------------

Estimates efficient for homoskedasticity only
Statistics robust to heteroskedasticity and clustering on user_id

Number of clusters (user_id) =  165109                Number of obs =  1112756
                                                      F(  7,165108) =   102.76
                                                      Prob > F      =   0.0000
Total (centered) SS     =   1641535486                Centered R2   = -2.5e+02
Total (uncentered) SS   =   3290988985                Uncentered R2 = -1.3e+02
Residual SS             =  4.19698e+11                Root MSE      =    614.1

------------------------------------------------------------------------------
             |               Robust
total_co~100 | Coefficient  std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
        var3 |  -149.7901   34.98316    -4.28   0.000    -218.3559    -81.2244
        var5 |   11486.68   28415.52     0.40   0.686    -44206.71    67180.07
        var8 |  -11548.92   28415.33    -0.41   0.684    -67241.95     44144.1
      remote |   237.6974   35.28464     6.74   0.000     168.5408     306.854
        var4 |  -9620.675   23883.67    -0.40   0.687     -56431.8    37190.45
     startup |   9671.006    23883.5     0.40   0.686     -37139.8    56481.81
       covid |   88.65392   21.41125     4.14   0.000     46.68864    130.6192
       _cons |  -107.4904   21.58924    -4.98   0.000    -149.8045   -65.17626
------------------------------------------------------------------------------
Underidentification test (Kleibergen-Paap rk LM statistic):              0.159
                                                   Chi-sq(1) P-val =    0.6901
------------------------------------------------------------------------------
Weak identification test (Cragg-Donald Wald F statistic):                1.445
                         (Kleibergen-Paap rk Wald F statistic):          0.040
Stock-Yogo weak ID test critical values:                       <not available>
------------------------------------------------------------------------------
Hansen J statistic (overidentification test of all instruments):         0.000
                                                 (equation exactly identified)
------------------------------------------------------------------------------
Instrumented:         var3 var5 var8 remote
Included instruments: var4 startup covid
Excluded instruments: var6 var7 var9 teleworkable
------------------------------------------------------------------------------
(results _ivreg2_var3 are active now)
(results _ivreg2_var5 are active now)

. 
. 
. 
. local feopt "absorb(firm_id user_id industry_id#yh)"

. local tag   "industrytime"

. 
. 
. foreach y of local outcomes {
  2.     use "$processed_data/user_panel_${user_panel_variant}.dta", clear
  3.     display as text ">> FE spec: (tag=`tag')"
  4.     display as text "   – outcome: `y'"
  5. 
.     summarize `y' if covid == 0, meanonly
  6.     local pre_mean = r(mean)
  7. 
.     // OLS
.      reghdfe `y' var3 var5 var4, ///
>         `feopt' vce(cluster user_id)
  8.                 
.         local N = e(N)  
  9.         
.     foreach p in var3 var5 var4 {
 10.         local b    = _b[`p']
 11.         local se   = _se[`p']
 12.         local t    = `b'/`se'
 13.         local pval = 2*ttail(e(df_r), abs(`t'))
 14. 
.                 post handle ("OLS") ("`tag'") ("`y'") ("`p'") ///
>                                         (`b') (`se') (`pval') (`pre_mean') ///
>                                         (.) (`N')
 15.     }
 16. 
.     // IV (2nd stage)
.      ivreghdfe ///
>         `y' (var3 var5 = var6 var7) var4, ///
>         `feopt' vce(cluster user_id) savefirst
 17.     
.         local rkf = e(rkf)
 18.         local N = e(N)  
 19.         
.     foreach p in var3 var5 var4 {
 20.         local b    = _b[`p']
 21.         local se   = _se[`p']
 22.         local t    = `b'/`se'
 23.         local pval = 2*ttail(e(df_r), abs(`t'))
 24.                 post handle ("IV") ("`tag'") ("`y'") ("`p'") ///
>                                         (`b') (`se') (`pval') (`pre_mean') ///
>                                         (`rkf') (`N')
 25.     }
 26.         
.         *--- pull partial F's from the stacked matrix
.         matrix FS = e(first)
 27.         local F3 = FS[4,1]
 28.         local F5 = FS[4,2]
 29. 
.         *========= var3 first stage ===================================================
.         estimates restore _ivreg2_var3
 30.         local N_fs = e(N)
 31. 
.         foreach p in var6 var7 var4 {
 32.                 local b    = _b[`p']
 33.                 local se   = _se[`p']
 34.                 local t    = `b'/`se'
 35.                 local pval = 2*ttail(e(df_r), abs(`t'))
 36. 
.                 post handle_fs ("`tag'") ("`y'") ("var3") ("`p'") ///
>                                                 (`b') (`se') (`pval') ///
>                                                 (`F3') (`rkf') (`N_fs')
 37.         }
 38. 
.         *========= var5 first stage ===================================================
.         estimates restore _ivreg2_var5
 39.         local N_fs = e(N)
 40. 
.         foreach p in var6 var7 var4 {
 41.                 local b    = _b[`p']
 42.                 local se   = _se[`p']
 43.                 local t    = `b'/`se'
 44.                 local pval = 2*ttail(e(df_r), abs(`t'))
 45. 
.                 post handle_fs ("`tag'") ("`y'") ("var5") ("`p'") ///
>                                                 (`b') (`se') (`pval') ///
>                                                 (`F5') (`rkf') (`N_fs')
 46.         }
 47. 
. }
>> FE spec: (tag=industrytime)
   – outcome: total_contributions_q100
(dropped 5214 singleton observations)
(MWFE estimator converged in 88 iterations)

HDFE Linear regression                            Number of obs   =  1,218,839
Absorbing 3 HDFE groups                           F(   3, 170725) =       1.74
Statistics robust to heteroskedasticity           Prob > F        =     0.1560
                                                  R-squared       =     0.5986
                                                  Adj R-squared   =     0.5318
                                                  Within R-sq.    =     0.0000
Number of clusters (user_id) =    170,726         Root MSE        =    26.1964

                          (Std. err. adjusted for 170,726 clusters in user_id)
------------------------------------------------------------------------------
             |               Robust
total_co~100 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        var3 |   .1620739   .2620696     0.62   0.536    -.3515768    .6757245
        var5 |  -.4886079   .8295068    -0.59   0.556    -2.114423    1.137207
        var4 |  -.1074205   .7169528    -0.15   0.881    -1.512632    1.297791
       _cons |   37.56477   .0815551   460.61   0.000     37.40492    37.72462
------------------------------------------------------------------------------

Absorbed degrees of freedom:
----------------------------------------------------------+
      Absorbed FE | Categories  - Redundant  = Num. Coefs |
------------------+---------------------------------------|
          firm_id |      2882           1        2881     |
          user_id |    170726      170726           0    *|
   industry_id#yh |       209          19         190     |
----------------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
(dropped 5214 singleton observations)
(MWFE estimator converged in 88 iterations)

Stored estimation results
-------------------------
---------------------------------------------------------------------------
             |           Dependent  Number of        
        Name | Command    variable     param.  Title 
-------------+-------------------------------------------------------------
_ivreg2_var3 | ivreg2         var3          3  First-stage regression: var3
_ivreg2_var5 | ivreg2         var5          3  First-stage regression: var5
---------------------------------------------------------------------------

IV (2SLS) estimation
--------------------

Estimates efficient for homoskedasticity only
Statistics robust to heteroskedasticity and clustering on user_id

Number of clusters (user_id) =  170726                Number of obs =  1218839
                                                      F(  3,170725) =     6.39
                                                      Prob > F      =   0.0003
Total (centered) SS     =  717163351.6                Centered R2   =  -0.0129
Total (uncentered) SS   =  717163351.6                Uncentered R2 =  -0.0129
Residual SS             =    726407906                Root MSE      =    24.44

------------------------------------------------------------------------------
             |               Robust
total_co~100 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        var3 |   24.34569   6.591654     3.69   0.000     11.42619    37.26518
        var5 |  -16.60579   4.881923    -3.40   0.001    -26.17425   -7.037334
        var4 |   7.645531   3.161727     2.42   0.016     1.448615    13.84245
------------------------------------------------------------------------------
Underidentification test (Kleibergen-Paap rk LM statistic):            204.261
                                                   Chi-sq(1) P-val =    0.0000
------------------------------------------------------------------------------
Weak identification test (Cragg-Donald Wald F statistic):             1006.513
                         (Kleibergen-Paap rk Wald F statistic):        103.638
Stock-Yogo weak ID test critical values: 10% maximal IV size              7.03
                                         15% maximal IV size              4.58
                                         20% maximal IV size              3.95
                                         25% maximal IV size              3.63
Source: Stock-Yogo (2005).  Reproduced by permission.
NB: Critical values are for Cragg-Donald F statistic and i.i.d. errors.
------------------------------------------------------------------------------
Hansen J statistic (overidentification test of all instruments):         0.000
                                                 (equation exactly identified)
------------------------------------------------------------------------------
Instrumented:         var3 var5
Included instruments: var4
Excluded instruments: var6 var7
Partialled-out:       _cons
                      nb: total SS, model F and R2s are after partialling-out;
                          any small-sample adjustments include partialled-out
                          variables in regressor count K
------------------------------------------------------------------------------

Absorbed degrees of freedom:
----------------------------------------------------------+
      Absorbed FE | Categories  - Redundant  = Num. Coefs |
------------------+---------------------------------------|
          firm_id |      2882           1        2881     |
          user_id |    170726      170726           0    *|
   industry_id#yh |       209          19         190     |
----------------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
(results _ivreg2_var3 are active now)
(results _ivreg2_var5 are active now)

. 
. 
. local feopt "absorb(firm_id user_id msa_id#yh)"

. local tag   "msatime"

. 
. 
. foreach y of local outcomes {
  2.     use "$processed_data/user_panel_${user_panel_variant}.dta", clear
  3.     display as text ">> FE spec: (tag=`tag')"
  4.     display as text "   – outcome: `y'"
  5. 
.     summarize `y' if covid == 0, meanonly
  6.     local pre_mean = r(mean)
  7. 
.     // OLS
.      reghdfe `y' var3 var5 var4, ///
>         `feopt' vce(cluster user_id)
  8.                 
.         local N = e(N)  
  9.         
.     foreach p in var3 var5 var4 {
 10.         local b    = _b[`p']
 11.         local se   = _se[`p']
 12.         local t    = `b'/`se'
 13.         local pval = 2*ttail(e(df_r), abs(`t'))
 14. 
.                 post handle ("OLS") ("`tag'") ("`y'") ("`p'") ///
>                                         (`b') (`se') (`pval') (`pre_mean') ///
>                                         (.) (`N')
 15.     }
 16. 
.     // IV (2nd stage)
.      ivreghdfe ///
>         `y' (var3 var5 = var6 var7) var4, ///
>         `feopt' vce(cluster user_id) savefirst
 17.     
.         local rkf = e(rkf)
 18.         local N = e(N)  
 19.         
.     foreach p in var3 var5 var4 {
 20.         local b    = _b[`p']
 21.         local se   = _se[`p']
 22.         local t    = `b'/`se'
 23.         local pval = 2*ttail(e(df_r), abs(`t'))
 24.                 post handle ("IV") ("`tag'") ("`y'") ("`p'") ///
>                                         (`b') (`se') (`pval') (`pre_mean') ///
>                                         (`rkf') (`N')
 25.     }
 26.         
.         *--- pull partial F's from the stacked matrix
.         matrix FS = e(first)
 27.         local F3 = FS[4,1]
 28.         local F5 = FS[4,2]
 29. 
.         *========= var3 first stage ===================================================
.         estimates restore _ivreg2_var3
 30.         local N_fs = e(N)
 31. 
.         foreach p in var6 var7 var4 {
 32.                 local b    = _b[`p']
 33.                 local se   = _se[`p']
 34.                 local t    = `b'/`se'
 35.                 local pval = 2*ttail(e(df_r), abs(`t'))
 36. 
.                 post handle_fs ("`tag'") ("`y'") ("var3") ("`p'") ///
>                                                 (`b') (`se') (`pval') ///
>                                                 (`F3') (`rkf') (`N_fs')
 37.         }
 38. 
.         *========= var5 first stage ===================================================
.         estimates restore _ivreg2_var5
 39.         local N_fs = e(N)
 40. 
.         foreach p in var6 var7 var4 {
 41.                 local b    = _b[`p']
 42.                 local se   = _se[`p']
 43.                 local t    = `b'/`se'
 44.                 local pval = 2*ttail(e(df_r), abs(`t'))
 45. 
.                 post handle_fs ("`tag'") ("`y'") ("var5") ("`p'") ///
>                                                 (`b') (`se') (`pval') ///
>                                                 (`F5') (`rkf') (`N_fs')
 46.         }
 47. 
. }
>> FE spec: (tag=msatime)
   – outcome: total_contributions_q100
(dropped 5625 singleton observations)
(MWFE estimator converged in 89 iterations)

HDFE Linear regression                            Number of obs   =  1,226,025
Absorbing 3 HDFE groups                           F(   3, 171638) =       2.67
Statistics robust to heteroskedasticity           Prob > F        =     0.0459
                                                  R-squared       =     0.6007
                                                  Adj R-squared   =     0.5328
                                                  Within R-sq.    =     0.0000
Number of clusters (user_id) =    171,639         Root MSE        =    26.1815

                          (Std. err. adjusted for 171,639 clusters in user_id)
------------------------------------------------------------------------------
             |               Robust
total_co~100 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        var3 |   .3431337   .2648059     1.30   0.195      -.17588    .8621475
        var5 |  -.4241724   .8167273    -0.52   0.604     -2.02494    1.176595
        var4 |  -.2714971    .702503    -0.39   0.699    -1.648387    1.105393
       _cons |   37.57224   .0827242   454.19   0.000      37.4101    37.73437
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
     firm_id |      2908           1        2907     |
     user_id |    171639      171639           0    *|
   msa_id#yh |      3665           1        3664     |
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
(dropped 5625 singleton observations)
(MWFE estimator converged in 89 iterations)

Stored estimation results
-------------------------
---------------------------------------------------------------------------
             |           Dependent  Number of        
        Name | Command    variable     param.  Title 
-------------+-------------------------------------------------------------
_ivreg2_var3 | ivreg2         var3          3  First-stage regression: var3
_ivreg2_var5 | ivreg2         var5          3  First-stage regression: var5
---------------------------------------------------------------------------

IV (2SLS) estimation
--------------------

Estimates efficient for homoskedasticity only
Statistics robust to heteroskedasticity and clustering on user_id

Number of clusters (user_id) =  171639                Number of obs =  1226025
                                                      F(  3,171638) =    16.72
                                                      Prob > F      =   0.0000
Total (centered) SS     =  718250028.4                Centered R2   =  -0.0051
Total (uncentered) SS   =  718250028.4                Uncentered R2 =  -0.0051
Residual SS             =  721900930.1                Root MSE      =    24.33

------------------------------------------------------------------------------
             |               Robust
total_co~100 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        var3 |   15.78632   2.422756     6.52   0.000     11.03777    20.53486
        var5 |  -12.81707   4.065032    -3.15   0.002    -20.78445   -4.849701
        var4 |   6.706177    3.09732     2.17   0.030     .6354983    12.77686
------------------------------------------------------------------------------
Underidentification test (Kleibergen-Paap rk LM statistic):           1024.915
                                                   Chi-sq(1) P-val =    0.0000
------------------------------------------------------------------------------
Weak identification test (Cragg-Donald Wald F statistic):             7776.696
                         (Kleibergen-Paap rk Wald F statistic):        536.926
Stock-Yogo weak ID test critical values: 10% maximal IV size              7.03
                                         15% maximal IV size              4.58
                                         20% maximal IV size              3.95
                                         25% maximal IV size              3.63
Source: Stock-Yogo (2005).  Reproduced by permission.
NB: Critical values are for Cragg-Donald F statistic and i.i.d. errors.
------------------------------------------------------------------------------
Hansen J statistic (overidentification test of all instruments):         0.000
                                                 (equation exactly identified)
------------------------------------------------------------------------------
Instrumented:         var3 var5
Included instruments: var4
Excluded instruments: var6 var7
Partialled-out:       _cons
                      nb: total SS, model F and R2s are after partialling-out;
                          any small-sample adjustments include partialled-out
                          variables in regressor count K
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
     firm_id |      2908           1        2907     |
     user_id |    171639      171639           0    *|
   msa_id#yh |      3665           1        3664     |
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
(results _ivreg2_var3 are active now)
(results _ivreg2_var5 are active now)

. 
. 
. 
. 
. local feopt "absorb(firm_id user_id msa_id#industry_id#yh)"

. local tag   "msaindustrytime"

. 
. 
. foreach y of local outcomes {
  2.     use "$processed_data/user_panel_${user_panel_variant}.dta", clear
  3.     display as text ">> FE spec: (tag=`tag')"
  4.     display as text "   – outcome: `y'"
  5. 
.     summarize `y' if covid == 0, meanonly
  6.     local pre_mean = r(mean)
  7. 
.     // OLS
.      reghdfe `y' var3 var5 var4, ///
>         `feopt' vce(cluster user_id)
  8.                 
.         local N = e(N)  
  9.         
.     foreach p in var3 var5 var4 {
 10.         local b    = _b[`p']
 11.         local se   = _se[`p']
 12.         local t    = `b'/`se'
 13.         local pval = 2*ttail(e(df_r), abs(`t'))
 14. 
.                 post handle ("OLS") ("`tag'") ("`y'") ("`p'") ///
>                                         (`b') (`se') (`pval') (`pre_mean') ///
>                                         (.) (`N')
 15.     }
 16. 
.     // IV (2nd stage)
.      ivreghdfe ///
>         `y' (var3 var5 = var6 var7) var4, ///
>         `feopt' vce(cluster user_id) savefirst
 17.     
.         local rkf = e(rkf)
 18.         local N = e(N)  
 19.         
.     foreach p in var3 var5 var4 {
 20.         local b    = _b[`p']
 21.         local se   = _se[`p']
 22.         local t    = `b'/`se'
 23.         local pval = 2*ttail(e(df_r), abs(`t'))
 24.                 post handle ("IV") ("`tag'") ("`y'") ("`p'") ///
>                                         (`b') (`se') (`pval') (`pre_mean') ///
>                                         (`rkf') (`N')
 25.     }
 26.         
.         *--- pull partial F's from the stacked matrix
.         matrix FS = e(first)
 27.         local F3 = FS[4,1]
 28.         local F5 = FS[4,2]
 29. 
.         *========= var3 first stage ===================================================
.         estimates restore _ivreg2_var3
 30.         local N_fs = e(N)
 31. 
.         foreach p in var6 var7 var4 {
 32.                 local b    = _b[`p']
 33.                 local se   = _se[`p']
 34.                 local t    = `b'/`se'
 35.                 local pval = 2*ttail(e(df_r), abs(`t'))
 36. 
.                 post handle_fs ("`tag'") ("`y'") ("var3") ("`p'") ///
>                                                 (`b') (`se') (`pval') ///
>                                                 (`F3') (`rkf') (`N_fs')
 37.         }
 38. 
.         *========= var5 first stage ===================================================
.         estimates restore _ivreg2_var5
 39.         local N_fs = e(N)
 40. 
.         foreach p in var6 var7 var4 {
 41.                 local b    = _b[`p']
 42.                 local se   = _se[`p']
 43.                 local t    = `b'/`se'
 44.                 local pval = 2*ttail(e(df_r), abs(`t'))
 45. 
.                 post handle_fs ("`tag'") ("`y'") ("var5") ("`p'") ///
>                                                 (`b') (`se') (`pval') ///
>                                                 (`F5') (`rkf') (`N_fs')
 46.         }
 47. 
. }
>> FE spec: (tag=msaindustrytime)
   – outcome: total_contributions_q100
(dropped 14648 singleton observations)
(MWFE estimator converged in 123 iterations)

HDFE Linear regression                            Number of obs   =  1,209,405
Absorbing 3 HDFE groups                           F(   3, 169752) =       1.54
Statistics robust to heteroskedasticity           Prob > F        =     0.2011
                                                  R-squared       =     0.6057
                                                  Adj R-squared   =     0.5333
                                                  Within R-sq.    =     0.0000
Number of clusters (user_id) =    169,753         Root MSE        =    26.1581

                          (Std. err. adjusted for 169,753 clusters in user_id)
------------------------------------------------------------------------------
             |               Robust
total_co~100 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        var3 |   .2874087   .2921616     0.98   0.325    -.2852217    .8600391
        var5 |   -.822809   .8809347    -0.93   0.350    -2.549421    .9038036
        var4 |    .201003   .7629655     0.26   0.792    -1.294393    1.696398
       _cons |    37.5452   .0910677   412.28   0.000     37.36671    37.72369
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-------------------------------------------------------------------+
               Absorbed FE | Categories  - Redundant  = Num. Coefs |
---------------------------+---------------------------------------|
                   firm_id |      2855           1        2854     |
                   user_id |    169753      169753           0    *|
     msa_id#industry_id#yh |     15050          29       15021     |
-------------------------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
(dropped 14648 singleton observations)
(MWFE estimator converged in 123 iterations)

Stored estimation results
-------------------------
---------------------------------------------------------------------------
             |           Dependent  Number of        
        Name | Command    variable     param.  Title 
-------------+-------------------------------------------------------------
_ivreg2_var3 | ivreg2         var3          3  First-stage regression: var3
_ivreg2_var5 | ivreg2         var5          3  First-stage regression: var5
---------------------------------------------------------------------------

IV (2SLS) estimation
--------------------

Estimates efficient for homoskedasticity only
Statistics robust to heteroskedasticity and clustering on user_id

Number of clusters (user_id) =  169753                Number of obs =  1209405
                                                      F(  3,169752) =     2.20
                                                      Prob > F      =   0.0855
Total (centered) SS     =    699148048                Centered R2   =  -0.0022
Total (uncentered) SS   =    699148048                Uncentered R2 =  -0.0022
Residual SS             =  700651466.1                Root MSE      =    24.25

------------------------------------------------------------------------------
             |               Robust
total_co~100 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        var3 |   11.25867   7.860592     1.43   0.152    -4.147922    26.66525
        var5 |  -9.022483   5.014429    -1.80   0.072    -18.85065    .8056878
        var4 |   4.540999   3.342752     1.36   0.174    -2.010721    11.09272
------------------------------------------------------------------------------
Underidentification test (Kleibergen-Paap rk LM statistic):            158.734
                                                   Chi-sq(1) P-val =    0.0000
------------------------------------------------------------------------------
Weak identification test (Cragg-Donald Wald F statistic):              819.608
                         (Kleibergen-Paap rk Wald F statistic):         79.137
Stock-Yogo weak ID test critical values: 10% maximal IV size              7.03
                                         15% maximal IV size              4.58
                                         20% maximal IV size              3.95
                                         25% maximal IV size              3.63
Source: Stock-Yogo (2005).  Reproduced by permission.
NB: Critical values are for Cragg-Donald F statistic and i.i.d. errors.
------------------------------------------------------------------------------
Hansen J statistic (overidentification test of all instruments):         0.000
                                                 (equation exactly identified)
------------------------------------------------------------------------------
Instrumented:         var3 var5
Included instruments: var4
Excluded instruments: var6 var7
Partialled-out:       _cons
                      nb: total SS, model F and R2s are after partialling-out;
                          any small-sample adjustments include partialled-out
                          variables in regressor count K
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-------------------------------------------------------------------+
               Absorbed FE | Categories  - Redundant  = Num. Coefs |
---------------------------+---------------------------------------|
                   firm_id |      2855           1        2854     |
                   user_id |    169753      169753           0    *|
     msa_id#industry_id#yh |     15050          29       15021     |
-------------------------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
(results _ivreg2_var3 are active now)
(results _ivreg2_var5 are active now)

. 
. 
. 
. 
. //-------------------------------------------------------------
. // Close & export CSV
. //-------------------------------------------------------------
. postclose handle

. use `out', clear

. export delimited using "`result_dir'/consolidated_results.csv", ///
>     replace delimiter(",") quote
file ../results/raw/user_productivity_alternative_fe_unbalanced/consolidated_results.csv saved

.         
. *------------------------------------------------------------
. *  Write first-stage CSV to disk
. *------------------------------------------------------------
. postclose handle_fs

. use `out_fs', clear

. export delimited using "`result_dir'/first_stage_fstats.csv", ///
>         replace delimiter(",") quote
file ../results/raw/user_productivity_alternative_fe_unbalanced/first_stage_fstats.csv saved

.                 
. 
. display as result "→ main CSV       : `result_dir'/consolidated_results.csv"
→ main CSV       : ../results/raw/user_productivity_alternative_fe_unbalanced/consolidated_results.csv

. display as result "→ first-stage CSV: `result_dir'/first_stage_fstats.csv"
→ first-stage CSV: ../results/raw/user_productivity_alternative_fe_unbalanced/first_stage_fstats.csv

. 
. log close
      name:  <unnamed>
       log:  /Users/saul/Dropbox/Remote Work Startups/main/spec/log/user_productivity_alternative_fe_unbalanced.log
  log type:  text
 closed on:   5 Jun 2025, 22:10:54
-----------------------------------------------------------------------------------------------------------------------------------------
